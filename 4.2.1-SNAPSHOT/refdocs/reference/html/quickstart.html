<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<title>Quickstart</title>
<link rel="stylesheet" href="css/spring.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="js/highlight/styles/github.min.css">

<style>
.hidden {
	display: none;
}

.switch {
	border-width: 1px 1px 0 1px;
	border-style: solid;
	border-color: #7a2518;
	display: inline-block;
}

.switch--item {
	padding: 10px;
	background-color: #ffffff;
	color: #7a2518;
	display: inline-block;
	cursor: pointer;
}

.switch--item:not(:first-child) {
	border-width: 0 0 0 1px;
	border-style: solid;
	border-color: #7a2518;
}

.switch--item.selected {
	background-color: #7a2519;
	color: #ffffff;
}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
<script type="text/javascript">
function addBlockSwitches() {
	$('.primary').each(function() {
		primary = $(this);
		createSwitchItem(primary, createBlockSwitch(primary)).item.addClass("selected");
		primary.children('.title').remove();
	});
	$('.secondary').each(function(idx, node) {
		secondary = $(node);
		primary = findPrimary(secondary);
		switchItem = createSwitchItem(secondary, primary.children('.switch'));
		switchItem.content.addClass('hidden');
		findPrimary(secondary).append(switchItem.content);
		secondary.remove();
	});
}

function createBlockSwitch(primary) {
	blockSwitch = $('<div class="switch"></div>');
	primary.prepend(blockSwitch);
	return blockSwitch;
}

function findPrimary(secondary) {
	candidate = secondary.prev();
	while (!candidate.is('.primary')) {
		candidate = candidate.prev();
	}
	return candidate;
}

function createSwitchItem(block, blockSwitch) {
	blockName = block.children('.title').text();
	content = block.children('.content').first().append(block.next('.colist'));
	item = $('<div class="switch--item">' + blockName + '</div>');
	blockSwitch.append(item);
	return {'item': item, 'content': content};
}

function globalSwitch() {
	$('.switch--item').each(function() {
		var blockId = blockIdForSwitchItem($(this));
		$(this).off('click');
		$(this).on('click', function() {
			selectedText = $(this).text()
			window.localStorage.setItem(blockId, selectedText);
			$(".switch--item").filter(function() {
				return blockIdForSwitchItem($(this)) === blockId;
			}).filter(function() {
				return $(this).text() === selectedText;
			}).each(function() {
				select($(this))
			});
		});
		if ($(this).text() === window.localStorage.getItem(blockId)) {
			select($(this))
		}
	});
}

function blockIdForSwitchItem(item) {
	idComponents = []
	idComponents.push(item.text().toLowerCase());
	item.siblings(".switch--item").each(function(index, sibling) {
		idComponents.push($(sibling).text().toLowerCase());
	});
	return idComponents.sort().join("-")
}

function select(selected) {
	selected.addClass('selected');
	selected.siblings().removeClass('selected');
	selectedContent = selected.parent().siblings(".content").eq(selected.index())
	selectedContent.removeClass('hidden');
	selectedContent.siblings().addClass('hidden');
}

$(addBlockSwitches);
$(globalSwitch);

</script>

</head>
<body id="quickstart" class="book toc2 toc-left">
<div id="header">
<h1>Quickstart</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#how-to-run-the-demo">1. How to Run the Demo</a></li>
<li><a href="#interacting-with-the-cache">2. Interacting with the Cache</a></li>
<li><a href="#behind-the-scenes">3. Behind the Scenes</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In this getting started chapter we will look a demo to illustrate basic usage of Oracle Coherence when using it with
Spring. This demo provides an example of using Coherence Spring&#8217;s
<a href="https://docs.spring.io/spring-framework/docs/current/reference/html/integration.html#cache">Cache Abstraction</a>.</p>
</div>
<div class="paragraph">
<p>The demo application is basically a super-simple event manager. We can create <code>Events</code> and assign <code>People</code> to them using
an exposed REST API. The data is saved in an embedded <a href="http://hsqldb.org/">HSQL database</a>. The caching is implemented at
the service layer.</p>
</div>
<div class="paragraph">
<p>When an <code>Event</code> is created, it is not only persisted to the database but also <em>put</em> to the Coherence Cache.
Therefore, whenever an <code>Event</code> is retrieved, it will be returned from the Coherence Cache. You can also delete
<code>Events</code>, in which case the <code>Event</code> will be <em>evicted</em> from the cache. You can perform the same
<a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> operations for people as well.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="how-to-run-the-demo"><a class="anchor" href="#how-to-run-the-demo"></a>1. How to Run the Demo</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to get started, please checkout the code from the coherence-community/coherence-spring[Coherence Spring Repository]
GitHub repository.</p>
</div>
<div class="listingblock">
<div class="title">Clone GitHub Repository</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> $ git clone https://github.com/coherence-community/coherence-spring.git
 $ cd coherence-spring</code></pre>
</div>
</div>
<div class="paragraph">
<p>You now have checked out all the code for Coherence Spring. The relevant demo code for this Quickstart demo is under
<code>samples/coherence-spring-demo/</code>.</p>
</div>
<div class="paragraph">
<p>There you will find 3 Maven sub-modules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>coherence-spring-demo-classic</p>
</li>
<li>
<p>coherence-spring-demo-boot</p>
</li>
<li>
<p>coherence-spring-demo-core</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first two Maven modules are essentially variations of
the same app. The third module contains shared code.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>coherence-spring-demo-classic</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides a demo using <strong>Spring Framework</strong> without Spring Boot</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>coherence-spring-demo-boot</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides a demo using <strong>Spring Boot</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>coherence-spring-demo-core</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains common code shared between the two apps</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In this chapter we will focus on the <strong>Spring Boot</strong> version. Since we checked out the project, let&#8217;s build it using Maven:</p>
</div>
<div class="listingblock">
<div class="title">Build the project</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> $ ./mvnw clean package -pl samples/coherence-spring-demo/coherence-spring-demo-boot</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we are ready to run the application:</p>
</div>
<div class="listingblock">
<div class="title">Run the Spring Boot application</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> $ java -jar samples/coherence-spring-demo/coherence-spring-demo-boot/target/coherence-spring-demo-boot-4.2.1-SNAPSHOT.jar</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="interacting-with-the-cache"><a class="anchor" href="#interacting-with-the-cache"></a>2. Interacting with the Cache</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once the application is started, the embedded database is empty. Let&#8217;s create an event with 2 people added to them using
<a href="https://curl.se/docs/manual.html">curl</a>:</p>
</div>
<div class="listingblock">
<div class="title">Create the first event</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> curl --request POST 'http://localhost:8080/api/events?title=First%20Event&amp;date=2020-11-30'</code></pre>
</div>
</div>
<div class="paragraph">
<p>This call will create and persist an <code>Event</code> to the database. However, there is more going on. The created <code>Event</code> is also
added to the Coherence Cache. The magic is happening in the Service layer, specifically in
<code>DefaultEventService#createAndStoreEvent()</code>, which is annotated with <code>@CachePut(cacheNames="events", key="#result.id")</code>.</p>
</div>
<div class="paragraph">
<p>The <code>cacheNames</code> attribute of the <code>@CachePut</code> annotation indicates the name of the underlying cache to use. As caches are
basically just a Map, we also need a key. In this case we use the expression <code>#result.id</code> to retrieve the primary key of
the <code>Event</code> as it was persisted. Thus, the saved <code>Event</code> is added to the cache named <code>events</code> and ultimately also
returned and printed to the console:</p>
</div>
<div class="listingblock">
<div class="title">Return result of the created event</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json"> {
   "id" : 1,
   "title" : "First Event",
   "date" : "2020-11-30T00:00:00.000+00:00"
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>We see that an Event with the id <code>1</code> was successfully created. Let&#8217;s verify that the <em>cache put</em> worked by inspecting
the cache using the open-source tool <a href="https://visualvm.github.io/">VisualVM</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/visual-vm-cache-put.png" alt="VisuamVM">
</div>
<div class="title">Figure 1. VisualVM - Cache Put</div>
</div>
<div class="paragraph">
<p>Under the <code>MBeans</code> tab you will find the Cache MBeans, including and entry for the <code>events</code> cache,
providing numerous statistical information regarding the cache.</p>
</div>
<div class="listingblock">
<div class="title">Retrieving Cache Statistics</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> $ curl --request GET 'http://localhost:8080/api/statistics/events'</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see an entry for <code>TotalPuts</code> of <code>1</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When using VisualVM consider installing the respective
<a href="https://medium.com/oracle-coherence/open-source-coherence-visualvm-plugin-released-533ea2f576bc">Coherence VisualVM Plugin</a>
as it provides some additional insights and visualizations.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next, lets retrieve the Event using id 1:</p>
</div>
<div class="listingblock">
<div class="title">Retrieve Event</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> curl --request GET 'http://localhost:8080/api/events/1'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Event is returned. Did you notice? No SQL queries were executed as the value was directly retrieved from the Cache.
Let&#8217;s check the statistics again, this time via the Coherence VisualVM Plugin:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/visual-vm-cache-get-value.png" alt="VisuamVM Get Value From Cache">
</div>
<div class="title">Figure 2. Cache Statistics via Coherence VisualVM Plugin</div>
</div>
<div class="paragraph">
<p>We will see now how values are being returned from the cache by seeing increasing cacheHits, e.g., <code>"cacheHits" : 1</code>.
Let&#8217;s evict our Event with id 1 from the cache named events:</p>
</div>
<div class="listingblock">
<div class="title">Evict Event</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> curl --request DELETE 'http://localhost:8080/api/events/1'</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you now retrieve the event again using:</p>
</div>
<div class="listingblock">
<div class="title">Retrieve Event</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> curl --request GET 'http://localhost:8080/api/events/1'</code></pre>
</div>
</div>
<div class="paragraph">
<p>you will see an SQL query executed in the console, re-populating the cache. Feel free to play along with the Rest API. We
can, for example, add people:</p>
</div>
<div class="listingblock">
<div class="title">Add people</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> curl --request POST 'http://localhost:8080/api/people?firstName=Conrad&amp;lastName=Zuse&amp;age=85'
 curl --request POST 'http://localhost:8080/api/people?firstName=Alan&amp;lastName=Turing&amp;age=41'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">List people</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> curl --request GET 'http://localhost:8080/api/people'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or assign people to events:</p>
</div>
<div class="listingblock">
<div class="title">Assign People to Events</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> curl --request POST 'http://localhost:8080/api/people/2/add-to-event/1'
 curl --request POST 'http://localhost:8080/api/people/3/add-to-event/1'</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="behind-the-scenes"><a class="anchor" href="#behind-the-scenes"></a>3. Behind the Scenes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>What is involved to make this all work? Using Spring Boot, the setup is incredibly simple. We take advantage of Spring Boot&#8217;s
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#using-boot-auto-configuration">AutoConfiguration</a>
capabilities, and the sensible defaults provided by <em>Coherence Spring</em>.</p>
</div>
<div class="paragraph">
<p>In order to activate AutoConfiguration for Coherence Spring you need to add the <code>coherence-spring-boot-starter</code>
dependency as well as the desired dependency for Coherence.</p>
</div>
<div class="listingblock">
<div class="title">POM configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"> &lt;dependency&gt;
     &lt;groupId&gt;com.oracle.coherence.spring&lt;/groupId&gt;
     &lt;artifactId&gt;coherence-spring-boot-starter&lt;/artifactId&gt; <i class="conum" data-value="1"></i><b>(1)</b>
     &lt;version&gt;4.2.1-SNAPSHOT&lt;/version&gt;
 &lt;/dependency&gt;
 &lt;dependency&gt;
     &lt;groupId&gt;com.oracle.coherence.ce&lt;/groupId&gt;
     &lt;artifactId&gt;coherence&lt;/artifactId&gt;                     <i class="conum" data-value="2"></i><b>(2)</b>
     &lt;version&gt;24.03.1&lt;/version&gt;
 &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Activate Autoconfiguration by adding the <code>coherence-spring-boot-starter</code> dependency</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add the desired version of Coherence (CE or Commercial)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this quickstart example we are using Spring&#8217;s Caching abstraction and therefore, we
use the <code>spring-boot-starter-cache</code> dependency as well:</p>
</div>
<div class="listingblock">
<div class="title">POM configuration for Spring Cache Abstraction</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"> &lt;dependency&gt;
     &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
     &lt;artifactId&gt;spring-boot-starter-cache&lt;/artifactId&gt;
 &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For caching you also must activate caching using the <code>@EnableCaching</code> annotation.</p>
</div>
<div class="listingblock">
<div class="title">Spring Boot App configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"> @SpringBootApplication
 @EnableCaching                                             <i class="conum" data-value="1"></i><b>(1)</b>
 public class CoherenceSpringBootDemoApplication {

     public static void main(String[] args) {
         SpringApplication.run(CoherenceSpringBootDemoApplication.class, args);
     }

 }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Activate the Spring Cache Abstraction</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please see the relevant chapter on
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-caching">Caching</a> in the Spring Boot
reference guide.</p>
</div>
<div class="paragraph">
<p>With <code>@EnableCaching</code> in place, Coherence&#8217;s autoconfiguration will also provide a <code>CoherenceCacheManager</code> bean to the
application context.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-09-04 05:16:11 UTC
</div>
</div>
<script src="js/highlight/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code[data-lang]')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
<script type="text/javascript" src="js/tocbot/tocbot.min.js"></script>
<script type="text/javascript" src="js/toc.js"></script>
</body>
</html>