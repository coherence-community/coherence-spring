<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<title>Coherence Spring Boot</title>
<link rel="stylesheet" href="css/spring.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<style>
.hidden {
	display: none;
}

.switch {
	border-width: 1px 1px 0 1px;
	border-style: solid;
	border-color: #7a2518;
	display: inline-block;
}

.switch--item {
	padding: 10px;
	background-color: #ffffff;
	color: #7a2518;
	display: inline-block;
	cursor: pointer;
}

.switch--item:not(:first-child) {
	border-width: 0 0 0 1px;
	border-style: solid;
	border-color: #7a2518;
}

.switch--item.selected {
	background-color: #7a2519;
	color: #ffffff;
}
</style>
<script type="text/javascript">
function addBlockSwitches() {
	for (var primary of document.querySelectorAll('.primary')) {
		var switchItem = createSwitchItem(primary, createBlockSwitch(primary));
		switchItem.item.classList.add("selected");
		var title = primary.querySelector('.title')
		title.remove();
	}
	for (var secondary of document.querySelectorAll('.secondary')) {
		var primary = findPrimary(secondary);
		if (primary === null) {
			console.error("Found secondary block with no primary sibling");
		}
		else {
			var switchItem = createSwitchItem(secondary, primary.querySelector('.switch'));
			switchItem.content.classList.add("hidden");
			primary.append(switchItem.content);
			secondary.remove();
		}
	}
}

function createElementFromHtml(html) {
	var template = document.createElement('template');
    template.innerHTML = html;
    return template.content.firstChild;
}

function createBlockSwitch(primary) {
    var blockSwitch = createElementFromHtml('<div class="switch"></div>');
    primary.prepend(blockSwitch)
	return blockSwitch;
}

function findPrimary(secondary) {
	var candidate = secondary.previousElementSibling;
	while (candidate != null && !candidate.classList.contains('primary')) {
		candidate = candidate.previousElementSibling;
	}
	return candidate;
}

function createSwitchItem(block, blockSwitch) {
	var blockName = block.querySelector('.title').textContent;
	var content = block.querySelectorAll('.content').item(0);
	var colist = block.querySelector('.colist')
	if (colist != null) {
		content.append();
	}
	var item = createElementFromHtml('<div class="switch--item">' + blockName + '</div>');
	item.dataset.blockName = blockName;
	content.dataset.blockName = blockName;
	blockSwitch.append(item);
	return {'item': item, 'content': content};
}

function globalSwitch() {
	document.querySelectorAll(".switch--item").forEach(function(item) {
		var blockId = blockIdForSwitchItem(item);
		var handler = function(event) {
			selectedText = event.target.textContent;
			window.localStorage.setItem(blockId, selectedText);
			for (var switchItem of document.querySelectorAll(".switch--item")) {
				if (blockIdForSwitchItem(switchItem) === blockId && switchItem.textContent === selectedText) {
					select(switchItem);
				}
			}
		}
		item.addEventListener("click", handler);
		if (item.textContent === window.localStorage.getItem(blockId)) {
			select(item);
		}
	});
}

function select(selected) {
	for (var child of selected.parentNode.children) {
		child.classList.remove("selected");
	}
	selected.classList.add("selected");
	for (var child of selected.parentNode.parentNode.children) {
		if (child.classList.contains("content")) {
			if (selected.dataset.blockName === child.dataset.blockName) {
				child.classList.remove("hidden");
			}
			else {
				child.classList.add("hidden");
			}
		}
	}	
}

function blockIdForSwitchItem(item) {
	idComponents = []
	for (var switchItem of item.parentNode.querySelectorAll(".switch--item")) {
		idComponents.push(switchItem.textContent.toLowerCase());
	}
	return idComponents.sort().join("-")
}

window.onload = function() {
	addBlockSwitches();
	globalSwitch();
};
</script>

</head>
<body id="spring-boot" class="book toc2 toc-left">
<div id="header">
<h1>Coherence Spring Boot</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#spring-boot-getting-started">1. Getting Started</a></li>
<li><a href="#spring-boot-using-coherence">2. Using Coherence with Spring Boot</a></li>
<li><a href="#spring-boot-config-data-api">3. Coherence Support of the Spring Boot ConfigData API</a></li>
<li><a href="#spring-boot-caching">4. Caching with Spring Boot</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This section dives into the Coherence Spring Boot module. It explains how to use
Coherence&#8217;s dedicated support for <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/">Spring Boot</a>, e.g. Autoconfiguration.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-boot-getting-started"><a class="anchor" href="#spring-boot-getting-started"></a>1. Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to start using Coherence with Spring Boot you have to add the <code>coherence-spring-boot-starter</code> dependency as well
as the desired version of Coherence.</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. Adding the Coherence Spring Boot Starter Dependency</div>
<div class="content">
<div class="listingblock primary">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.oracle.coherence.spring&lt;/groupId&gt;
        &lt;artifactId&gt;coherence-spring-boot-starter&lt;/artifactId&gt;
        &lt;version&gt;3.0.0-SNAPSHOT&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.oracle.coherence.ce&lt;/groupId&gt;
        &lt;artifactId&gt;coherence&lt;/artifactId&gt;
        &lt;version&gt;21.06-M2&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">dependencies {
    compile("com.oracle.coherence.spring:coherence-spring-boot-starter:3.0.0-SNAPSHOT")
    compile("com.oracle.coherence.ce:coherence:21.06-M2")
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
As Coherence Spring takes advantage of the new Coherence Bootstrap API, it requires Oracle Coherence CE version
<code>20.12</code> or higher.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-boot-using-coherence"><a class="anchor" href="#spring-boot-using-coherence"></a>2. Using Coherence with Spring Boot</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By adding the <code>coherence-spring-boot-starter</code> dependency, AutoConfiguration will be activated via the
<a href="https://spring.coherence.community/3.0.0-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/boot/autoconfigure/CoherenceAutoConfiguration.html">CoherenceAutoConfiguration</a>
class. This will also bind the <a href="https://spring.coherence.community/3.0.0-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/boot/autoconfigure/CoherenceProperties.html">CoherenceProperties</a>
class for further configuration. The YAML configuration for Spring Boot&#8217;s Coherence support may look like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">coherence:
  logging:
    destination: slf4j
    logger-name: MyCoherence
  sessions:
  - name: default
    config: "coherence-cache-config.xml"
    priority: 1
  - name: test
    config: "test-coherence-config.xml"
    priority: 2
  properties:
    coherence.log.limit: 400
    coherence.log.level: 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following configuration properties are available.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Coherence Configuration Properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">coherence.logging.destination</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slf4j</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of the logging destination.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">coherence.logging.severity-level</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies which logged messages are emitted to the log destination. The legal values are <code>-1</code> to <code>9</code>.
No messages are emitted if <code>-1</code> is specified. More log messages are emitted as the log level is increased.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">coherence.logging.logger-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Coherence</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies a logger name within chosen logging system</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">coherence.logging.message-format</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies how messages that have a logging level specified are formatted before passing them to the log destination.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">coherence.logging.character-limit</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the maximum number of characters that the logger daemon processes from the message queue before discarding
  all remaining messages in the queue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">coherence.sessions.&lt;type&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the type of the session. One of the following: <code>grpc</code>, <code>server</code>, <code>client</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">coherence.sessions.&lt;type&gt;[0].name</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Namee of the session.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">coherence.sessions.&lt;type&gt;[0].config</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Coherence cache configuration URI for the session</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">coherence.sessions.&lt;type&gt;[0].priority</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SessionConfiguration#DEFAULT_PRIORITY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The priority order to be used when starting the session. Sessions will be started with the lowest priority first.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">coherence.sessions.&lt;type&gt;[0].scope-name</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The scope name for the session.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>Session</code>-related configuration properties are defined based on the session type in:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://spring.coherence.community/3.0.0-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/configuration/session/AbstractSessionConfigurationBean.html">AbstractSessionConfigurationBean</a></p>
</li>
<li>
<p><a href="https://spring.coherence.community/3.0.0-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/configuration/session/SessionConfigurationBean.html">SessionConfigurationBean</a></p>
</li>
<li>
<p><a href="https://spring.coherence.community/3.0.0-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/configuration/session/GrpcSessionConfigurationBean.html">GrpcSessionConfigurationBean</a></p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
All but the <code>Session</code> properties are translated into native Coherence properties. If both
Spring Boot property AND a native property <code>coherence.properties.*</code> are configured, the Spring Boot
property is used.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the provided Spring Boot configuration properties are not sufficient for your needs, you can also specify any of
the native Coherence properties. For a list of available native properties, please consult the reference guide chapter on
<a href="https://docs.oracle.com/en/middleware/standalone/coherence/14.1.1.0/develop-applications/system-property-overrides.html#GUID-32230D28-4976-4147-A887-0A0120FF5C7E">System Property Overrides</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-boot-config-data-api"><a class="anchor" href="#spring-boot-config-data-api"></a>3. Coherence Support of the Spring Boot ConfigData API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since Spring Boot <code>2.4.x</code>, you can define your own
<a href="https://spring.io/blog/2020/08/14/config-file-processing-in-spring-boot-2-4">custom config locations</a>. This allows you to
import these config locations as property sources. As such, Coherence Spring allows you to use a Coherence cluster as a source of
configuration data for your Spring Boot based applications.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please also consult the Spring Boot reference guide on <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-external-config">Externalized Configuration</a>,
especially the chapter on <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-external-config-files-importing">Importing Additional Data</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please also see the chapter on <a href="spring-cloud-config.html#spring-cloud-config">Coherence Spring Cloud Config</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can trigger the import of remote configuration properties with the Spring Boot property
<code>spring.config.import</code> using the value <code>coherence:</code>. You will also need the corresponding Coherence config-client
configured to specify any remote connection settings for your Coherence cluster as well as settings specifying how
properties will be applied, e.g. the name of the application used to fetch remote properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  config:
    import: coherence:
coherence:
  config-client:
    application-name: berlin
    profile: kona</code></pre>
</div>
</div>
<div class="paragraph">
<p>Many properties have sensible default value. Please see class
<a href="https://spring.coherence.community/3.0.0-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/boot/config/CoherenceConfigClientProperties.html">CoherenceConfigClientProperties</a>
for details.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-boot-caching"><a class="anchor" href="#spring-boot-caching"></a>4. Caching with Spring Boot</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you have not already done so, please read the chapter
<a href="spring-cache.html#spring-cache-configuration">Configuring Coherence Cache for Spring</a> first.</p>
</div>
<div class="paragraph">
<p>In this chapter, we see how we can use caching with Coherence in Spring Boot.
As long as <code>coherence-spring-boot-starter</code> is added to your project, and caching is enabled via <code>@EnableCaching</code>,
<a href="https://spring.coherence.community/3.0.0-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/boot/autoconfigure/CoherenceAutoConfiguration.html">Coherence Autoconfiguration</a>
will automatically provide a
<a href="https://spring.coherence.community/3.0.0-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/cache/CoherenceCacheManager.html">CoherenceCacheManager</a> (implementing
Spring&#8217;s <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/cache/CacheManager.html">CacheManager</a>) to the ApplicationContext. However, the
<code>CacheManager</code> is only added if no <code>CacheManager</code> was configured explicitly beforehand.</p>
</div>
<div class="paragraph">
<p>Once that is in place, you can take advantage of
<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-caching">Spring&#8217;s Cache abstraction</a>
backed by Coherence and use Spring&#8217;s annotations such as <code>@Cacheable</code>, <code>@CacheEvict</code>, <code>@CachePut</code> etc.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When learning about Coherence&#8217;s Spring cache abstraction support, please familiarize yourself with the
following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="quickstart.html#quickstart">Coherence Spring Quickstart chapter</a></p>
</li>
<li>
<p><a href="spring-cache.html#spring-cache">Coherence Core Spring Cache Support</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-caching">Spring Boot&#8217;s reference documentation&#8217;s support regarding caching</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/integration.html#cache">The Cache Abstraction</a> chapter in the core Spring Framework reference guide</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-05-17 05:22:28 UTC
</div>
</div>
<script type="text/javascript" src="js/tocbot/tocbot.min.js"></script>
<script type="text/javascript" src="js/toc.js"></script>
<link rel="stylesheet" href="js/highlight/styles/github.min.css">
<script src="js/highlight/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>