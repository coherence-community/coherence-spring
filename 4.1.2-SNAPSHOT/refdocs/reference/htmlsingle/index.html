<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<meta name="author" content="Gunnar Hillert, Ryan Lubke, Vaso Putica, Jonathan Knight">
<title>Coherence Spring Reference Documentation</title>
<link rel="stylesheet" href="css/spring.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="js/highlight/styles/github.min.css">

<style>
.hidden {
	display: none;
}

.switch {
	border-width: 1px 1px 0 1px;
	border-style: solid;
	border-color: #7a2518;
	display: inline-block;
}

.switch--item {
	padding: 10px;
	background-color: #ffffff;
	color: #7a2518;
	display: inline-block;
	cursor: pointer;
}

.switch--item:not(:first-child) {
	border-width: 0 0 0 1px;
	border-style: solid;
	border-color: #7a2518;
}

.switch--item.selected {
	background-color: #7a2519;
	color: #ffffff;
}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
<script type="text/javascript">
function addBlockSwitches() {
	$('.primary').each(function() {
		primary = $(this);
		createSwitchItem(primary, createBlockSwitch(primary)).item.addClass("selected");
		primary.children('.title').remove();
	});
	$('.secondary').each(function(idx, node) {
		secondary = $(node);
		primary = findPrimary(secondary);
		switchItem = createSwitchItem(secondary, primary.children('.switch'));
		switchItem.content.addClass('hidden');
		findPrimary(secondary).append(switchItem.content);
		secondary.remove();
	});
}

function createBlockSwitch(primary) {
	blockSwitch = $('<div class="switch"></div>');
	primary.prepend(blockSwitch);
	return blockSwitch;
}

function findPrimary(secondary) {
	candidate = secondary.prev();
	while (!candidate.is('.primary')) {
		candidate = candidate.prev();
	}
	return candidate;
}

function createSwitchItem(block, blockSwitch) {
	blockName = block.children('.title').text();
	content = block.children('.content').first().append(block.next('.colist'));
	item = $('<div class="switch--item">' + blockName + '</div>');
	blockSwitch.append(item);
	return {'item': item, 'content': content};
}

function globalSwitch() {
	$('.switch--item').each(function() {
		var blockId = blockIdForSwitchItem($(this));
		$(this).off('click');
		$(this).on('click', function() {
			selectedText = $(this).text()
			window.localStorage.setItem(blockId, selectedText);
			$(".switch--item").filter(function() {
				return blockIdForSwitchItem($(this)) === blockId;
			}).filter(function() {
				return $(this).text() === selectedText;
			}).each(function() {
				select($(this))
			});
		});
		if ($(this).text() === window.localStorage.getItem(blockId)) {
			select($(this))
		}
	});
}

function blockIdForSwitchItem(item) {
	idComponents = []
	idComponents.push(item.text().toLowerCase());
	item.siblings(".switch--item").each(function(index, sibling) {
		idComponents.push($(sibling).text().toLowerCase());
	});
	return idComponents.sort().join("-")
}

function select(selected) {
	selected.addClass('selected');
	selected.siblings().removeClass('selected');
	selectedContent = selected.parent().siblings(".content").eq(selected.index())
	selectedContent.removeClass('hidden');
	selectedContent.siblings().addClass('hidden');
}

$(addBlockSwitches);
$(globalSwitch);

</script>

</head>
<body id="coherence-spring-reference-documentation" class="book toc2 toc-left">
<div id="header">
<h1>Coherence Spring Reference Documentation</h1>
<div class="details">
<span id="author" class="author">Gunnar Hillert, Ryan Lubke, Vaso Putica, Jonathan Knight</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#legal">Legal</a></li>
<li><a href="#coherence-spring-documentation">1. Coherence Spring Documentation</a>
<ul class="sectlevel2">
<li><a href="#about">1.1. About the Documentation</a></li>
<li><a href="#getting-help">1.2. Getting Help</a></li>
<li><a href="#news">1.3. What is new?</a></li>
<li><a href="#first-steps">1.4. First Steps</a></li>
</ul>
</li>
<li><a href="#quickstart">2. Quickstart</a>
<ul class="sectlevel2">
<li><a href="#how-to-run-the-demo">2.1. How to Run the Demo</a></li>
<li><a href="#interacting-with-the-cache">2.2. Interacting with the Cache</a></li>
<li><a href="#behind-the-scenes">2.3. Behind the Scenes</a></li>
</ul>
</li>
<li><a href="#coherence-spring">3. Coherence Spring Core</a>
<ul class="sectlevel2">
<li><a href="#coherence-spring-introduction">3.1. Getting Started</a></li>
<li><a href="#coherence-spring-botstrap">3.2. Bootstrapping Coherence</a></li>
<li><a href="#coherence-spring-botstrap-with-default-session">3.3. Using the Default Session</a></li>
<li><a href="#coherence-spring-botstrap-with-multiple-session">3.4. Configure Multiple Sessions</a></li>
<li><a href="#coherence-spring-bootstrap-session-config-properties">3.5. Session Configuration Bean Properties</a></li>
<li><a href="#coherence-spring-dependency-injection">3.6. Dependency Injection</a>
<ul class="sectlevel3">
<li><a href="#coherence-spring-dependency-injection-namedmap-namedcache">3.6.1. Injecting NamedMap and NamedCache</a>
<ul class="sectlevel4">
<li><a href="#coherence-spring-dependency-injection-type-conversion">3.6.1.1. Type Conversion of NamedMap and NamedCache</a></li>
<li><a href="#specify-the-mapcache-name">3.6.1.2. Specify the Map/Cache Name</a></li>
<li><a href="#specify-the-owning-session-name">3.6.1.3. Specify the Owning Session Name</a></li>
</ul>
</li>
<li><a href="#coherence-spring-dependency-injection-asyncnamedmap-asyncnamedcache">3.6.2. Injecting AsyncNamedMap &amp; AsyncNamedCache</a></li>
<li><a href="#coherence-spring-dependency-injection-views">3.6.3. Injecting Views (CQC)</a>
<ul class="sectlevel4">
<li><a href="#coherence-spring-dependency-injection-views-filter">3.6.3.1. Specify a View Filter</a></li>
<li><a href="#coherence-spring-dependency-injection-views-transformer">3.6.3.2. Specify a View Transformer</a></li>
</ul>
</li>
<li><a href="#coherence-spring-dependency-injection-session">3.6.4. Injecting a Session</a>
<ul class="sectlevel4">
<li><a href="#coherence-spring-dependency-injection-session-with-name">3.6.4.1. Specify a Session Name</a></li>
</ul>
</li>
<li><a href="#coherence-spring-dependency-injection-namedtopic">3.6.5. Injecting NamedTopic</a>
<ul class="sectlevel4">
<li><a href="#injecting-namedtopic">3.6.5.1. Injecting NamedTopic</a></li>
<li><a href="#injecting-a-namedtopic-publisher">3.6.5.2. Injecting a NamedTopic Publisher</a></li>
<li><a href="#injecting-a-namedtopic-subscriber">3.6.5.3. Injecting a NamedTopic Subscriber</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#injecting-spring-beans-into-coherence-managed-objects">3.7. Injecting Spring Beans into Coherence-Managed Objects</a></li>
<li><a href="#coherence-spring-events">3.8. Events</a>
<ul class="sectlevel3">
<li><a href="#coherence-spring-events-mapevent-listeners">3.8.1. MapEvent Listeners</a>
<ul class="sectlevel4">
<li><a href="#mapevent-observer-methods">3.8.1.1. MapEvent Observer Methods</a></li>
<li><a href="#coherence-spring-events-mapevent-listeners-specific-events">3.8.1.2. Receive Specific Event Types</a></li>
<li><a href="#coherence-spring-events-mapevent-listeners-filtering-events">3.8.1.3. Filtering Events</a></li>
<li><a href="#coherence-spring-events-mapevent-listeners-transforming-events">3.8.1.4. Transforming Events</a></li>
</ul>
</li>
<li><a href="#coherence-spring-events-event-interceptors">3.8.2. Coherence Event Interceptors</a>
<ul class="sectlevel4">
<li><a href="#event-types">3.8.2.1. Event Types</a></li>
<li><a href="#coherence-lifecycle-events">3.8.2.2. Coherence Lifecycle Events</a></li>
<li><a href="#session-lifecycle-events">3.8.2.3. Session Lifecycle Events</a></li>
<li><a href="#configurablecachefactory-lifecycle-events">3.8.2.4. ConfigurableCacheFactory Lifecycle Events</a></li>
<li><a href="#cache-lifecycle-events">3.8.2.5. Cache Lifecycle Events</a></li>
<li><a href="#entry-events">3.8.2.6. Entry Events</a></li>
<li><a href="#entryprocessor-events">3.8.2.7. EntryProcessor Events</a></li>
<li><a href="#partition-level-transaction-events">3.8.2.8. Partition Level Transaction Events</a></li>
<li><a href="#partition-transfer-events">3.8.2.9. Partition Transfer Events</a></li>
<li><a href="#unsolicited-commit-events">3.8.2.10. Unsolicited Commit Events</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#coherence-spring-filter-binding-annotations">3.9. Filter Binding Annotations</a>
<ul class="sectlevel3">
<li><a href="#create-the-filter-binding-annotation">3.9.1. Create the filter binding annotation</a></li>
<li><a href="#create-the-filterfactory">3.9.2. Create the <code>FilterFactory</code></a></li>
<li><a href="#annotate-the-injection-point">3.9.3. Annotate the Injection Point</a></li>
</ul>
</li>
<li><a href="#coherence-spring-extractor-binding-annotations">3.10. Extractor Binding Annotations</a>
<ul class="sectlevel3">
<li><a href="#create-the-extractor-binding-annotation">3.10.1. Create the extractor binding annotation</a></li>
<li><a href="#create-the-extractorfactory">3.10.2. Create the <code>ExtractorFactory</code></a></li>
<li><a href="#annotate-the-injection-point-2">3.10.3. Annotate the Injection Point</a></li>
</ul>
</li>
<li><a href="#coherence-spring-messaging-with-coherence-topics">3.11. Messaging with Coherence Topics</a>
<ul class="sectlevel3">
<li><a href="#define-publishers-coherencepublisher">3.11.1. Define Publishers - @CoherencePublisher</a></li>
<li><a href="#reactive-and-non-blocking-method-definitions">3.11.2. Reactive and Non-Blocking Method Definitions</a>
<ul class="sectlevel4">
<li><a href="#mono-value-and-return-type">3.11.2.1. Mono Value and Return Type</a></li>
<li><a href="#reactor-flux-value-and-return-type">3.11.2.2. Reactor Flux Value and Return Type</a></li>
<li><a href="#future-return-type">3.11.2.3. Future Return Type</a></li>
</ul>
</li>
<li><a href="#define-subscribers-coherencetopiclistener">3.11.3. Define Subscribers - @CoherenceTopicListener</a></li>
<li><a href="#method-parameter-bindings">3.11.4. Method Parameter Bindings</a></li>
<li><a href="#committing-messages">3.11.5. Committing Messages</a>
<ul class="sectlevel4">
<li><a href="#default-commit-behaviour">3.11.5.1. Default Commit Behaviour</a></li>
<li><a href="#setting-commit-strategy">3.11.5.2. Setting Commit Strategy</a></li>
<li><a href="#forwarding-messages-with-sendto">3.11.5.3. Forwarding Messages with @SendTo</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#coherence-spring-cachestore">3.12. Cache Store</a>
<ul class="sectlevel3">
<li><a href="#coherence-spring-cachestore-demo">3.12.1. JPA Repository CacheStore Demo</a>
<ul class="sectlevel4">
<li><a href="#coherence-spring-cachestore-demo-model">3.12.1.1. Data Model</a></li>
<li><a href="#coherence-spring-cachestore-demo-jpa-repository">3.12.1.2. Writing a JPA Repository CacheStore</a></li>
<li><a href="#coherence-spring-cachestore-demo-embedded">3.12.1.3. Embedded Coherence</a></li>
<li><a href="#coherence-spring-cachestore-demo-running-embedded">3.12.1.4. Running the Embedded Sample</a></li>
<li><a href="#coherence-spring-cachestore-demo-coherence-extend">3.12.1.5. Using Coherence*Extend</a></li>
<li><a href="#coherence-spring-cachestore-demo-inspect-database">3.12.1.6. Inspecting the Database</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#spring-cache">4. Coherence Spring Cache</a>
<ul class="sectlevel2">
<li><a href="#spring-cache-introduction">4.1. Introduction</a></li>
<li><a href="#spring-cache-configuration">4.2. Configuring Coherence Cache for Spring</a></li>
<li><a href="#spring-cache-locking">4.3. Coherence Caches and Locking</a></li>
</ul>
</li>
<li><a href="#spring-session">5. Coherence Spring Session</a>
<ul class="sectlevel2">
<li><a href="#spring-session-introduction">5.1. Getting Started</a></li>
<li><a href="#spring-session-pof">5.2. POF Serialization</a></li>
<li><a href="#spring-session-sample">5.3. Spring Session Samples</a>
<ul class="sectlevel3">
<li><a href="#spring-session-with-spring-boot">5.3.1. Spring Session with Spring Boot</a>
<ul class="sectlevel4">
<li><a href="#spring-session-sample-start-embedded-coherence">5.3.1.1. Start Spring Session with Embedded Coherence Instances</a></li>
<li><a href="#spring-session-sample-start-remote-coherence">5.3.1.2. Spring Session with Remote Coherence Instances</a></li>
<li><a href="#spring-session-sample-rest-endpoints">5.3.1.3. Accessing the REST Endpoints</a></li>
<li><a href="#spring-session-sample-actuator">5.3.1.4. Spring Session Actuator</a></li>
<li><a href="#spring-session-sample-docker">5.3.1.5. Generate Docker Image</a></li>
</ul>
</li>
<li><a href="#spring-session-with-plain-spring-framework">5.3.2. Spring Session with plain Spring Framework</a></li>
</ul>
</li>
<li><a href="#spring-session-expiration-strategies">5.4. Session Expiration Strategies</a></li>
</ul>
</li>
<li><a href="#spring-data">6. Coherence Spring Data</a>
<ul class="sectlevel2">
<li><a href="#spring-data-introduction">6.1. Introduction</a></li>
<li><a href="#features">6.2. Features</a></li>
<li><a href="#getting-started">6.3. Getting Started</a></li>
<li><a href="#defining-repositories">6.4. Defining Repositories</a>
<ul class="sectlevel3">
<li><a href="#identifying-the-coherence-namedmap">6.4.1. Identifying the Coherence NamedMap</a></li>
</ul>
</li>
<li><a href="#mapping-entities">6.5. Mapping Entities</a></li>
<li><a href="#using-the-repository">6.6. Using the Repository</a>
<ul class="sectlevel3">
<li><a href="#finder-queries">6.6.1. Finder Queries</a></li>
</ul>
</li>
<li><a href="#projections">6.7. Projections</a>
<ul class="sectlevel3">
<li><a href="#interface-based-projections">6.7.1. Interface-based Projections</a></li>
<li><a href="#closed-projections">6.7.2. Closed Projections</a></li>
<li><a href="#open-projections">6.7.3. Open Projections</a></li>
<li><a href="#nullable-wrappers">6.7.4. Nullable Wrappers</a></li>
<li><a href="#class-based-projections-dtos">6.7.5. Class-based Projections (DTOs)</a></li>
<li><a href="#dynamic-projections">6.7.6. Dynamic Projections</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#spring-boot">7. Coherence Spring Boot</a>
<ul class="sectlevel2">
<li><a href="#spring-boot-getting-started">7.1. Getting Started</a></li>
<li><a href="#spring-boot-using-coherence">7.2. Using Coherence with Spring Boot</a></li>
<li><a href="#spring-boot-coherence-cluster-setup">7.3. Coherence Cluster Setup</a>
<ul class="sectlevel3">
<li><a href="#spring-boot-coherence-cluster-setup-co-located">7.3.1. Co-located Coherence Clusters</a></li>
<li><a href="#spring-boot-coherence-cluster-setup-client">7.3.2. Access Coherence Clusters as a Client</a>
<ul class="sectlevel4">
<li><a href="#spring-boot-coherence-cluster-setup-client-grpc">7.3.2.1. gRPC</a></li>
<li><a href="#spring-boot-coherence-cluster-setup-client-extend">7.3.2.2. Coherence*Extend</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#spring-boot-config-data-api">7.4. Support of the Spring Boot ConfigData API</a></li>
<li><a href="#spring-boot-caching">7.5. Caching with Spring Boot</a>
<ul class="sectlevel3">
<li><a href="#spring-boot-caching-circuit-breaker">7.5.1. Configure Circuit Breakers with Resilience4j</a>
<ul class="sectlevel4">
<li><a href="#spring-boot-caching-circuit-breaker-running-example">7.5.1.1. Running the Example</a></li>
<li><a href="#monitoring-the-circuit-breaker">7.5.1.2. Monitoring the Circuit Breaker</a></li>
<li><a href="#add-resilience4j-dependencies">7.5.1.3. Add Resilience4j Dependencies</a></li>
<li><a href="#resilience4j-annotations">7.5.1.4. Resilience4j Annotations</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#spring-boot-hibernate-second-level-cache">7.6. Configure Hibernate Second-Level Caching</a>
<ul class="sectlevel3">
<li><a href="#spring-boot-hibernate-second-level-cache-example">7.6.1. Hibernate Second Level Cache Example</a>
<ul class="sectlevel4">
<li><a href="#spring-boot-hibernate-second-level-cache-example-run">7.6.1.1. Run the Hibernate Application</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#spring-boot-sessions">7.7. Spring Session Support</a></li>
<li><a href="#spring-boot-messaging">7.8. Coherence Messaging Support</a></li>
<li><a href="#spring-boot-metrics">7.9. Coherence Metrics</a></li>
<li><a href="#spring-boot-data">7.10. Spring Data Support</a></li>
</ul>
</li>
<li><a href="#spring-cloud-config">8. Coherence Spring Cloud Config</a>
<ul class="sectlevel2">
<li><a href="#spring-cloud-config-overview">8.1. Overview</a></li>
<li><a href="#spring-cloud-config-demo">8.2. Demo</a>
<ul class="sectlevel3">
<li><a href="#spring-cloud-config-demo-setup">8.2.1. Configure the Demo Application</a></li>
<li><a href="#spring-cloud-config-demo-how-to-run">8.2.2. Run the Demo Application</a></li>
</ul>
</li>
<li><a href="#spring-cloud-config-coherence">8.3. Use Spring Cloud Config Server to Configure Coherence</a></li>
</ul>
</li>
<li><a href="#appendix">9. Appendices</a>
<ul class="sectlevel2">
<li><a href="#examples">Appendix A: Coherence Spring Example Applications</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Version 4.1.2-SNAPSHOT</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="legal"><a class="anchor" href="#legal"></a>Legal</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Oracle licenses the Oracle Coherence Spring project under the
<a href="https://oss.oracle.com/licenses/upl/">The Universal Permissive License (UPL), Version 1.0</a>.</p>
</div>
<div class="paragraph">
<p><strong>The Universal Permissive License (UPL), Version 1.0</strong></p>
</div>
<div class="paragraph">
<p>Subject to the condition set forth below, permission is hereby granted to any
person obtaining a copy of this software, associated documentation and/or data
(collectively the "Software"), free of charge and under any and all copyright
rights in the Software, and any and all patent rights owned or freely
licensable by each licensor hereunder covering either (i) the unmodified
Software as contributed to or provided by such licensor, or (ii) the Larger
Works (as defined below), to deal in both</p>
</div>
<div class="paragraph">
<p>(a) the Software, and
(b) any piece of software and/or hardware listed in the lrgrwrks.txt file if
one is included with the Software (each a "Larger Work" to which the Software
is contributed by such licensors),</p>
</div>
<div class="paragraph">
<p>without restriction, including without limitation the rights to copy, create
derivative works of, display, perform, and distribute the Software and make,
use, sell, offer for sale, import, export, have made, and have sold the
Software and the Larger Work(s), and to sublicense the foregoing rights on
either these or other terms.</p>
</div>
<div class="paragraph">
<p>This license is subject to the following condition:
The above copyright notice and either this complete permission notice or at
a minimum a reference to the UPL must be included in all copies or
substantial portions of the Software.</p>
</div>
<div class="paragraph">
<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="coherence-spring-documentation"><a class="anchor" href="#coherence-spring-documentation"></a>1. Coherence Spring Documentation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Welcome to the reference documentation of <a href="https://github.com/coherence-community/coherence-spring/">Coherence Spring</a>, a collection of libraries that will
help you to integrate <a href="https://coherence.community/">Oracle Coherence</a> with the wider <a href="https://spring.io/">Spring</a> ecosystem.</p>
</div>
<div class="paragraph">
<p><a href="https://coherence.community/">Oracle Coherence</a> is a scalable, fault-tolerant, cloud-ready, distributed platform for building
grid-based applications and reliably storing data. The product is used at scale, for both compute and raw storage, in a
vast array of industries such as critical financial trading systems, high performance telecommunication products and
e-commerce applications.</p>
</div>
<div class="paragraph">
<p>Coherence Spring features dedicated support to bootstrap Oracle Coherence and to inject Coherence resources into Spring
beans as well as to inject Spring beans into Coherence resources. Spring&#8217;s dependency injection (DI) support simplifies
application code as Oracle Coherence <em>maps</em>, <em>caches</em> and <em>topics</em> are just injected instead of being obtained explicitly
via Coherence APIs. Furthermore, using annotated <em>event listener</em> methods simplifies building reactive code that responds
to Coherence cache events.</p>
</div>
<div class="paragraph">
<p>Before diving into the technical aspects of the reference documentation let&#8217;s provide a brief overview of the Coherence
Spring reference documentation, where to start, how to obtain further helper and more.</p>
</div>
<div class="sect2">
<h3 id="about"><a class="anchor" href="#about"></a>1.1. About the Documentation</h3>
<div class="paragraph">
<p>The Coherence Spring reference guide is available as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/reference//html">Multi-page HTML</a></p>
</li>
<li>
<p><a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/reference//htmlsingle">Single page HTML</a></p>
</li>
<li>
<p><a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/reference//pdf/coherence-spring-reference.pdf">PDF</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="getting-help"><a class="anchor" href="#getting-help"></a>1.2. Getting Help</h3>
<div class="paragraph">
<p>If you run into issues with Spring Coherence, we are here to help.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Try the <a href="#quickstart">Quickstart</a>.</em>
The Quickstart will give you an overview of Coherence Spring&#8217;s
capabilities and provides a sample application to get you started.</p>
</li>
<li>
<p><em>Learn the Coherence basics.</em> Please have at least some basic understanding of Oracle Coherence since all Spring Coherence
modules depend on it. Check out the <a href="https://coherence.community">Coherence CE</a> web-site for general Coherence
targeted reference documentation.</p>
</li>
<li>
<p><em>Learn the Spring basics.</em>
The reference guide assumes that you have a basic understanding of <a href="https://spring.io/projects/spring-framework/">Spring Framework</a> and
<a href="https://spring.io/projects/spring-boot/">Spring Boot</a>. Coherence Spring utilizes several other Spring projects. Check the
<a href="https://spring.io/">spring.io</a> web-site for general reference documentation. If you are starting out with Spring, try
one of the <a href="https://spring.io/guides">guides</a> or generate a starter project using <a href="https://start.spring.io/" class="bare">start.spring.io/</a>.</p>
</li>
<li>
<p><em>Ask a question.</em>
Chat with us directly on <a href="https://join.slack.com/t/oraclecoherence/shared_invite/zt-9ufv220y-Leudk0o5ntgNV0xraa8DNw">Slack</a>.
We also monitor <a href="https://stackoverflow.com">stackoverflow.com</a> for questions tagged with
<a href="https://stackoverflow.com/tags/oracle-coherence">oracle-coherence</a>.</p>
</li>
<li>
<p><em>Contribute.</em>
Report bugs with Spring Coherence via <a href="https://github.com/coherence-community/coherence-spring/issues/">GitHub Issues</a>. Both, Coherence CE and Coherence Spring are Open
Source Software (OSS) under the liberal <a href="#legal">Universal Permissive License (UPL)</a>. Contributing back is
a great way to attain a deeper understanding of our projects.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All of <em>Coherence Spring</em> is open source, including the documentation.
If you find problems with the docs or if you want to improve them, please <a href="https://github.com/coherence-community/coherence-spring/">get involved</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="news"><a class="anchor" href="#news"></a>1.3. What is new?</h3>
<div class="paragraph">
<p>In order to see what changes were made from earlier versions of Coherence Spring, see the
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/index.html#/dev/06_history">Change History</a> as well as the <a href="https://github.com/coherence-community/coherence-spring/releases/">GitHub Releases</a> page.</p>
</div>
</div>
<div class="sect2">
<h3 id="first-steps"><a class="anchor" href="#first-steps"></a>1.4. First Steps</h3>
<div class="paragraph">
<p>If you are getting started with Coherence Spring, start with the <a href="#quickstart">Quickstart</a>. It is a great
way to see a working solution quickly. Particularly if you are relatively new to Spring, continue with the
<a href="#spring-boot">Coherence Spring Boot</a> chapter next.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Another great example application is the Spring Boot implementation of the
<a href="https://github.com/coherence-community/todo-list-example/tree/main/java">To-do List application</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The reference documentation makes a distinction between
<a href="https://spring.io/projects/spring-framework/">Spring Framework</a> and <a href="https://spring.io/projects/spring-boot/">Spring Boot</a>. At its very core, Spring Framework provides
Dependency Injection (DI) or Inversion Of Control (IOC) to Java applications. Furthermore, Spring Framework gives developers
comprehensive infrastructure support for developing Java applications.</p>
</div>
<div class="paragraph">
<p>Spring Boot on the other hand, is an opinionated extension to the Spring Framework by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Eliminating boilerplate configurations</p>
</li>
<li>
<p>Providing Auto-Configuration for other Spring modules and third-party integrations</p>
</li>
<li>
<p>Metrics + health checks</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The vast majority of new Spring projects will utilize Spring Boot. Nonetheless, please also study the Spring Framework targeted
chapters as Spring Frameworks is the foundation for everything related to Spring Boot.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="quickstart"><a class="anchor" href="#quickstart"></a>2. Quickstart</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this getting started chapter we will look a demo to illustrate basic usage of Oracle Coherence when using it with
Spring. This demo provides an example of using Coherence Spring&#8217;s
<a href="https://docs.spring.io/spring-framework/docs/current/reference/html/integration.html#cache">Cache Abstraction</a>.</p>
</div>
<div class="paragraph">
<p>The demo application is basically a super-simple event manager. We can create <code>Events</code> and assign <code>People</code> to them using
an exposed REST API. The data is saved in an embedded <a href="http://hsqldb.org/">HSQL database</a>. The caching is implemented at
the service layer.</p>
</div>
<div class="paragraph">
<p>When an <code>Event</code> is created, it is not only persisted to the database but also <em>put</em> to the Coherence Cache.
Therefore, whenever an <code>Event</code> is retrieved, it will be returned from the Coherence Cache. You can also delete
<code>Events</code>, in which case the <code>Event</code> will be <em>evicted</em> from the cache. You can perform the same
<a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> operations for people as well.</p>
</div>
<div class="sect2">
<h3 id="how-to-run-the-demo"><a class="anchor" href="#how-to-run-the-demo"></a>2.1. How to Run the Demo</h3>
<div class="paragraph">
<p>In order to get started, please checkout the code from the coherence-community/coherence-spring[Coherence Spring Repository]
GitHub repository.</p>
</div>
<div class="listingblock">
<div class="title">Clone GitHub Repository</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> $ git clone https://github.com/coherence-community/coherence-spring.git
 $ cd coherence-spring</code></pre>
</div>
</div>
<div class="paragraph">
<p>You now have checked out all the code for Coherence Spring. The relevant demo code for this Quickstart demo is under
<code>samples/coherence-spring-demo/</code>.</p>
</div>
<div class="paragraph">
<p>There you will find 3 Maven sub-modules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>coherence-spring-demo-classic</p>
</li>
<li>
<p>coherence-spring-demo-boot</p>
</li>
<li>
<p>coherence-spring-demo-core</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first two Maven modules are essentially variations of
the same app. The third module contains shared code.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>coherence-spring-demo-classic</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides a demo using <strong>Spring Framework</strong> without Spring Boot</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>coherence-spring-demo-boot</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides a demo using <strong>Spring Boot</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>coherence-spring-demo-core</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains common code shared between the two apps</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In this chapter we will focus on the <strong>Spring Boot</strong> version. Since we checked out the project, let&#8217;s build it using Maven:</p>
</div>
<div class="listingblock">
<div class="title">Build the project</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> $ ./mvnw clean package -pl samples/coherence-spring-demo/coherence-spring-demo-boot</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we are ready to run the application:</p>
</div>
<div class="listingblock">
<div class="title">Run the Spring Boot application</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> $ java -jar samples/coherence-spring-demo/coherence-spring-demo-boot/target/coherence-spring-demo-boot-4.1.2-SNAPSHOT.jar</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="interacting-with-the-cache"><a class="anchor" href="#interacting-with-the-cache"></a>2.2. Interacting with the Cache</h3>
<div class="paragraph">
<p>Once the application is started, the embedded database is empty. Let&#8217;s create an event with 2 people added to them using
<a href="https://curl.se/docs/manual.html">curl</a>:</p>
</div>
<div class="listingblock">
<div class="title">Create the first event</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> curl --request POST 'http://localhost:8080/api/events?title=First%20Event&amp;date=2020-11-30'</code></pre>
</div>
</div>
<div class="paragraph">
<p>This call will create and persist an <code>Event</code> to the database. However, there is more going on. The created <code>Event</code> is also
added to the Coherence Cache. The magic is happening in the Service layer, specifically in
<code>DefaultEventService#createAndStoreEvent()</code>, which is annotated with <code>@CachePut(cacheNames="events", key="#result.id")</code>.</p>
</div>
<div class="paragraph">
<p>The <code>cacheNames</code> attribute of the <code>@CachePut</code> annotation indicates the name of the underlying cache to use. As caches are
basically just a Map, we also need a key. In this case we use the expression <code>#result.id</code> to retrieve the primary key of
the <code>Event</code> as it was persisted. Thus, the saved <code>Event</code> is added to the cache named <code>events</code> and ultimately also
returned and printed to the console:</p>
</div>
<div class="listingblock">
<div class="title">Return result of the created event</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json"> {
   "id" : 1,
   "title" : "First Event",
   "date" : "2020-11-30T00:00:00.000+00:00"
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>We see that an Event with the id <code>1</code> was successfully created. Let&#8217;s verify that the <em>cache put</em> worked by inspecting
the cache using the open-source tool <a href="https://visualvm.github.io/">VisualVM</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/visual-vm-cache-put.png" alt="VisuamVM">
</div>
<div class="title">Figure 1. VisualVM - Cache Put</div>
</div>
<div class="paragraph">
<p>Under the <code>MBeans</code> tab you will find the Cache MBeans, including and entry for the <code>events</code> cache,
providing numerous statistical information regarding the cache.</p>
</div>
<div class="listingblock">
<div class="title">Retrieving Cache Statistics</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> $ curl --request GET 'http://localhost:8080/api/statistics/events'</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see an entry for <code>TotalPuts</code> of <code>1</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When using VisualVM consider installing the respective
<a href="https://medium.com/oracle-coherence/open-source-coherence-visualvm-plugin-released-533ea2f576bc">Coherence VisualVM Plugin</a>
as it provides some additional insights and visualizations.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next, lets retrieve the Event using id 1:</p>
</div>
<div class="listingblock">
<div class="title">Retrieve Event</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> curl --request GET 'http://localhost:8080/api/events/1'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Event is returned. Did you notice? No SQL queries were executed as the value was directly retrieved from the Cache.
Let&#8217;s check the statistics again, this time via the Coherence VisualVM Plugin:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/visual-vm-cache-get-value.png" alt="VisuamVM Get Value From Cache">
</div>
<div class="title">Figure 2. Cache Statistics via Coherence VisualVM Plugin</div>
</div>
<div class="paragraph">
<p>We will see now how values are being returned from the cache by seeing increasing cacheHits, e.g., <code>"cacheHits" : 1</code>.
Let&#8217;s evict our Event with id 1 from the cache named events:</p>
</div>
<div class="listingblock">
<div class="title">Evict Event</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> curl --request DELETE 'http://localhost:8080/api/events/1'</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you now retrieve the event again using:</p>
</div>
<div class="listingblock">
<div class="title">Retrieve Event</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> curl --request GET 'http://localhost:8080/api/events/1'</code></pre>
</div>
</div>
<div class="paragraph">
<p>you will see an SQL query executed in the console, re-populating the cache. Feel free to play along with the Rest API. We
can, for example, add people:</p>
</div>
<div class="listingblock">
<div class="title">Add people</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> curl --request POST 'http://localhost:8080/api/people?firstName=Conrad&amp;lastName=Zuse&amp;age=85'
 curl --request POST 'http://localhost:8080/api/people?firstName=Alan&amp;lastName=Turing&amp;age=41'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">List people</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> curl --request GET 'http://localhost:8080/api/people'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or assign people to events:</p>
</div>
<div class="listingblock">
<div class="title">Assign People to Events</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> curl --request POST 'http://localhost:8080/api/people/2/add-to-event/1'
 curl --request POST 'http://localhost:8080/api/people/3/add-to-event/1'</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="behind-the-scenes"><a class="anchor" href="#behind-the-scenes"></a>2.3. Behind the Scenes</h3>
<div class="paragraph">
<p>What is involved to make this all work? Using Spring Boot, the setup is incredibly simple. We take advantage of Spring Boot&#8217;s
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#using-boot-auto-configuration">AutoConfiguration</a>
capabilities, and the sensible defaults provided by <em>Coherence Spring</em>.</p>
</div>
<div class="paragraph">
<p>In order to activate AutoConfiguration for Coherence Spring you need to add the <code>coherence-spring-boot-starter</code>
dependency as well as the desired dependency for Coherence.</p>
</div>
<div class="listingblock">
<div class="title">POM configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"> &lt;dependency&gt;
     &lt;groupId&gt;com.oracle.coherence.spring&lt;/groupId&gt;
     &lt;artifactId&gt;coherence-spring-boot-starter&lt;/artifactId&gt; <i class="conum" data-value="1"></i><b>(1)</b>
     &lt;version&gt;4.1.2-SNAPSHOT&lt;/version&gt;
 &lt;/dependency&gt;
 &lt;dependency&gt;
     &lt;groupId&gt;com.oracle.coherence.ce&lt;/groupId&gt;
     &lt;artifactId&gt;coherence&lt;/artifactId&gt;                     <i class="conum" data-value="2"></i><b>(2)</b>
     &lt;version&gt;23.09.2&lt;/version&gt;
 &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Activate Autoconfiguration by adding the <code>coherence-spring-boot-starter</code> dependency</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add the desired version of Coherence (CE or Commercial)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this quickstart example we are using Spring&#8217;s Caching abstraction and therefore, we
use the <code>spring-boot-starter-cache</code> dependency as well:</p>
</div>
<div class="listingblock">
<div class="title">POM configuration for Spring Cache Abstraction</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"> &lt;dependency&gt;
     &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
     &lt;artifactId&gt;spring-boot-starter-cache&lt;/artifactId&gt;
 &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For caching you also must activate caching using the <code>@EnableCaching</code> annotation.</p>
</div>
<div class="listingblock">
<div class="title">Spring Boot App configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"> @SpringBootApplication
 @EnableCaching                                             <i class="conum" data-value="1"></i><b>(1)</b>
 public class CoherenceSpringBootDemoApplication {

     public static void main(String[] args) {
         SpringApplication.run(CoherenceSpringBootDemoApplication.class, args);
     }

 }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Activate the Spring Cache Abstraction</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please see the relevant chapter on
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-caching">Caching</a> in the Spring Boot
reference guide.</p>
</div>
<div class="paragraph">
<p>With <code>@EnableCaching</code> in place, Coherence&#8217;s autoconfiguration will also provide a <code>CoherenceCacheManager</code> bean to the
application context.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="coherence-spring"><a class="anchor" href="#coherence-spring"></a>3. Coherence Spring Core</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section dives into the Coherence Spring Core module. Coherence Spring Core
provides the basic support for the <a href="https://spring.io/projects/spring-framework/">Spring Framework</a>.</p>
</div>
<div class="sect2">
<h3 id="coherence-spring-introduction"><a class="anchor" href="#coherence-spring-introduction"></a>3.1. Getting Started</h3>
<div class="paragraph">
<p>To add support for Oracle Coherence to an existing Spring Framework project, you should first add the required Spring
Coherence dependencies to your build configuration:</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. Coherence Spring Dependencies</div>
<div class="content">
<div class="listingblock primary">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.oracle.coherence.spring&lt;/groupId&gt;
    &lt;artifactId&gt;coherence-spring-core&lt;/artifactId&gt;
    &lt;version&gt;4.1.2-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">implementation("com.oracle.coherence.spring:coherence-spring-core:4.1.2-SNAPSHOT")</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Next you also need to add the version of Coherence that your application will be using. Coherence Spring is compatible
with both the open source Coherence CE and the commercial version of Oracle Coherence. Therefore, we don&#8217;t bring in
Oracle Coherence as transitive dependency. For example, to use Coherence CE specify:</p>
</div>
<div class="exampleblock">
<div class="title">Example 2. Oracle Coherence CE Dependency</div>
<div class="content">
<div class="listingblock primary">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.oracle.coherence.ce&lt;/groupId&gt;
    &lt;artifactId&gt;coherence&lt;/artifactId&gt;
    &lt;version&gt;23.09.2&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">implementation("com.oracle.coherence.ce:coherence:23.09.2")</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In order to use the commercial version of Coherence:</p>
</div>
<div class="exampleblock">
<div class="title">Example 3. Commercial Oracle Coherence Dependency</div>
<div class="content">
<div class="listingblock primary">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.oracle.coherence&lt;/groupId&gt;
    &lt;artifactId&gt;coherence&lt;/artifactId&gt;
    &lt;version&gt;14.1.1.2206&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">implementation("com.oracle.coherence.ce:coherence:14.1.1.2206")</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Coherence CE versions are available from Maven Central. The commercial versions of Coherence needs to be uploaded
into your own Maven repository.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Coherence Spring requires as a minimum version <strong>Coherence CE</strong> <code>22.06</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="coherence-spring-botstrap"><a class="anchor" href="#coherence-spring-botstrap"></a>3.2. Bootstrapping Coherence</h3>
<div class="paragraph">
<p>Coherence Spring uses the Coherence bootstrap API introduced in Coherence CE <code>20.12</code> to
configure and create Coherence instances. This means that Coherence resources in a Spring application are typically
part of a Coherence Session.</p>
</div>
<div class="paragraph">
<p>By default, Coherence will start a single Session configured to use the default Coherence configuration file. This
behavior can easily be configured using traditional Coherence using system properties or using dedicated configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="coherence-spring-botstrap-with-default-session"><a class="anchor" href="#coherence-spring-botstrap-with-default-session"></a>3.3. Using the Default Session</h3>
<div class="paragraph">
<p>The main building block for setting up Coherence for Spring is the <code>@EnableCoherence</code> annotation. This annotation will
import the <code>CoherenceSpringConfiguration</code> class under the covers. Therefore, you can alternatively also declare
<code>@Import(CoherenceSpringConfiguration.class)</code> instead.</p>
</div>
<div class="paragraph">
<p>In most use-cases, only a single Coherence Session is expected to be used. Therefore, without providing any further
configuration the default session is configured using the embedded default configuration file. This results in the application
joining Coherence as a <em>cluster</em> member (Session type <code>SERVER</code>). This is of course not the only way. Coherence Spring support
the following 2 session types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>SERVER</strong> - Join as Coherence cluster member. This is the default session type.</p>
</li>
<li>
<p><strong>CLIENT</strong> - Connect to Coherence as a Coherence*Extend or gRPC client</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In order to configure the type of your Session, you may declare a <code>SessionConfigurationBean</code> that allows to you to not only
to set the session type but also to specify a custom Coherence configuration file or a custom session name.</p>
</div>
<div class="listingblock">
<div class="title">SessionConfigurationBean</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"> @Bean
 SessionConfigurationBean sessionConfigurationBeanDefault() {
     final SessionConfigurationBean sessionConfigurationBean =
             new SessionConfigurationBean();
     sessionConfigurationBean.setType(SessionType.SERVER);
     sessionConfigurationBean.setConfig("test-coherence-config.xml");
     return sessionConfigurationBean;
 }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="coherence-spring-botstrap-with-multiple-session"><a class="anchor" href="#coherence-spring-botstrap-with-multiple-session"></a>3.4. Configure Multiple Sessions</h3>
<div class="paragraph">
<p>If you need to configure multiple Coherence sessions, simply define multiple <code>SessionConfigurationBeans</code>. The auto-configuration
will pick those up automatically to configure the required sessions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>default</code> session will only exist when zero sessions are specifically configured, or the default session is
specifically configured with the default session name.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="coherence-spring-bootstrap-session-config-properties"><a class="anchor" href="#coherence-spring-bootstrap-session-config-properties"></a>3.5. Session Configuration Bean Properties</h3>
<div class="paragraph">
<p>Depending on the session type the available properties change a bit. The following properties all to ALL session types.</p>
</div>
<div class="paragraph">
<p><strong>name</strong></p>
</div>
<div class="paragraph">
<p>The name of the session. If not set, it will be set to the default session name which is an empty String.</p>
</div>
<div class="paragraph">
<p><strong>scopeName</strong></p>
</div>
<div class="paragraph">
<p>A scope name is typically used in an application where the Coherence cluster member has multiple sessions. The scope
name is used to keep the sessions separate. The scope name will be applied to the session’s underlying
<em>ConfigurableCacheFactory</em> and used to scope Coherence services. In this way multiple session configurations may use
identical service names, which will be kept separate using the scope. On a Coherence cluster member, each session should
have a unique scope name.</p>
</div>
<div class="paragraph">
<p><strong>type</strong></p>
</div>
<div class="paragraph">
<p>The session type of this configuration. There are three different types of sessions that can be configured:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>server</strong> represents storage enabled cluster member session.</p>
</li>
<li>
<p><strong>client</strong> represents a storage disabled cluster member or Coherence*Extend client session.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The type of the session affects how the bootstrap API starts the session.</p>
</div>
<div class="paragraph">
<p><strong>priority</strong></p>
</div>
<div class="paragraph">
<p>The priority specifies the order to use, when starting the session. Sessions will be started with the lowest priority
first. If this property is not specified, the property will default to <code>0</code>.</p>
</div>
<div class="paragraph">
<p>The following property applies to the <code>CLIENT</code> (Coherence*Extend) and <code>Server</code> mode, only:</p>
</div>
<div class="paragraph">
<p><strong>configUri</strong></p>
</div>
<div class="paragraph">
<p>The Coherence cache configuration URI for the session. As already mentioned, the most common configuration to set will
be the Coherence configuration file name. If not specified, the default value will be <code>coherence-cache-config.xml</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="coherence-spring-dependency-injection"><a class="anchor" href="#coherence-spring-dependency-injection"></a>3.6. Dependency Injection</h3>
<div class="paragraph">
<p>Coherence Spring provides comprehensive support for the injection Coherence objects into your Spring beans including:
<code>Session</code>, <code>NamedMap</code>, <code>NamedCache</code>, <code>ContinuousQueryCache</code>, <code>ConfigurableCacheFactory</code>, <code>Cluster</code>.</p>
</div>
<div class="paragraph">
<p>For the most part, you can use the equivalent Coherence Spring annotation that match the annotations from Coherence&#8217;s CDI
or Micronaut support.</p>
</div>
<div class="sect3">
<h4 id="coherence-spring-dependency-injection-namedmap-namedcache"><a class="anchor" href="#coherence-spring-dependency-injection-namedmap-namedcache"></a>3.6.1. Injecting NamedMap and NamedCache</h4>
<div class="paragraph">
<p>Coherence <code>NamedMap</code> and <code>NamedCache</code> instances can be injected as beans in Spring applications. The mechanics of injecting
<code>NamedMap</code> or <code>NamedCache</code> beans is identical, so any use of <code>NamedCache</code> in the examples below can be replaced with <code>NamedMap</code>.
Other more specialized forms of <code>NamedMap</code> and <code>NamedCache</code> can also be injected, for example the asynchronous forms of
both classes and views.</p>
</div>
<div class="paragraph">
<p>In Spring one caveat exists regarding the injection of Map-based classes that directly inherit from <code>java.util.Map</code>
including <code>NamedCache</code> and <code>NamedMap</code> when using the <code>@Autowired</code> annotation. Instead of injecting actual instances of
Beans representing a <code>java.util.Collection</code> or <code>java.util.Map</code>, Spring will inject a collection of all the beans that
represent the specified bean type instead. As a work-around, you can use the <code>@Resource</code> annotation, but it has its own
limitations, for instance, not being usable for constructor injection.</p>
</div>
<div class="listingblock">
<div class="title">Example of using the @Resource annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @Resource(name = COHERENCE_CACHE_BEAN_NAME)
    private NamedCache numbers;                  <i class="conum" data-value="1"></i><b>(1)</b>

    @Resource(name = COHERENCE_CACHE_BEAN_NAME)
    @Name("numbers")                             <i class="conum" data-value="2"></i><b>(2)</b>
    private NamedCache namedCache;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>If not specified, the name of the field will be used to determine the cache name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Alternatively, you can specify the name of the cache using the <code>@Name</code> annotation</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For more information, please see <a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-autowired-annotation-qualifiers">Fine-tuning
Annotation-based Autowiring with Qualifiers</a> in the Spring Framework reference guide.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In order to provide a better user-experience around the dependency injection of maps and caches, Coherence Spring introduces its
own set of annotations. The following annotations are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>@CoherenceCache</p>
</li>
<li>
<p>@CoherenceMap</p>
</li>
<li>
<p>@CoherenceAsyncCache</p>
</li>
<li>
<p>@CoherenceAsyncMap</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using these annotations, you can inject any Coherence <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/NamedMap.html">NamedMap</a> and
<a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/NamedCache.html">NamedCache</a> in any situation including constructors.</p>
</div>
<div class="paragraph">
<p>Furthermore, the annotations also give you some added conveniences such as the ability to specify the name of the cache, or
the name of the Coherence session as part of the annotation. E.g., the above example can be simplified to:</p>
</div>
<div class="listingblock">
<div class="title">Example of using the  @CoherenceCache annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @CoherenceCache
    private NamedCache numbers;                  <i class="conum" data-value="1"></i><b>(1)</b>

    @CoherenceCache("numbers")                   <i class="conum" data-value="2"></i><b>(2)</b>
    private NamedCache namedCache;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>If not specified, the name of the field will be used to determine the cache name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Alternatively, you can specify the name of the cache using the <code>@Name</code> annotation</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>All the annotations <code>@CoherenceCache</code>, <code>@CoherenceMap</code>, <code>@CoherenceAsyncCache</code>, and <code>@CoherenceAsyncMap</code> are themselves
annotated with <code>@Lazy</code>. This is to avoid deadlocks where a cache bean requires another bean to be injected in its
configuration, which will happen on a different thread to the main Spring thread. A consequence of this is that all
cache beans will be Spring lazy dynamic proxies.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="coherence-spring-dependency-injection-type-conversion"><a class="anchor" href="#coherence-spring-dependency-injection-type-conversion"></a>3.6.1.1. Type Conversion of NamedMap and NamedCache</h5>
<div class="paragraph">
<p>As mentioned previously, Spring a has a special relationship with Map implementations. In order to work around this
limitation, we provide the meta-annotations <code>@CoherenceCache</code>, <code>@CoherenceMap</code> etc. We apply a little trick using the
<code>@Value</code> annotation and referencing the injection candidate via a <code>SpEL</code> expression. This in turn, however, triggers type
conversion in Spring&#8217;s <code>DefaultListableBeanFactory</code>, and we must provide a no-op converter for Map-based Coherence objects
using the <code>CoherenceGenericConverter</code>.</p>
</div>
<div class="paragraph">
<p>Without it, you may see Spring&#8217;s <code>MapToMapConverter</code> being used, which in turn will call <code>Map#entrySet()</code>, a potentially
very expensive operation for large datasets in a Coherence cluster.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When defining your own <code>ConversionService</code> bean, please make sure that the <code>CoherenceGenericConverter</code> is added to it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the <code>BeanFactory</code> already contains a <code>ConfigurableConversionService</code>, we will add the <code>CoherenceGenericConverter</code> automatically
using the <code>CoherenceConversionServicePostProcessor</code>. This should be typically the case with Spring Boot, which provides
the <code>ApplicationConversionService</code>. If you provide your own <code>ConversionService</code> bean, we will back-off and a message to
add the <code>CoherenceGenericConverter</code> manually will be logged.</p>
</div>
<div class="listingblock">
<div class="title">Manually adding the <code>CoherenceGenericConverter</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @Bean
    public ConversionService conversionService() {
        DefaultFormattingConversionService conversionService =
            new DefaultFormattingConversionService();
        conversionService.addConverter(new CoherenceGenericConverter());   <i class="conum" data-value="1"></i><b>(1)</b>
        return conversionService;
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Adding a new instance of the CoherenceGenericConverter</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In case no <code>ConversionService</code> is defined in your application context, PropertyEditors are being used, and that chain
does not seem to trigger the same expensive operation, nonetheless using the <code>ConversionService</code> route is advised.</p>
</div>
</div>
<div class="sect4">
<h5 id="specify-the-mapcache-name"><a class="anchor" href="#specify-the-mapcache-name"></a>3.6.1.2. Specify the Map/Cache Name</h5>
<div class="paragraph">
<p>As already mentioned above, you specify the name of the map/cache using the value-property of the annotation. Of course,
the same applies when injecting a constructor or method parameter:</p>
</div>
<div class="listingblock">
<div class="title">Example of constructor injection of a NamedMap</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Service
public class SomeService {

    public SomeService(@CoherenceMap("people") NamedMap&lt;String, Person&gt; map) {
        // TODO: initialize the service...
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If injecting a cache/map via the constructor, AND you do not specify a cache/map name, then Coherence Spring
will try to derive the name of the cache/map from the parameter name. However, this only works if either the compiler flag
<code>-parameters</code> (Java 8+) is enabled, or if the JVM generates debugging info. For more information see the
article <a href="https://www.baeldung.com/java-parameter-reflection">Method Parameter Reflection in Java</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you prefer, you can also specify the name of the map/cache using the <code>@Name</code> annotation. The example below will inject a
<code>NamedMap</code> that uses an underlying cache named people:</p>
</div>
<div class="listingblock">
<div class="title">Example of using the @Name annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceMap
@Name("people")
private NamedMap&lt;String, Person&gt; map;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="specify-the-owning-session-name"><a class="anchor" href="#specify-the-owning-session-name"></a>3.6.1.3. Specify the Owning Session Name</h5>
<div class="paragraph">
<p>Whilst most applications probably use a single Coherence Session, there are uses-cases where an application may have
multiple sessions. In this case, when injecting for example a <code>NamedMap</code>, the specific session can be specified by
annotating the injection point with either <code>@SessionName</code> or more concise with the <code>session</code> parameter available for the
following annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>@CoherenceCache</p>
</li>
<li>
<p>@CoherenceMap</p>
</li>
<li>
<p>@CoherenceAsyncCache</p>
</li>
<li>
<p>@CoherenceAsyncMap</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the previous examples where no separate <code>Session</code> name was specified, Coherence will use the default session to obtain the
caches/maps. Assuming that the application has multiple sessions configured, one of which is named <em>Catalog</em>, the
following example injects a <code>NamedMap</code> from an underlying cache named <em>products</em> in the <em>Catalog</em> session.</p>
</div>
<div class="listingblock">
<div class="title">Example of using the @SessionName annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceMap
@SessionName("Catalog")
@Name("products")
private NamedMap&lt;String, Product&gt; map;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This can be further streamlined to:</p>
</div>
<div class="listingblock">
<div class="title">Example of using the @CoherenceMap annotation with the session parameter</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceMap(name="products", session="Catalog")
private NamedMap&lt;String, Product&gt; map;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same annotation can be used on method parameter injection points as well:</p>
</div>
<div class="listingblock">
<div class="title">Example of using @CoherenceMap with session parameter in a constructor</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Controller
public class CatalogController {

    public CatalogController(@CoherenceMap(name="products", session="Catalog")
                             NamedMap&lt;String, Product&gt; products) {
        // TODO: initialize the bean...
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="coherence-spring-dependency-injection-asyncnamedmap-asyncnamedcache"><a class="anchor" href="#coherence-spring-dependency-injection-asyncnamedmap-asyncnamedcache"></a>3.6.2. Injecting AsyncNamedMap &amp; AsyncNamedCache</h4>
<div class="paragraph">
<p>It is possible to inject the asynchronous classes <code>AsyncNamedMap</code> and <code>AsyncNamedCache</code> as beans in exactly the same way as
described above. Just change the type of the injection point to be <code>AsyncNamedMap</code> or <code>AsyncNamedCache</code> using one of
the following annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>@CoherenceAsyncCache</p>
</li>
<li>
<p>@CoherenceAsyncMap</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Injecting an AsyncNamedMap</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceAsyncMap("people")
private AsyncNamedMap&lt;String, Person&gt; map;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="coherence-spring-dependency-injection-views"><a class="anchor" href="#coherence-spring-dependency-injection-views"></a>3.6.3. Injecting Views (CQC)</h4>
<div class="paragraph">
<p>View (or <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/cache/ContinuousQueryCache.html">ContinuousQueryCache</a>) beans can be injected by
specifying the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/View.html">@View</a> annotation at the injection
point. A view is a sub-set of the data in an underlying cache, controlled by a
<a href="https://coherence.community/23.09.2/api/java/com/tangosol/util/Filter.html">Filter</a>.</p>
</div>
<div class="listingblock">
<div class="title">Injecting an AsyncNamedMap</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceMap("people")
@View                                            <i class="conum" data-value="1"></i><b>(1)</b>
private NamedMap&lt;String, Person&gt; map;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The injection point has been annotated with <code>@View</code>, so the injected <code>NamedMap</code> will actually be an implementation
of a <code>ContinuousQueryCache</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the above example, no <code>Filter</code> has been specified, so the default behaviour is to use an
<a href="https://coherence.community/23.09.2/api/java/com/tangosol/util/filter/AlwaysFilter.html">AlwaysFilter</a>. This means that the view will contain all the
entries from the underlying cache (typically a distributed cache). As a <code>ContinuousQueryCache</code> will hold keys and values
locally in deserialized form, this can often be a better approach than using a replicated cache.</p>
</div>
<div class="sect4">
<h5 id="coherence-spring-dependency-injection-views-filter"><a class="anchor" href="#coherence-spring-dependency-injection-views-filter"></a>3.6.3.1. Specify a View Filter</h5>
<div class="paragraph">
<p>Filters are specified for views using a special filter binding annotation. These are annotations that are themselves
annotated with the meta-annotation <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/FilterBinding.html">@FilterBinding</a>.
Coherence Spring comes with some built in implementations, for example
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/AlwaysFilter.html">@AlwaysFilter</a> and
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/WhereFilter.html">@WhereFilter</a>. It is simple to
implement custom Filters as required by applications (see the <a href="#create-the-filter-binding-annotation">Filter Binding Annotation section</a>
for more details).</p>
</div>
<div class="paragraph">
<p>For example, if there was a cache named "people", containing <code>Person</code> instances, and the application required a view of
that cache to just contain <code>People</code> where the "lastName" attribute is equal to "Simpson", then the <code>@WhereFilter</code> filter binding
annotation could be used to specify the <code>Filter</code>. The <code>@WhereFilter</code> annotation produces a <code>Filter</code> created from a Coherence
CohQL where-clause, in this case <code>lastName == 'Simpson'</code>.</p>
</div>
<div class="listingblock">
<div class="title">Injecting a @CoherenceMap with @WhereFilter</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @CoherenceMap("people")                                  <i class="conum" data-value="1"></i><b>(1)</b>
    @View                                                    <i class="conum" data-value="2"></i><b>(2)</b>
    @WhereFilter("lastName = 'Simpson'")                     <i class="conum" data-value="3"></i><b>(3)</b>
    private NamedMap&lt;String, Person&gt; allSimpsons;            <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The name of the underlying map for the view is "people".</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>@View</code> annotation specifies that a view will be injected rather than a raw`NamedMap`.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>@WhereFilter</code> annotation specifies the CohQL expression.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>NamedMap</code> contains only people with the last name <code>Simpson</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above CohQL expression is still rather simple. Let&#8217;s further restrict the results:</p>
</div>
<div class="listingblock">
<div class="title">@WhereFilter with a more complex CohQL expression</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @CoherenceMap("people")
    @View
    @WhereFilter("lastName = 'Simpson' and age &gt; 10")        <i class="conum" data-value="1"></i><b>(1)</b>
    private NamedMap&lt;String, Person&gt; simpsons;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The @WhereFilter also filters on the <code>age</code> property.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The view injected above will be all People with a <code>lastName</code> attribute equal to <code>Simpson</code> and an <code>age</code> attribute
greater than <code>10</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The Coherence reference guide has an in-depth chapter on CohQL and more details on the <em>WHERE</em> clause under
<a href="https://docs.oracle.com/en/middleware/standalone/coherence/14.1.1.2206/develop-applications/using-coherence-query-language.html#GUID-B671FDD9-386B-4719-BFC6-DCFF32C360BA">Filtering Entries in a Result Set</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Other built-in or custom filter binding annotations can be combined as well and multiple filter-binding annotations can
be added to the same injection point to build up more complex views. The Filter instances produced from each filter
binding annotation will all be collected together in an <a href="https://coherence.community/23.09.2/api/java/com/tangosol/util/filter/AllFilter.html">AllFilter</a>,
which will logically combine them together.</p>
</div>
</div>
<div class="sect4">
<h5 id="coherence-spring-dependency-injection-views-transformer"><a class="anchor" href="#coherence-spring-dependency-injection-views-transformer"></a>3.6.3.2. Specify a View Transformer</h5>
<div class="paragraph">
<p>The values in a view map do not have to be the same as the values in the underlying cache. Instead, a ValueExtractor can be used
to transform the actual cache value into a different value in the view. ValueExtractors are specified for views using a
special extractor binding annotation. These are annotations that are themselves annotated with the meta-annotation
@ExtractorBinding. The Coherence Spring framework comes with some built in implementations, for example @PropertyExtractor,
and it is simple to implement other as required by applications (see the Extractor Binding Annotation section for more details).</p>
</div>
<div class="paragraph">
<p>For example, if there was a cache named "people", containing Person instances, and the application required a view where
the value was just the age attribute of each Person rather than the whole cache value. A @PropertyExtractor annotation
could be used to specify that the values should be transformed using a property extractor.</p>
</div>
<div class="listingblock">
<div class="title">Injecting a @CoherenceMap with multiple @WhereFilter</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @CoherenceMap("people")                                  <i class="conum" data-value="1"></i><b>(1)</b>
    @View                                                    <i class="conum" data-value="2"></i><b>(2)</b>
    @PropertyExtractor("age")                                <i class="conum" data-value="3"></i><b>(3)</b>
    private NamedMap&lt;String, Integer&gt; ages;                  <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The name of the underlying map for the view is "people".</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>@View</code> annotation specifies that a view will be injected rather than a raw <code>NamedMap</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>@PropertyExtractor</code> annotation specifies that a <code>ValueExtractor</code> should be used to transform the underlying cache
values into different values in the view. In this case the <code>@PropertyExtractor</code> annotation will produce a value extractor
to extract the <code>age</code> property.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Note that the map injected is now a <code>NamedMap&lt;String, Integer&gt;</code> with generic types of <code>String</code> and <code>Integer</code> because
the values have been transformed from <code>Person</code> to <code>Integer</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Multiple extractor bindings can be applied to the injection point, in which case the view value will be a <code>List</code> of the
extracted attributes.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="coherence-spring-dependency-injection-session"><a class="anchor" href="#coherence-spring-dependency-injection-session"></a>3.6.4. Injecting a Session</h4>
<div class="paragraph">
<p>Sometimes it might not be possible to inject a Coherence resource, such as <code>NamedMap</code> or <code>NamedCache</code> directly because
the name of the resource to be injected is not known until runtime. In this case it makes sense to inject a <code>Session</code>
instance which can then be used to obtain other resources.</p>
</div>
<div class="paragraph">
<p>The simplest way to inject a <code>Session</code> is to annotate a field, method parameter, or other injection point with your preferred
Spring-supported injection annotation such as <code>@Autowired</code> or <code>@Inject</code>:</p>
</div>
<div class="listingblock">
<div class="title">Injecting a Coherence Session instance</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@RestController
public class MyBean {
    @Inject                                      <i class="conum" data-value="1"></i><b>(1)</b>
    private Session session;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Other injection annotations such as <code>@Autowired</code> can be used as well</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Injecting a Coherence Session using constructor injection</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@RestController
public class MyBean {
    @Autowired                                   <i class="conum" data-value="1"></i><b>(1)</b>
    public MyBean(Session session) {
        // TODO...
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>If your class has only a single constructor, you can even omit the <code>@Autowired</code> annotation</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Both examples above will inject the default <code>Session</code> instance into the injection point.</p>
</div>
<div class="sect4">
<h5 id="coherence-spring-dependency-injection-session-with-name"><a class="anchor" href="#coherence-spring-dependency-injection-session-with-name"></a>3.6.4.1. Specify a Session Name</h5>
<div class="paragraph">
<p>For most applications that only use a single <code>Session</code> the simple examples above will be all that is required. Some
applications though may use multiple named Session instances, in which case the <code>Session</code> name need to be specified. This
can be done by adding the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/Name.html">@Name</a> annotation to
the injection point.</p>
</div>
<div class="listingblock">
<div class="title">Injecting a specific (named) Coherence Session</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@RestController
public class MyBean {
    @Autowired                                   <i class="conum" data-value="1"></i><b>(1)</b>
    @Name("Catalog")
    private Session session;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Other injection annotations such as <code>@Inject</code> can be used as well</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>or into a constructor:</p>
</div>
<div class="listingblock">
<div class="title">Injecting a specific (named) Coherence Session via constructor</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@RestController
public class MyBean {
    @Autowired                                   <i class="conum" data-value="1"></i><b>(1)</b>
    public MyBean(@Name("Catalog") Session session) {
        // TODO...
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>If your class has only a single constructor, you can even omit the <code>@Autowired</code> annotation</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="coherence-spring-dependency-injection-namedtopic"><a class="anchor" href="#coherence-spring-dependency-injection-namedtopic"></a>3.6.5. Injecting NamedTopic</h4>
<div class="paragraph">
<p>Coherence <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/topic/NamedTopic.html">NamedTopic</a>
instances can be injected as beans in Spring applications.</p>
</div>
<div class="paragraph">
<p>An alternative way to write message driven applications instead of directly injecting <code>NamedTopic</code>, <code>Publisher</code> or <code>Subscriber</code> beans is to use <a href="#coherence-spring-messaging-with-coherence-topics">Messaging with Coherence Topics</a>.</p>
</div>
<div class="sect4">
<h5 id="injecting-namedtopic"><a class="anchor" href="#injecting-namedtopic"></a>3.6.5.1. Injecting NamedTopic</h5>
<div class="paragraph">
<p>The simplest way to inject a <code>NamedTopic</code> is to just annotate the injection point with <code>@javax.inject.Inject</code>.</p>
</div>
<div class="listingblock">
<div class="title">Inject NamedTopic</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
private NamedTopic&lt;Person&gt; people;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example the injection point field name is used to determine the topic name to inject,
so a <code>NamedTopic</code> bean with an underlying topic name of <code>people</code> will be injected.</p>
</div>
<div class="paragraph">
<p>As an alternative to using a <code>NamedTopic</code> directly in code, Coherence Spring also supports annotating methods directly as publishers and subscribers. See the <a href="#coherence-spring-messaging-with-coherence-topics">Messaging with Coherence Topics</a> section of the documentation.</p>
</div>
<div class="sect5">
<h6 id="specify-the-topic-name"><a class="anchor" href="#specify-the-topic-name"></a>Specify the Topic Name</h6>
<div class="paragraph">
<p>Sometimes the name of the topic being injected needs to be different to the injection point name.
This is always the case when injecting into method parameters as the parameter names are lost by the time the injection point is processed. In this case we can use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/Name.html">@Name</a>
annotation to specify the underlying cache name.</p>
</div>
<div class="paragraph">
<p>The example below will inject a <code>NamedTopic</code> that uses an underlying topic named <code>orders</code>.</p>
</div>
<div class="listingblock">
<div class="title">Use @Name to specify topic name</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@Name("people")
private NamedTopic&lt;Order&gt; orders;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same applies when injecting a constructor or method parameter:</p>
</div>
<div class="listingblock">
<div class="title">Use @Name to specify topic name on a parameter</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
public class SomeBean {
    @Inject
    public SomeBean(@Name("orders") NamedTopic&lt;Order&gt; topic) {
    // ToDo:
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="specify-the-session-name"><a class="anchor" href="#specify-the-session-name"></a>Specify the Session Name</h6>
<div class="paragraph">
<p>Whilst most applications probably use a single Coherence <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/Session.html">Session</a> there are uses-cases where an application may
have multiple sessions. In this case, when injecting a <code>NamedTopic</code> the specific session can be specified
by annotating the injection point with <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/SessionName.html">@SessionName</a>.</p>
</div>
<div class="paragraph">
<p>In the previous examples where no <code>@SessionName</code> was specified Coherence will use the default session to obtain the caches.</p>
</div>
<div class="paragraph">
<p>For example, assume the application has multiple sessions configured, one of which is named <code>Customers</code>.
The following code snippet injects a <code>NamedTopic</code> using an underlying topic named <code>orders</code> in the <code>Customers</code> session.</p>
</div>
<div class="listingblock">
<div class="title">Use @SessionName to specify session</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@SessionName("Customers")
@Name("orders")
private NamedTopic&lt;Order&gt; topic;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, the same annotation can be used on method parameter injection points.</p>
</div>
<div class="listingblock">
<div class="title">Use @SessionName to specify session on a method parameter</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Controller
public class OrderProcessor {
    @Inject
    public OrderProcessor(@SessionName("Customers") @Name("orders")
                          NamedTopic&lt;Order&gt; orders) {
        // ToDo:
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="injecting-a-namedtopic-publisher"><a class="anchor" href="#injecting-a-namedtopic-publisher"></a>3.6.5.2. Injecting a NamedTopic Publisher</h5>
<div class="paragraph">
<p>If application code only needs to publish messages to a Coherence <code>NamedTopic</code> then instead of injecting a
<code>NamedTopic</code> bean, a <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/topic/Publisher.html">Publisher</a> bean can be injected.</p>
</div>
<div class="paragraph">
<p>The simplest way to inject a <code>Publisher</code> is just to annotate the injection point of type <code>Publisher</code> with <code>@Inject</code>,
for example:</p>
</div>
<div class="listingblock">
<div class="title">Inject a Publisher</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
private Publisher&lt;Order&gt; orders;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above will inject a <code>Publisher</code> bean, the name of the underlying <code>NamedTopic</code> will be taken from the
name of the injection point, in this case <code>orders</code>.</p>
</div>
<div class="sect5">
<h6 id="specify-the-topic-name-2"><a class="anchor" href="#specify-the-topic-name-2"></a>Specify the Topic Name</h6>
<div class="paragraph">
<p>If the name of the injection point cannot be used as the <code>NamedTopic</code> name, which is always the case with injection points that are method or constructor parameters, then the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/Name.html">@Name</a> annotation can be used to specify the topic name.</p>
</div>
<div class="paragraph">
<p>For example, both of the code snippets below inject a <code>Publisher</code> that published to the <code>orders</code> topic:</p>
</div>
<div class="listingblock">
<div class="title">Inject a Publisher that publishes on the <code>orders</code> topic</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@Name("orders")
private Publisher&lt;Order&gt; orders;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Inject a Publisher that publishes on the <code>orders</code> topic</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Controller
public class OrderController {
    @Inject
    public OrderController(@Name("orders") Publisher&lt;Order&gt; topic) {
        // ToDo:
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="specify-the-owning-session"><a class="anchor" href="#specify-the-owning-session"></a>Specify the Owning Session</h6>
<div class="paragraph">
<p>As with injection of <code>NamedTopics</code>, in applications using multiple <code>Session</code> instances, the name of the <code>Session</code> that
owns the underlying <code>NamedTopic</code> can be specified when injecting a <code>Publisher</code> by adding the
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/SessionName.html">@SessionName</a> annotation.</p>
</div>
<div class="listingblock">
<div class="title">Inject a Publisher while specifying the owning session</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@Name("orders")
@SessionName("Customers")
private Publisher&lt;Order&gt; orders;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="injecting-a-namedtopic-subscriber"><a class="anchor" href="#injecting-a-namedtopic-subscriber"></a>3.6.5.3. Injecting a NamedTopic Subscriber</h5>
<div class="paragraph">
<p>If application code only needs to subscribe to messages from a Coherence <code>NamedTopic</code> then instead of injecting a
<code>NamedTopic</code> bean, a <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/topic/Subscriber.html">Subscriber</a> bean can be injected.</p>
</div>
<div class="paragraph">
<p>The simplest way to inject a <code>Subscriber</code> is just to annotate the injection point of type <code>Subscriber</code> with <code>@Inject</code>,
for example:</p>
</div>
<div class="listingblock">
<div class="title">Inject Subscriber</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
private Subscriber&lt;Order&gt; orders;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above will inject a <code>Subscriber</code> bean, the name of the underlying <code>NamedTopic</code> will be taken from the
name of the injection point, in this case <code>orders</code>.</p>
</div>
<div class="sect5">
<h6 id="specify-the-topic-name-3"><a class="anchor" href="#specify-the-topic-name-3"></a>Specify the Topic Name</h6>
<div class="paragraph">
<p>If the name of the injection point cannot be used as the <code>NamedTopic</code> name, which is always the case with injection points that are method or constructor parameters, then the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/Name.html">@Name</a> annotation can be used to specify the topic name.</p>
</div>
<div class="paragraph">
<p>For example, both of the code snippets below inject a <code>Subscriber</code> that subscribe to the <code>orders</code> topic:</p>
</div>
<div class="listingblock">
<div class="title">Inject subscriber into field</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@Name("orders")
private Subscriber&lt;Order&gt; orders;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Inject subscriber into method parameter</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Controller
public class OrderController {
    @Inject
    public OrderController(@Name("orders") Subscriber&lt;Order&gt; topic) {
        // ToDo:
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="specify-the-owning-session-2"><a class="anchor" href="#specify-the-owning-session-2"></a>Specify the Owning Session</h6>
<div class="paragraph">
<p>As with injection of <code>NamedTopics</code>, in applications using multiple <code>Session</code> instances, the name of the <code>Session</code> that
owns the underlying <code>NamedTopic</code> can be specified when injecting a <code>Subscriber</code> by adding the
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/SessionName.html">@SessionName</a> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@Name("orders")
@SessionName("Customers")
private Subscriber&lt;Order&gt; orders;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="injecting-spring-beans-into-coherence-managed-objects"><a class="anchor" href="#injecting-spring-beans-into-coherence-managed-objects"></a>3.7. Injecting Spring Beans into Coherence-Managed Objects</h3>
<div class="paragraph">
<p>Coherence has many server-side extension points, which enable you to customize application behavior in different ways,
typically by configuring their extensions within various sections of the cache configuration file. For example, you can
implement event interceptors and cache stores to handle server-side events and integrate with external data stores
and other services. In the previous chapter, you learned how you can inject Coherence-managed objects into your
Spring-managed beans. However, the reverse is possible as well. Coherence Spring also provides the ability to inject
Spring beans into these Coherence-managed extension points using the custom configuration namespace handler.</p>
</div>
<div class="listingblock">
<div class="title">coherence-cache-config.xml with Spring NamespaceHandler</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;cache-config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xmlns="http://xmlns.oracle.com/coherence/coherence-cache-config"
              xmlns:spring="class://com.oracle.coherence.spring.namespace.NamespaceHandler"
              xsi:schemaLocation="http://xmlns.oracle.com/coherence/coherence-cache-config coherence-cache-config.xsd"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>After you have declared the handler for the Spring namespace above, you can specify the <code>&lt;spring:bean&gt;</code> element in any
place where you would normally use the <code>&lt;class-name&gt;</code> or <code>&lt;class-factory-name&gt;</code> elements:</p>
</div>
<div class="listingblock">
<div class="title">Using Spring bean references in coherence-cache-config.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0"?&gt;
&lt;cache-config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="http://xmlns.oracle.com/coherence/coherence-cache-config"
        xmlns:spring="class://com.oracle.coherence.spring.namespace.NamespaceHandler"
        xsi:schemaLocation="http://xmlns.oracle.com/coherence/coherence-cache-config coherence-cache-config.xsd"&gt;

    &lt;interceptors&gt;
        &lt;interceptor&gt;
            &lt;instance&gt;
                &lt;spring:bean&gt;registrationListener&lt;/spring:bean&gt; <i class="conum" data-value="1"></i><b>(1)</b>
            &lt;/instance&gt;
        &lt;/interceptor&gt;
        &lt;interceptor&gt;
            &lt;instance&gt;
                &lt;spring:bean&gt;activationListener&lt;/spring:bean&gt;
            &lt;/instance&gt;
        &lt;/interceptor&gt;
    &lt;/interceptors&gt;

    &lt;caching-scheme-mapping&gt;
        &lt;cache-mapping&gt;
            &lt;cache-name&gt;*&lt;/cache-name&gt;
            &lt;scheme-name&gt;distributed-scheme&lt;/scheme-name&gt;
            &lt;init-params&gt;
                &lt;init-param&gt;
                    &lt;param-name&gt;partitionListener-bean&lt;/param-name&gt; <i class="conum" data-value="2"></i><b>(2)</b>
                    &lt;param-value&gt;partitionListener&lt;/param-value&gt;
                &lt;/init-param&gt;
            &lt;/init-params&gt;
            &lt;interceptors&gt;
                &lt;interceptor&gt;
                    &lt;instance&gt;
                        &lt;spring:bean&gt;cacheListener&lt;/spring:bean&gt;
                    &lt;/instance&gt;
                &lt;/interceptor&gt;
            &lt;/interceptors&gt;
        &lt;/cache-mapping&gt;
    &lt;/caching-scheme-mapping&gt;

    &lt;caching-schemes&gt;
        &lt;distributed-scheme&gt;
            &lt;scheme-name&gt;distributed-scheme&lt;/scheme-name&gt;
            &lt;service-name&gt;PartitionedCache&lt;/service-name&gt;
            &lt;local-storage system-property="coherence.distributed.localstorage"&gt;true&lt;/local-storage&gt;
            &lt;partition-listener&gt;
                &lt;spring:bean&gt;{partitionListener-bean}&lt;/spring:bean&gt; <i class="conum" data-value="3"></i><b>(3)</b>
            &lt;/partition-listener&gt;
            &lt;member-listener&gt;
                &lt;spring:bean&gt;memberListener&lt;/spring:bean&gt;
            &lt;/member-listener&gt;
            &lt;backing-map-scheme&gt;
                &lt;local-scheme/&gt;
            &lt;/backing-map-scheme&gt;
            &lt;autostart&gt;true&lt;/autostart&gt;
            &lt;interceptors&gt;
                &lt;interceptor&gt;
                    &lt;instance&gt;
                        &lt;spring:bean&gt;storageListener&lt;/spring:bean&gt;
                    &lt;/instance&gt;
                &lt;/interceptor&gt;
            &lt;/interceptors&gt;
        &lt;/distributed-scheme&gt;
    &lt;/caching-schemes&gt;
&lt;/cache-config&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specifying the name of the Spring bean that you want to reference.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The name of Spring beans can also be parameterized. Let&#8217;s create a parameter named <code>partitionListener-bean</code> with the name of the Spring bean as its value.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Here we reference the parameter named <code>partitionListener-bean</code> and its value will be used.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Please also take a look at the chapter discussing the
<a href="#coherence-spring-cachestore-demo">Coherence Spring Cachestore Demo</a> as it uses Spring-managed beans.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="coherence-spring-events"><a class="anchor" href="#coherence-spring-events"></a>3.8. Events</h3>
<div class="paragraph">
<p>Event driven patterns are a common way to build scalable applications and microservices. Coherence produces a number of
events that can be used by applications to respond to data changes and other actions in Coherence.</p>
</div>
<div class="paragraph">
<p>There are two types of events in Coherence:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://coherence.community/23.09.2/api/java/com/tangosol/util/MapEvent.html">MapEvents</a> which are subscribed to using a <a href="https://coherence.community/23.09.2/api/java/com/tangosol/util/MapListener.html">MapListener</a></p>
</li>
<li>
<p><a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/events/Event.html">Events</a>, which are subscribed to using an <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/events/EventInterceptor.html">EventInterceptor</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Spring makes subscribing to both of these event-types much simpler using observer methods annotated with
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/event/CoherenceEventListener.html">@CoherenceEventListener</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example of using a Coherence Event Listener</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
void onEvent(CoherenceLifecycleEvent event) {
    // TODO: process event...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The method above receives all events of type <code>CoherenceLifecycleEvent</code> emitted during the lifetime of the application. The
actual events received can be controlled further by annotating the method or the method arguments.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Spring <code>4.2</code> introduced
<a href="https://spring.io/blog/2015/02/11/better-application-events-in-spring-framework-4-2">Annotation-driven event listeners</a> as
part of its <a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#context-functionality-events">event support</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Coherence Spring does <strong>NOT</strong> directly use Spring&#8217;s <code>ApplicationEvent</code> class and the corresponding <code>ApplicationListener</code>
interface. However, Coherence Spring follows that pattern conceptually in order to provide a similar user experience.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
By default, the handling of Coherence events is asynchronous. Use the <code>@Synchronous</code> annotation to make the
event handler execution synchronous.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example of making a Coherence Event Listener synchronous</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
@Synchronous
void onEvent(CoherenceLifecycleEvent event) {
    // TODO: process event...
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="coherence-spring-events-mapevent-listeners"><a class="anchor" href="#coherence-spring-events-mapevent-listeners"></a>3.8.1. MapEvent Listeners</h4>
<div class="paragraph">
<p>Listening for changes to data in Coherence is a common use case in applications. Typically, this involves creating an
implementation of a <a href="https://coherence.community/23.09.2/api/java/com/tangosol/util/MapListener.html">MapListener</a> and adding that listener to a
<code>NamedMap</code> or <code>NamedCache</code>. Using Coherence Spring makes this much simpler by just using Spring beans with suitably
annotated observer methods that will receive the respective events.</p>
</div>
<div class="sect4">
<h5 id="mapevent-observer-methods"><a class="anchor" href="#mapevent-observer-methods"></a>3.8.1.1. MapEvent Observer Methods</h5>
<div class="paragraph">
<p>A <a href="https://coherence.community/23.09.2/api/java/com/tangosol/util/MapEvent.html">MapEvent</a> observer method is a method on a Spring bean that is
annotated with <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/event/CoherenceEventListener.html">@CoherenceEventListener</a>.
The annotated method must have a <code>void</code> return type and must take a single method parameter of type <code>MapEvent</code>, typically
this has the generic types of the underlying map/cache key and value.</p>
</div>
<div class="paragraph">
<p>For example, assuming that there is a map/cache named <code>people</code>, with keys of type <code>String</code> and values of type <code>Plant</code>,
and the application has logic that should be executed each time a new <code>Plant</code> is inserted into the map:</p>
</div>
<div class="listingblock">
<div class="title">Example of listening to Inserted events</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import com.oracle.coherence.spring.annotation.event.Inserted;
import com.oracle.coherence.spring.annotation.event.MapName;
import com.oracle.coherence.spring.event.CoherenceEventListener;
import com.tangosol.util.MapEvent;
import org.springframework.stereotype.Component;

@Component                                       <i class="conum" data-value="1"></i><b>(1)</b>
public class PersonEventHandler {

    @CoherenceEventListener                      <i class="conum" data-value="2"></i><b>(2)</b>
    public void onNewPerson(@MapName("people")   <i class="conum" data-value="3"></i><b>(3)</b>
                            @Inserted            <i class="conum" data-value="4"></i><b>(4)</b>
                            MapEvent&lt;String, Person&gt; event) {
        // TODO: process the event
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>PersonController</code> is a simple Spring bean, in this case a <code>Controller</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>onNewPerson</code> method is annotated with <code>@CoherenceEventListener</code> making it a Coherence event listener.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>@MapName("people")</code> annotation specifies the name of the map to receive events from, in this case <code>people</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>@Inserted</code> annotation specified that only <code>Inserted</code> events should be sent to this method.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above example is still rather simple. There are a number of other annotations that provide much finer-grained control
over what events are received from where.</p>
</div>
<div class="sect5">
<h6 id="specify-the-mapcache-name-2"><a class="anchor" href="#specify-the-mapcache-name-2"></a>Specify the Map/Cache name</h6>
<div class="paragraph">
<p>By default, a <code>MapEvent</code> observer method would receive events for all maps/caches. In practice though, this would not be
a very common use case, and typically you would want an observer method to listen to events that are for specific caches.
The Coherence Spring API contains two annotations for specifying the map name:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/MapName.html">@MapName</a></p>
</li>
<li>
<p><a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/CacheName.html">@CacheName</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both annotations take a single <code>String</code> value that represents the name of the map or cache that events should be received
from.</p>
</div>
<div class="listingblock">
<div class="title">Listening to events for all caches</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @CoherenceEventListener
    public void onEvent(MapEvent&lt;String, String&gt; event) {
        // TODO: process the event
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above method receives events for <em>all</em> caches.</p>
</div>
<div class="listingblock">
<div class="title">Listening to events for the map named "foo"</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @CoherenceEventListener
    public void onFooEvent(@MapName("foo")       <i class="conum" data-value="1"></i><b>(1)</b>
                           MapEvent&lt;String, String&gt; event) {
        // TODO: process the event
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The above method receives events for the map named <code>foo</code>.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listening to events for the cache named "bar"</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @CoherenceEventListener
    public void onBarEvent(@CacheName("bar")     <i class="conum" data-value="1"></i><b>(1)</b>
                           MapEvent&lt;String, String&gt; event) {
        // TODO: process the event
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The above method receives events for the cache named <code>bar</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="specify-the-cache-service-name"><a class="anchor" href="#specify-the-cache-service-name"></a>Specify the Cache Service name</h6>
<div class="paragraph">
<p>In the previous section we showed to restrict received events to a specific map or cache name. Events can also be restricted
to only events from a specific <a href="https://docs.oracle.com/en/middleware/standalone/coherence/14.1.1.2206/develop-applications/introduction-coherence-clusters.html#GUID-62A54E60-E964-4DFE-BE7F-CA7ADA93354E">cache service</a>.
In Coherence all caches are owned by a cache service, which has a unique name. By default, a <code>MapEvent</code> observer method
would receive events for a matching cache name on <em>all</em> services. If an applications Coherence configuration has multiple
services, the events can be restricted to just specific services using the
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/ServiceName.html">@ServiceName</a> annotation.</p>
</div>
<div class="listingblock">
<div class="title">Listening to events for the "foo" map on all services</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @CoherenceEventListener
    public void onEventFromAllServices(@MapName("foo")  <i class="conum" data-value="1"></i><b>(1)</b>
                                MapEvent&lt;String, String&gt; event) {
        // TODO: process the event
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The above method receives events for the map named <code>foo</code> on <em>all</em> cache services.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listening to events for the "foo" map on the "Storage" service only</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @CoherenceEventListener
    public void onEventOnStorageService(@MapName("foo")
                        @ServiceName("Storage")  <i class="conum" data-value="1"></i><b>(1)</b>
                        MapEvent&lt;String, String&gt; event) {
        // TODO: process the event
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The above method receives events for the map named <code>foo</code> owned by the cache service named <code>Storage</code>.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listening to events for ALL caches on the "Storage" service</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @CoherenceEventListener
    public void onEventFromAllCachesOnStorageService(@ServiceName("Storage")  <i class="conum" data-value="1"></i><b>(1)</b>
                        MapEvent&lt;String, String&gt; event) {
        // TODO: process the event
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The above method receives events for <em>all</em> caches owned by the cache service named <code>Storage</code> as there is no <code>@MapName</code> or <code>@CacheName</code> annotation.</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="specify-the-owning-session-name-2"><a class="anchor" href="#specify-the-owning-session-name-2"></a>Specify the Owning Session Name</h6>
<div class="paragraph">
<p>In applications that use multiple <code>Sessions</code>, there may be a situation where more than one session has a map with
the same name. In those cases an observer method may need to restrict the events it receives to a specific session.
The events can be restricted to <code>maps</code> and/or <code>caches</code> in specific sessions using the
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/SessionName.html">@SessionName</a> annotation.</p>
</div>
<div class="listingblock">
<div class="title">Listening to events for the "orders" map in ALL sessions</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @CoherenceEventListener
    public void onOrdersEventAllSessions(@MapName("orders")  <i class="conum" data-value="1"></i><b>(1)</b>
                        MapEvent&lt;String, String&gt; event) {
        // TODO: process the event
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The above method receives events for the map named <code>orders</code> in <em>all</em> sessions.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listening to events for the "orders" map in the "Customer" session only</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @CoherenceEventListener
    public void onOrdersEventInCustomerSession(@MapName("orders")
                        @SessionName("Customer")             <i class="conum" data-value="1"></i><b>(1)</b>
                        MapEvent&lt;String, String&gt; event) {
        // TODO: process the event
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The above method receives events for the map named <code>orders</code> owned by the <code>Session</code> named <code>Customer</code>.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listening to events for ALL caches in the "Customer" session</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @CoherenceEventListener
    public void onEventInAllCachesInCustomerSession(@SessionName("Customer") <i class="conum" data-value="1"></i><b>(1)</b>
                                MapEvent&lt;String, String&gt; event) {
        // TODO: process the event
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The above method receives events for the <em>all</em> caches owned by the <code>Session</code> named <code>Customer</code> as there is no <code>@MapName</code> or <code>@CacheName</code> annotation.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Therefore, in application with multiple sessions, events with the same name can be routed by session.</p>
</div>
<div class="listingblock">
<div class="title">Route events with the cache name by the name of the session</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @CoherenceEventListener
    public void onCustomerOrders(@SessionName("Customer")    <i class="conum" data-value="1"></i><b>(1)</b>
                                 @MapName("orders")
                                 MapEvent&lt;String, Order&gt; event) {
        // TODO: process the event
    }

    @CoherenceEventListener
    public void onCatalogOrders(@SessionName("Catalog")      <i class="conum" data-value="2"></i><b>(2)</b>
                                @MapName("orders")
                                MapEvent&lt;String, Order&gt; event) {
        // TODO: process the event
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>onCustomerOrders</code> method will receive events for the <code>orders</code> map owned by the <code>Session</code> named <code>Customer</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>onCatalogOrders</code> method will receive events for the <code>orders</code> map owned by the <code>Session</code> named <code>Catalog</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="coherence-spring-events-mapevent-listeners-specific-events"><a class="anchor" href="#coherence-spring-events-mapevent-listeners-specific-events"></a>3.8.1.2. Receive Specific Event Types</h5>
<div class="paragraph">
<p>There are three types of event that a <code>MapEvent</code> observer method can receive:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Insert</code></p>
</li>
<li>
<p><code>Update</code></p>
</li>
<li>
<p><code>Delete</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, an observer method will receive all events for the map (or maps) it applies to. This can be controlled using
the following annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Inserted.html">@Inserted</a> - to receive <code>Insert</code> events.</p>
</li>
<li>
<p><a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Updated.html">@Updated</a> - to receive <code>Update</code> events.</p>
</li>
<li>
<p><a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Deleted.html">@Deleted</a> - to receive <code>Delete</code> events.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Zero or more of the above annotations can be used to annotate the <code>MapEvent</code> parameter of the observer method.</p>
</div>
<div class="listingblock">
<div class="title">Listen to "Insert" event for the "test" map only</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @CoherenceEventListener
    public void onInsertEvent(@MapName("test")
                        @Inserted                            <i class="conum" data-value="1"></i><b>(1)</b>
                        MapEvent&lt;String, String&gt; event) {
        // TODO: process the event
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Only <code>Insert</code> events for the map <code>test</code> will be received.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listen to "Insert" and "Delete" events for the "test" map only</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @CoherenceEventListener
    public void onInsertAndDeleteEvent(@MapName("test")
                        @Inserted @Deleted                   <i class="conum" data-value="1"></i><b>(1)</b>
                        MapEvent&lt;String, String&gt; event) {
        // TODO: process the event
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Only <code>Insert</code> and <code>Delete</code> events for the map <code>test</code> will be received.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listen to ALL map events for the "test" map</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @CoherenceEventListener
    public void onMapEvent(@MapName("test") MapEvent&lt;String, String&gt; event) {
        // TODO: process the event
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>All events for the map <code>test</code> will be received.</p>
</div>
</div>
<div class="sect4">
<h5 id="coherence-spring-events-mapevent-listeners-filtering-events"><a class="anchor" href="#coherence-spring-events-mapevent-listeners-filtering-events"></a>3.8.1.3. Filtering Events</h5>
<div class="paragraph">
<p>The <code>MapEvents</code> received by an observer method can be further restricted by applying a filter. Filters are applied by
annotating the method with a <a href="#coherence-spring-filter-binding-annotations">filter binding</a> annotation, which is a link
to a factory that creates a specific instance of a <a href="https://coherence.community/23.09.2/api/java/com/tangosol/util/Filter.html">Filter</a>. Event
filters applied in this way are executed on the server, which can make receiving events more efficient for clients, as
the event will not be sent from the server at all.</p>
</div>
<div class="paragraph">
<p>Coherence Spring comes with some built in implementations, for example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/AlwaysFilter.html">@AlwaysFilter</a>,</p>
</li>
<li>
<p><a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/WhereFilter.html">@WhereFilter</a>,</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is simple to implement custom filters as required by applications. Please refer to the
<a href="#coherence-spring-filter-binding-annotations">Filter Binding Annotation</a> section for more details.</p>
</div>
<div class="paragraph">
<p>For example, let&#8217;s assume there is a map named <code>people</code> with keys of type <code>String</code> and values of type <code>People</code>, and an
observer method needs to receive events for all values where the <code>age</code> property is <code>18</code> or over. A custom filter binding
annotation could be written to create the required <code>Filter</code>. However, as the condition is very simple, the
built-in <code>@WhereFilter</code> filter binding annotation will be used in this example with a where-clause of <code>age &gt;= 18</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example of a Where Filter</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @WhereFilter("age &gt;= 18")                    <i class="conum" data-value="1"></i><b>(1)</b>
    @CoherenceEventListener
    @MapName("people")
    public void onAdult(MapEvent&lt;String, Person&gt; people) {
        // TODO: process event...
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@WhereFilter</code> annotation is applied to the method.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>onAdult</code> method above will receive all events emitted from the <code>people</code> map, but only for entries where the value
of the <code>age</code> property of the entry value is <code>&gt;= 18</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="coherence-spring-events-mapevent-listeners-transforming-events"><a class="anchor" href="#coherence-spring-events-mapevent-listeners-transforming-events"></a>3.8.1.4. Transforming Events</h5>
<div class="paragraph">
<p>In some use-cases the <code>MapEvent</code> observer method does not require the whole map or cache value to process, it might only
require one, or a few, properties of the value, or it might require some calculated value. This can be achieved by
using an event transformer to convert the values that will be received by the observer method. The transformation takes
place on the server before the event is emitted to the method. This can improve efficiency on a client in cases where
the cache value is large, but the client only requires a small part of that value because only the required values are
sent over the wire to the client.</p>
</div>
<div class="paragraph">
<p>In Coherence Spring, event values are transformed using a <a href="https://coherence.community/23.09.2/api/java/com/tangosol/util/ValueExtractor.html">ValueExtractor</a>.
A <code>ValueExtractor</code> is a simple interface that takes in one value and transforms it into another value. The <code>ValueExtractor</code>
is applied to the event value. As events contain both a new and old values, the extractor is applied to both as applicable.
For <code>Insert</code> events there is only a new value, for <code>Update</code> events there will be both, a new and an old value, and for
<code>Delete</code> events, there will only be an old value. The extractor is not applied to the event key.</p>
</div>
<div class="paragraph">
<p>The <code>ValueExtractor</code> to use for a <code>MapEvent</code> observer method is indicated by annotating the method with an
<a href="#coherence-spring-extractor-binding-annotations">extractor binding annotation</a>. An extractor binding is an annotation
that is itself annotated with the meta-annotation <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/ExtractorBinding.html">@ExtractorBinding</a>.
The extractor binding annotation is a link to a corresponding <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/ExtractorFactory.html">ExtractorFactory</a>
that will build an instance of a <code>ValueExtractor</code>.</p>
</div>
<div class="paragraph">
<p>For example, assuming that there is a <code>NamedMap</code> with the name <code>orders</code> that has keys of type <code>String</code> and values of type <code>Order</code>.
The <code>Order</code> class has a <code>customerId</code> property of type <code>String</code>. A <code>MapEvent</code> observer method is only interested in the
<code>customerId</code> for an order, so the built-in extractor binding annotation
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/PropertyExtractor.html">@PropertyExtractor</a> can be used
to just extract the <code>customerId</code> from the event:</p>
</div>
<div class="listingblock">
<div class="title">Example of a Property Extractor</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @CoherenceEventListener
    @PropertyExtractor("customerId")                         <i class="conum" data-value="1"></i><b>(1)</b>
    public void onOrder(@MapName("orders")                   <i class="conum" data-value="2"></i><b>(2)</b>
                        MapEvent&lt;String, String&gt; event) {    <i class="conum" data-value="3"></i><b>(3)</b>
        // TODO: process event...
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The method is annotated with <code>@PropertyExtractor</code> to indicate that a <code>ValueExtractor</code> that just extracts the <code>customerId</code>
property should be used to transform the event.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The map name to receive events from is set to <code>orders</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Note that the generic types of the <code>MapEvent</code> parameter are now <code>MapEvent&lt;String, String&gt;</code> instead of
<code>MapEvent&lt;String, Order&gt;</code> because the event values will have been transformed from an <code>Order</code> into just the <code>String</code>
<code>customerId</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is possible to apply multiple filter binding annotations to a method. In this case the extractors are combined into a
Coherence <a href="https://coherence.community/23.09.2/api/java/com/tangosol/util/extractor/ChainedExtractor.html">ChainedExtractor</a>, which will return the
extracted values as a <code>java.util.List</code>.</p>
</div>
<div class="paragraph">
<p>Expanding on the example above, if the <code>Order</code> class also has an <code>orderId</code> property of type <code>Long</code>, and an observer
method, only interested in <code>Insert</code> events needs both the <code>customerId</code> and <code>orderId</code>, then the method can be annotated
with a two <code>@PropertyExtractor</code> annotations:</p>
</div>
<div class="listingblock">
<div class="title">Example of using multiple Property Extractors</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @CoherenceEventListener
    @PropertyExtractor("customerId")                              <i class="conum" data-value="1"></i><b>(1)</b>
    @PropertyExtractor("orderId")
    public void onOrderWithMultiplePropertyExtractors(
                        @Inserted                                 <i class="conum" data-value="2"></i><b>(2)</b>
                        @MapName("orders")
                        MapEvent&lt;String, List&lt;Object&gt;&gt; event) {   <i class="conum" data-value="3"></i><b>(3)</b>
        List list = event.getNewValue();
        String customerId = (String) list.get(0);                 <i class="conum" data-value="4"></i><b>(4)</b>
        Long orderId = (Long) list.get(1);
        // ...
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The method is annotated with two <code>@PropertyExtractor</code> annotations, one to extract <code>customerId</code> and one to extract <code>orderId</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The method parameter is annotated with <code>@Inserted</code> so that the method only receives <code>Insert</code> events.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>MapEvent</code> parameter not has a key of type <code>String</code> and a value of type <code>List&lt;Object&gt;</code>, because the values from
the multiple extractors will be returned in a <code>List</code>. We cannot use a generic value narrower than <code>Object</code>
for the list because it will contain a <code>String</code> and a <code>Long</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The extracted values can be obtained from the list, they will be in the same order that the annotations were applied
to the method.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="coherence-spring-events-event-interceptors"><a class="anchor" href="#coherence-spring-events-event-interceptors"></a>3.8.2. Coherence Event Interceptors</h4>
<div class="paragraph">
<p>Coherence produces many events in response to various server-side and client-side actions. For example, <em>Lifecycle events</em>
for Coherence itself, maps and cache, <em>Entry events</em> when data in maps and caches changes, <em>Partition events</em> for
partition lifecycle and distribution, <em>EntryProcessor events</em> when invoked on a map or cache, etc. In a stand-alone
Coherence application these events are subscribed to using a
<a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/events/EventInterceptor.html">EventInterceptor</a> implementation registered to listen
to specific event types.</p>
</div>
<div class="paragraph">
<p>The Coherence Spring API makes subscribing to these events simple, by using the same approach used for Spring Application
events, namely annotated event observer methods. A Coherence event observer method is a method annotated with
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/event/CoherenceEventListener.html">@CoherenceEventListener</a>
that has a <code>void</code> return type, and a single parameter of the type of event to be received. The exact events received
can be further controlled by applying other annotations to the method or event parameter. The annotations applied will
vary depending on the type of the event.</p>
</div>
<div class="sect4">
<h5 id="event-types"><a class="anchor" href="#event-types"></a>3.8.2.1. Event Types</h5>
<div class="paragraph">
<p>The different types of event that can be observed are listed below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/events/CoherenceLifecycleEvent.html">CoherenceLifecycleEvent</a> -
lifecycle events for  <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/Coherence.html">Coherence</a> instances</p>
</li>
<li>
<p><a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/events/SessionLifecycleEvent.html">SessionLifecycleEvent</a> -
lifecycle events for <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/Session.html">Session</a> instances</p>
</li>
<li>
<p><a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/events/application/LifecycleEvent.html">LifecycleEvent</a> -
lifecycle events for <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/ConfigurableCacheFactory.html">ConfigurableCacheFactory</a> instances</p>
</li>
<li>
<p><a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/events/partition/cache/CacheLifecycleEvent.html">CacheLifecycleEvent</a> -
lifecycle events for <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/NamedMap.html">NamedMap</a> and <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/NamedCache.html">NamedCache</a> instances</p>
</li>
<li>
<p><a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/events/partition/cache/EntryEvent.html">EntryEvent</a> - events emitted by the
mutation of entries in a <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/NamedMap.html">NamedMap</a>
or <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/NamedCache.html">NamedCache</a></p>
</li>
<li>
<p><a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/events/partition/cache/EntryProcessorEvent.html">EntryProcessorEvent</a> - events emitted
by the invocation of an <a href="https://coherence.community/23.09.2/api/java/com/tangosol/util/InvocableMap.EntryProcessor.html">EntryProcessor</a> on entries in a
<a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/NamedMap.html">NamedMap</a> or <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/NamedCache.html">NamedCache</a></p>
</li>
<li>
<p><a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/events/partition/TransactionEvent.html">TransactionEvent</a> - events pertaining to
all mutations performed within the context of a single request in a partition of a
<a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/NamedMap.html">NamedMap</a> or <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/NamedCache.html">NamedCache</a>,
also referred to as "partition level transactions".</p>
</li>
<li>
<p><a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/events/partition/TransferEvent.html">TransferEvent</a> - captures information
concerning the transfer of a partition for a storage enabled member.</p>
</li>
<li>
<p><a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/events/partition/UnsolicitedCommitEvent.html">UnsolicitedCommitEvent</a> - captures
changes pertaining to all observed mutations performed against caches that were not directly caused (solicited) by the
partitioned service. These events may be due to changes made internally by the backing map, such as eviction, or referrers
of the backing map causing changes.</p>
</li>
<li>
<p>If using commercial versions of Coherence with Coherence Spring, there are also events associated to
the federation of data between different clusters.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Most of the events above only apply to storage enabled cluster members. For example, an <code>EntryEvent</code> will only be
emitted for mutations of an entry on the storage enabled cluster member that owns that entry. Lifecycle events on the
other hand, may be emitted on all members, such as <code>CacheLifecycle</code> event that may be emitted on any member when a cache
is created, truncated, or destroyed.</p>
</div>
</div>
<div class="sect4">
<h5 id="coherence-lifecycle-events"><a class="anchor" href="#coherence-lifecycle-events"></a>3.8.2.2. Coherence Lifecycle Events</h5>
<div class="paragraph">
<p><a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/events/application/LifecycleEvent.html">LifecycleEvent</a> are emitted to indicate the lifecycle of a <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/ConfigurableCacheFactory.html">ConfigurableCacheFactory</a> instance.</p>
</div>
<div class="paragraph">
<p>To subscribe to <code>LifecycleEvent</code> simply create a Spring bean with a listener method that is annotated with
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/event/CoherenceEventListener.html">@CoherenceEventListener</a>.
The method should have a single parameter of type <code>LifecycleEvent</code>.</p>
</div>
<div class="paragraph">
<p><code>LifecycleEvent</code> are emitted by <code>ConfigurableCacheFactory</code> instances and will only be received in the same JVM, which could be a cluster member or a client.</p>
</div>
<div class="paragraph">
<p>For example, the <code>onEvent</code> method below will receive lifecycle events for all <code>ConfigurableCacheFactory</code> instances in the current application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(LifecycleEvent event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="receive-specific-lifecycleevent-types"><a class="anchor" href="#receive-specific-lifecycleevent-types"></a>Receive Specific LifecycleEvent Types</h6>
<div class="paragraph">
<p>There are four different types of <code>LifecycleEvent</code>.
By adding the corresponding annotation to the method parameter the method will only receive the specified events.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Activating</strong> - a <code>ConfigurableCacheFactory</code> instance is about to be activated, use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Activating.html">@Activating</a> annotation</p>
</li>
<li>
<p><strong>Activated</strong> - a <code>ConfigurableCacheFactory</code> instance has been activated, use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Activated.html">@Activated</a> annotation</p>
</li>
<li>
<p><strong>Disposing</strong> - a <code>ConfigurableCacheFactory</code> instance is about to be disposed, use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Disposing.html">@Disposing</a> annotation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, the method below will only receive <code>Activated</code> and <code>Disposing</code> events.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(@Activated @Disposing LifecycleEvent event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="receive-coherencelifecycleevents-for-a-specific-coherence-instance"><a class="anchor" href="#receive-coherencelifecycleevents-for-a-specific-coherence-instance"></a>Receive CoherenceLifecycleEvents for a Specific Coherence Instance</h6>
<div class="paragraph">
<p>Each <code>Coherence</code> instance in an application has a unique name. The observer method can be annotated to only receive events associated with a specific <code>Coherence</code> instance by using the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/Name.html">@Name</a> annotation.</p>
</div>
<div class="paragraph">
<p>For example, the method below will only receive events for the <code>Coherence</code> instance named <code>customers</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(@Name("customers") CoherenceLifecycleEvent event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The method in this example will receive events for the default <code>Coherence</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(@Name(Coherence.DEFAULT_NAME) CoherenceLifecycleEvent event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="session-lifecycle-events"><a class="anchor" href="#session-lifecycle-events"></a>3.8.2.3. Session Lifecycle Events</h5>
<div class="paragraph">
<p><a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/events/SessionLifecycleEvent.html">SessionLifecycleEvents</a> are emitted to indicate
the lifecycle event of a <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/Session.html">Session</a> instance.</p>
</div>
<div class="paragraph">
<p>To subscribe to <code>SessionLifecycleEvents</code> simply create a Spring bean with a listener method annotated with
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/event/CoherenceEventListener.html">@CoherenceEventListener</a>.
The method should have a single parameter of type <code>SessionLifecycleEvent</code>.</p>
</div>
<div class="paragraph">
<p><code>SessionLifecycleEvents</code> are emitted by <code>Session</code> instances and will only be received in the same JVM, which could be a cluster member or a client.</p>
</div>
<div class="paragraph">
<p>For example, the <code>onEvent</code> method below will receive lifecycle events for all <code>Session</code> instances in the current application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(SessionLifecycleEvent event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="receive-specific-sessionlifecycleevent-types"><a class="anchor" href="#receive-specific-sessionlifecycleevent-types"></a>Receive Specific SessionLifecycleEvent Types</h6>
<div class="paragraph">
<p>There are four different types of <code>SessionLifecycleEvent</code>.
By adding the corresponding annotation to the method parameter the method will only receive the specified events.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Starting</strong> - a <code>Coherence</code> instance is about to start, use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Starting.html">@Starting</a> annotation</p>
</li>
<li>
<p><strong>Started</strong> - a <code>Coherence</code> instance has started, use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Started.html">@Started</a> annotation</p>
</li>
<li>
<p><strong>Stopping</strong> - a <code>Coherence</code> instance is about to stop, use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Stopping.html">@Stopping</a> annotation</p>
</li>
<li>
<p><strong>Stopped</strong> - a <code>Coherence</code> instance has stopped, use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Stopped.html">@Stopped</a> annotation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, the method below will only receive <code>Started</code> and <code>Stopped</code> events.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(@Started @Stopped SessionLifecycleEvent event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="receive-sessionlifecycleevents-for-a-specific-session-instance"><a class="anchor" href="#receive-sessionlifecycleevents-for-a-specific-session-instance"></a>Receive SessionLifecycleEvents for a Specific Session Instance</h6>
<div class="paragraph">
<p>Each <code>Session</code> instance in an application has a name. The observer method can be annotated to only receive events
associated with a specific <code>Session</code> instance by using the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/Name.html">@Name</a> annotation.</p>
</div>
<div class="paragraph">
<p>For example, the method below will only receive events for the <code>Session</code> instance named <code>customers</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(@Name("customers") SessionLifecycleEvent event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The method in this example will receive events for the default <code>Coherence</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(@Name(Coherence.DEFAULT_NAME) SessionLifecycleEvent event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configurablecachefactory-lifecycle-events"><a class="anchor" href="#configurablecachefactory-lifecycle-events"></a>3.8.2.4. ConfigurableCacheFactory Lifecycle Events</h5>
<div class="paragraph">
<p><a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/events/CoherenceLifecycleEvent.html">CoherenceLifecycleEvents</a> are emitted to
indicate the lifecycle of a <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/Coherence.html">Coherence</a> instance.</p>
</div>
<div class="paragraph">
<p>To subscribe to <code>CoherenceLifecycleEvent</code> simply create a Spring bean with a listener method annotated with
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/event/CoherenceEventListener.html">@CoherenceEventListener</a>.
The method should have a single parameter of type <code>CoherenceLifecycleEvent</code>.</p>
</div>
<div class="paragraph">
<p><code>CoherenceLifecycleEvent</code> are emitted by <code>Coherence</code> instances and will only be received in the same JVM, which could be
a cluster member or a client.</p>
</div>
<div class="paragraph">
<p>For example, the <code>onEvent</code> method below will receive lifecycle events for all <code>Coherence</code> instances in the current application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(CoherenceLifecycleEvent event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="receive-specific-coherencelifecycleevent-types"><a class="anchor" href="#receive-specific-coherencelifecycleevent-types"></a>Receive Specific CoherenceLifecycleEvent Types</h6>
<div class="paragraph">
<p>There are four different types of <code>CoherenceLifecycleEvent</code>.
By adding the corresponding annotation to the method parameter the method will only receive the specified events.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Starting</strong> - a <code>Coherence</code> instance is about to start, use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Starting.html">@Starting</a> annotation</p>
</li>
<li>
<p><strong>Started</strong> - a <code>Coherence</code> instance has started, use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Started.html">@Started</a> annotation</p>
</li>
<li>
<p><strong>Stopping</strong> - a <code>Coherence</code> instance is about to stop, use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Stopping.html">@Stopping</a> annotation</p>
</li>
<li>
<p><strong>Stopped</strong> - a <code>Coherence</code> instance has stopped, use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Stopped.html">@Stopped</a> annotation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, the method below will only receive <code>Started</code> and <code>Stopped</code> events.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(@Started @Stopped CoherenceLifecycleEvent event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="receive-coherencelifecycleevents-for-a-specific-coherence-instance-2"><a class="anchor" href="#receive-coherencelifecycleevents-for-a-specific-coherence-instance-2"></a>Receive CoherenceLifecycleEvents for a Specific Coherence Instance</h6>
<div class="paragraph">
<p>Each <code>Coherence</code> instance in an application has a unique name. The observer method can be annotated to only receive events associated with a specific <code>Coherence</code> instance by using the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/Name.html">@Name</a> annotation.</p>
</div>
<div class="paragraph">
<p>For example, the method below will only receive events for the <code>Coherence</code> instance named <code>customers</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(@Name("customers") CoherenceLifecycleEvent event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The method in this example will receive events for the default <code>Coherence</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(@Name(Coherence.DEFAULT_NAME) CoherenceLifecycleEvent event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="cache-lifecycle-events"><a class="anchor" href="#cache-lifecycle-events"></a>3.8.2.5. Cache Lifecycle Events</h5>
<div class="paragraph">
<p><a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/events/partition/cache/CacheLifecycleEvent.html">CacheLifecycleEvent</a> are emitted to indicate the lifecycle of a cache instance.</p>
</div>
<div class="paragraph">
<p>To subscribe to <code>CacheLifecycleEvent</code> simply create a Spring bean with a listener method annotated with <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/event/CoherenceEventListener.html">@CoherenceEventListener</a>.
The method should have a single parameter of type <code>CacheLifecycleEvent</code>.</p>
</div>
<div class="paragraph">
<p>For example, the <code>onEvent</code> method below will receive lifecycle events for all caches.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(CacheLifecycleEvent event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="receive-specific-cachelifecycleevent-types"><a class="anchor" href="#receive-specific-cachelifecycleevent-types"></a>Receive Specific CacheLifecycleEvent Types</h6>
<div class="paragraph">
<p>There are three types of `CacheLifecycleEvent:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Created</strong> - a cache instance has been created, use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Created.html">@Created</a> annotation</p>
</li>
<li>
<p><strong>Truncated</strong> - a cache instance has been truncated (all data was removed), use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Truncated.html">@Truncated</a> annotation</p>
</li>
<li>
<p><strong>Destroyed</strong> - a cache has been destroyed (destroy is a cluster wide operation, so the cache is destroyed on all members of the cluster and clients) use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Destroyed.html">@Destroyed</a> annotation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, the method below will only receive <code>Created</code> and <code>Destroyed</code> events for all caches.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(@Created @Destroyed CacheLifecycleEvent event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="receive-cachelifecycleevents-for-a-specific-namedmap-or-namedcache"><a class="anchor" href="#receive-cachelifecycleevents-for-a-specific-namedmap-or-namedcache"></a>Receive CacheLifecycleEvents for a Specific NamedMap or NamedCache</h6>
<div class="paragraph">
<p>To only receive events for a specific <code>NamedMap</code> annotate the method parameter with the
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/MapName.html">@MapName</a> annotation.
To only receive events for a specific <code>NamedCache</code> annotate the method parameter with the
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/CacheName.html">@CacheName</a> annotation.</p>
</div>
<div class="paragraph">
<p>The <code>@MapName</code> and <code>@CacheName</code> annotations are actually interchangeable so use whichever reads better for your application code, i.e. if your code is dealing with <code>NamedMap</code> used <code>@MapName</code>. At the storage level, where the events are generated a <code>NamedMap</code> and <code>NamedCache</code> are the same.</p>
</div>
<div class="paragraph">
<p>The method below will only receive events for the map named <code>orders</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(@MapName("orders") CacheLifecycleEvent event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="receive-cachelifecycleevents-from-a-specific-cache-service"><a class="anchor" href="#receive-cachelifecycleevents-from-a-specific-cache-service"></a>Receive CacheLifecycleEvents from a Specific Cache Service</h6>
<div class="paragraph">
<p>Caches are owned by a Cache Service, it is possible to restrict events received by a method to only those related to caches owned by a specific service by annotating the method parameter with the
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/ServiceName.html">@ServiceName</a> annotation.</p>
</div>
<div class="paragraph">
<p>The method below will only receive events for the caches owned by the service named <code>StorageService</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(@ServiceName("StorageService") CacheLifecycleEvent event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="receive-cachelifecycleevents-from-a-specific-session"><a class="anchor" href="#receive-cachelifecycleevents-from-a-specific-session"></a>Receive CacheLifecycleEvents from a Specific Session</h6>
<div class="paragraph">
<p>A typical use case is to obtain <code>NamedCache</code> and <code>NamedMap</code> instances from a <code>Session</code>. It is possible to restrict events received by a method to only those related to caches owned by a specific <code>Session</code> by annotating the method parameter with the
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/SessionName.html">@SessionName</a> annotation.</p>
</div>
<div class="paragraph">
<p>The method below will only receive events for the caches owned by the <code>Session</code> named <code>BackEnd</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(@SessionName("BackEnd") CacheLifecycleEvent event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="entry-events"><a class="anchor" href="#entry-events"></a>3.8.2.6. Entry Events</h5>
<div class="paragraph">
<p>An <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/events/partition/cache/EntryEvent.html">EntryEvent</a> is emitted when
a <a href="https://coherence.community/23.09.2/api/java/com/tangosol/util/InvocableMap.EntryProcessor.html">EntryProcessor</a> is invoked on a cache. These
events are only emitted on the storage enabled member that is the primary owner of the entry that the <code>EntryProcessor</code>
is invoked on.</p>
</div>
<div class="paragraph">
<p>To subscribe to <code>EntryProcessorEvent</code> simply create a Spring bean with a listener method annotated with
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/event/CoherenceEventListener.html">@CoherenceEventListener</a>.
The method should have a single parameter of type <code>EntryEvent</code>.</p>
</div>
<div class="paragraph">
<p>For example, the <code>onEvent</code> method below will receive entry events for all caches.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(EntryEvent event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="receive-specific-entryevent-types"><a class="anchor" href="#receive-specific-entryevent-types"></a>Receive Specific EntryEvent Types</h6>
<div class="paragraph">
<p>There are a number of different <code>EntryEvent</code> types.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Inserting</strong> - an entry is being inserted into a cache, use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Inserting.html">@Inserting</a> annotation</p>
</li>
<li>
<p><strong>Inserted</strong> - an entry has been inserted into a cache, use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Inserted.html">@Inserted</a> annotation</p>
</li>
<li>
<p><strong>Updating</strong> - an entry is being updated in a cache, use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Updating.html">@Updating</a> annotation</p>
</li>
<li>
<p><strong>Updated</strong> - an entry has been updated in a cache, use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Updated.html">@Updated</a> annotation</p>
</li>
<li>
<p><strong>Removing</strong> - an entry is being deleted from a cache, use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Removing.html">@Removing</a> annotation</p>
</li>
<li>
<p><strong>Removed</strong> - an entry has been deleted from a cache, use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Removed.html">@Removed</a> annotation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To restrict the <code>EntryEvent</code> types received by a method apply one or more of the annotations above to the method parameter.
For example, the method below will receive <code>Inserted</code> and <code>Removed</code> events.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(@Inserted @Removed EntryEvent event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The event types fall into two categories, pre-events (those named <em>*ing</em>) and post-events, those named <em>*ed</em>). Pre-events
are emitted synchronously before the entry is mutated. Post-events are emitted asynchronously after the entry has been mutated.</p>
</div>
<div class="paragraph">
<p>As pre-events are synchronous the listener method should not take a long time to execute as it is blocking the cache
mutation and could obviously be a performance impact. It is also important that developers understand Coherence reentrancy
as the pre-events are executing on the Cache Service thread so cannot call into caches owned by the same service.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="receive-entryprocessorevents-for-a-specific-namedmap-or-namedcache"><a class="anchor" href="#receive-entryprocessorevents-for-a-specific-namedmap-or-namedcache"></a>Receive EntryProcessorEvents for a Specific NamedMap or NamedCache</h6>
<div class="paragraph">
<p>To only receive events for a specific <code>NamedMap</code> annotate the method parameter with the
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/MapName.html">@MapName</a> annotation.
To only receive events for a specific <code>NamedCache</code> annotate the method parameter with the
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/CacheName.html">@CacheName</a> annotation.</p>
</div>
<div class="paragraph">
<p>The <code>@MapName</code> and <code>@CacheName</code> annotations are actually interchangeable so use whichever reads better for your application code, i.e. if your code is dealing with <code>NamedMap</code> used <code>@MapName</code>. At the storage level, where the events are generated a <code>NamedMap</code> and <code>NamedCache</code> are the same.</p>
</div>
<div class="paragraph">
<p>The method below will only receive events for the map named <code>orders</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(@MapName("orders") EntryProcessorEvent event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="receive-entryprocessorevents-from-a-specific-cache-service"><a class="anchor" href="#receive-entryprocessorevents-from-a-specific-cache-service"></a>Receive EntryProcessorEvents from a Specific Cache Service</h6>
<div class="paragraph">
<p>Caches are owned by a Cache Service, it is possible to restrict events received by a method to only those related to caches owned by a specific service by annotating the method parameter with the
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/ServiceName.html">@ServiceName</a> annotation.</p>
</div>
<div class="paragraph">
<p>The method below will only receive events for the caches owned by the service named <code>StorageService</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(@ServiceName("StorageService") EntryProcessorEvents event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="receive-entryprocessorevents-from-a-specific-session"><a class="anchor" href="#receive-entryprocessorevents-from-a-specific-session"></a>Receive EntryProcessorEvents from a Specific Session</h6>
<div class="paragraph">
<p>A typical use case is to obtain <code>NamedCache</code> and <code>NamedMap</code> instances from a <code>Session</code>. It is possible to restrict events received by a method to only those related to caches owned by a specific <code>Session</code> by annotating the method parameter with the
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/SessionName.html">@SessionName</a> annotation.</p>
</div>
<div class="paragraph">
<p>The method below will only receive events for the caches owned by the <code>Session</code> named <code>BackEnd</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(@SessionName("BackEnd") EntryProcessorEvents event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="entryprocessor-events"><a class="anchor" href="#entryprocessor-events"></a>3.8.2.7. EntryProcessor Events</h5>
<div class="paragraph">
<p>An <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/events/partition/cache/EntryProcessorEvent.html">EntryProcessorEvent</a> is emitted when a mutation occurs on an entry in a cache. These events are only emitted on the storage enabled member that is the primary owner of the entry.</p>
</div>
<div class="paragraph">
<p>To subscribe to <code>EntryProcessorEvent</code> simply create a Spring bean with a listener method annotated with <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/event/CoherenceEventListener.html">@CoherenceEventListener</a>.
The method should have a single parameter of type <code>EntryProcessorEvent</code>.</p>
</div>
<div class="paragraph">
<p>For example, the <code>onEvent</code> method below will receive entry events for all caches.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(EntryProcessorEvent event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="receive-specific-entryprocessorevent-types"><a class="anchor" href="#receive-specific-entryprocessorevent-types"></a>Receive Specific EntryProcessorEvent Types</h6>
<div class="paragraph">
<p>There are a number of different <code>EntryProcessorEvent</code> types.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Executing - an <code>EntryProcessor</code> is being invoked on a cache, use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Executing.html">@Executing</a> annotation</p>
</li>
<li>
<p>Executed - an <code>EntryProcessor</code> has been invoked on a cache, use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Executed.html">@Executed</a> annotation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To restrict the <code>EntryProcessorEvent</code> types received by a method apply one or more of the annotations above to the method parameter. For example, the method below will receive <code>Executed</code> events.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(@Executed EntryProcessorEvent event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The event types fall into two categories, pre-event ('Executing') and post-event (<code>Executed</code>). Pre-events are emitted synchronously before the <code>EntryProcessor</code> is invoked. Post-events are emitted asynchronously after the <code>EntryProcessor</code> has been invoked.</p>
</div>
<div class="paragraph">
<p>As pre-events are synchronous the listener method should not take a long time to execute as it is blocking the <code>EntryProcessor</code> invocation and could obviously be a performance impact. It is also important that developers understand Coherence reentrancy as the pre-events are executing on the Cache Service thread so cannot call into caches owned by the same service.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="receive-entryprocessorevents-for-a-specific-namedmap-or-namedcache-2"><a class="anchor" href="#receive-entryprocessorevents-for-a-specific-namedmap-or-namedcache-2"></a>Receive EntryProcessorEvents for a Specific NamedMap or NamedCache</h6>
<div class="paragraph">
<p>To only receive events for a specific <code>NamedMap</code> annotate the method parameter with the
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/MapName.html">@MapName</a> annotation.
To only receive events for a specific <code>NamedCache</code> annotate the method parameter with the
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/CacheName.html">@CacheName</a> annotation.</p>
</div>
<div class="paragraph">
<p>The <code>@MapName</code> and <code>@CacheName</code> annotations are actually interchangeable so use whichever reads better for your application code, i.e. if your code is dealing with <code>NamedMap</code> used <code>@MapName</code>. At the storage level, where the events are generated a <code>NamedMap</code> and <code>NamedCache</code> are the same.</p>
</div>
<div class="paragraph">
<p>The method below will only receive events for the map named <code>orders</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(@MapName("orders") EntryProcessorEvent event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="receive-entryprocessorevents-from-a-specific-cache-service-2"><a class="anchor" href="#receive-entryprocessorevents-from-a-specific-cache-service-2"></a>Receive EntryProcessorEvents from a Specific Cache Service</h6>
<div class="paragraph">
<p>Caches are owned by a Cache Service, it is possible to restrict events received by a method to only those related to caches owned by a specific service by annotating the method parameter with the
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/ServiceName.html">@ServiceName</a> annotation.</p>
</div>
<div class="paragraph">
<p>The method below will only receive events for the caches owned by the service named <code>StorageService</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(@ServiceName("StorageService") EntryProcessorEvents event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="receive-entryprocessorevents-from-a-specific-session-2"><a class="anchor" href="#receive-entryprocessorevents-from-a-specific-session-2"></a>Receive EntryProcessorEvents from a Specific Session</h6>
<div class="paragraph">
<p>A typical use case is to obtain <code>NamedCache</code> and <code>NamedMap</code> instances from a <code>Session</code>. It is possible to restrict events received by a method to only those related to caches owned by a specific <code>Session</code> by annotating the method parameter with the
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/SessionName.html">@SessionName</a> annotation.</p>
</div>
<div class="paragraph">
<p>The method below will only receive events for the caches owned by the <code>Session</code> named <code>BackEnd</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(@SessionName("BackEnd") EntryProcessorEvents event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="partition-level-transaction-events"><a class="anchor" href="#partition-level-transaction-events"></a>3.8.2.8. Partition Level Transaction Events</h5>
<div class="paragraph">
<p>A <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/events/partition/TransactionEvent.html">TransactionEvent</a> is emitted in relation to all mutations in a single partition in response to executing a single request.
These are commonly referred to as partition level transactions.
For example, an <code>EntryProcessor</code> that mutates more than one entry (which could be in multiple caches) as part of a single invocation will cause a partition level transaction to occur encompassing all of those cache entries.</p>
</div>
<div class="paragraph">
<p>Transaction events are emitted by storage enabled cache services, they will only e received on the same member that the partition level transaction occurred.</p>
</div>
<div class="paragraph">
<p>To subscribe to <code>TransactionEvent</code> simply create a Spring bean with a listener method annotated with <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/event/CoherenceEventListener.html">@CoherenceEventListener</a>.
The method should have a single parameter of type <code>TransactionEvent</code>.</p>
</div>
<div class="paragraph">
<p>For example, the <code>onEvent</code> method below will receive all transaction events emitted by storage enabled cache services in the same JVM.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(TransactionEvent event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="receive-specific-transactionevent-types"><a class="anchor" href="#receive-specific-transactionevent-types"></a>Receive Specific TransactionEvent Types</h6>
<div class="paragraph">
<p>There are a number of different <code>TransactionEvent</code> types.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Committing</strong> - A COMMITTING event is raised prior to any updates to the underlying backing map.
This event will contain all modified entries which may span multiple backing maps. Use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Inserting.html">@Committing</a> annotation</p>
</li>
<li>
<p><strong>Committed</strong> - A COMMITTED event is raised after any mutations have been committed to the underlying backing maps.
This event will contain all modified entries which may span multiple backing maps.
Use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Inserted.html">@Committed</a> annotation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To restrict the <code>TransactionEvent</code> types received by a method apply one or more of the annotations above to the method parameter. For example, the method below will receive <code>Committed</code> events.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(@Committed TransactionEvent event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="receive-transactionevent-from-a-specific-cache-service"><a class="anchor" href="#receive-transactionevent-from-a-specific-cache-service"></a>Receive TransactionEvent from a Specific Cache Service</h6>
<div class="paragraph">
<p>Caches are owned by a Cache Service, it is possible to restrict events received by a method to only those related to caches owned by a specific service by annotating the method parameter with the
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/ServiceName.html">@ServiceName</a> annotation.</p>
</div>
<div class="paragraph">
<p>The method below will only receive events for the caches owned by the service named <code>StorageService</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(@ServiceName("StorageService") TransactionEvent event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="partition-transfer-events"><a class="anchor" href="#partition-transfer-events"></a>3.8.2.9. Partition Transfer Events</h5>
<div class="paragraph">
<p>A <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/events/partition/TransferEvent.html">TransferEvent</a> captures information concerning the transfer of a partition for a storage enabled member. Transfer events are raised against the set of <a href="https://coherence.community/23.09.2/api/java/com/tangosol/util/BinaryEntry.html">BinaryEntry</a> instances that are being transferred.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TransferEvents are dispatched to interceptors while holding a lock on the partition being transferred, blocking any operations for the partition. Event observer methods should therefore execute as quickly as possible of hand-off execution to another thread.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To subscribe to <code>TransferEvent</code> simply create a Spring bean with a listener method annotated with <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/event/CoherenceEventListener.html">@CoherenceEventListener</a>.
The method should have a single parameter of type <code>TransferEvent</code>.</p>
</div>
<div class="paragraph">
<p>For example, the <code>onEvent</code> method below will receive all transaction events emitted by storage enabled cache services in the same JVM.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(TransferEvent event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="receive-specific-transferevent-types"><a class="anchor" href="#receive-specific-transferevent-types"></a>Receive Specific TransferEvent Types</h6>
<div class="paragraph">
<p>There are a number of different <code>TransferEvent</code> types.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Arrived</strong> - This <code>TransferEvent</code> is dispatched when a set of <code>BinaryEntry</code> instances have been transferred to the <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/events/partition/TransferEvent.html#getLocalMember()">local member</a> or restored from backup.The reason for the event (primary transfer from another member or restore from backup) can be derived as follows:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">TransferEvent event;
boolean restored = event.getRemoteMember() == event.getLocalMember();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Arrived.html">@Arrived</a> annotation to restrict the received events to arrived type.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Assigned</strong> -  This <code>TransferEvent</code> is dispatched when a partition has been assigned to the <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/events/partition/TransferEvent.html#getLocalMember()">local member</a>. This event will only be emitted by the ownership senior during the initial partition assignment.
Use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Assigned.html">@Assigned</a> annotation to restrict received events.</p>
</li>
<li>
<p><strong>Departing</strong> - This <code>TransferEvent</code> is dispatched when a set of <code>BinaryEntry</code> are being transferred from the <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/events/partition/TransferEvent.html#getLocalMember()">local member</a>. This event is followed by either a <code>Departed</code> or <code>Rollback</code> event to indicate the success or failure of the transfer.
Use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Departing.html">@Departing</a> annotation to restrict received events.</p>
</li>
<li>
<p><strong>Departed</strong> - This <code>TransferEvent</code> is dispatched when a partition has been successfully transferred from the <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/events/partition/TransferEvent.html#getLocalMember()">local member</a>. To derive the <code>BinaryEntry</code> instances associated with the transfer, consumers should subscribe to the <code>Departing</code> event that would precede this event.
Use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Departed.html">@Departed</a> annotation to restrict received events.</p>
</li>
<li>
<p><strong>Lost</strong> - This <code>TransferEvent</code> is dispatched when a partition has been orphaned (data loss <em>may</em> have occurred), and the ownership is assumed by the <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/events/partition/TransferEvent.html#getLocalMember()">local member</a>. This event is only be emitted by the ownership senior.
Use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Lost.html">@Lost</a> annotation to restrict received events.</p>
</li>
<li>
<p><strong>Recovered</strong> - This <code>TransferEvent</code> is dispatched when a set of <code>BinaryEntry</code> instances have been recovered from a persistent storage by the <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/events/partition/TransferEvent.html#getLocalMember()">local member</a>.
Use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Recovered.html">@Recovered</a> annotation to restrict received events.</p>
</li>
<li>
<p><strong>Rollback</strong> - This <code>TransferEvent</code> is dispatched when partition transfer has failed and was therefore rolled back. To derive the <code>BinaryEntry</code> instances associated with the failed transfer, consumers should subscribe to the <code>Departing</code> event that would precede this event.
Use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/Rollback.html">@Rollback</a> annotation to restrict received events.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To restrict the <code>TransferEvent</code> types received by a method apply one or more of the annotations above to the method parameter. For example, the method below will receive <code>Lost</code> events.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(@Lost TransferEvent event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Multiple type annotations may be used to receive multiple types of <code>TransferEvent</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="receive-transferevent-from-a-specific-cache-service"><a class="anchor" href="#receive-transferevent-from-a-specific-cache-service"></a>Receive TransferEvent from a Specific Cache Service</h6>
<div class="paragraph">
<p>Caches are owned by a Cache Service, it is possible to restrict events received by a method to only those related to caches owned by a specific service by annotating the method parameter with the
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/event/ServiceName.html">@ServiceName</a> annotation.</p>
</div>
<div class="paragraph">
<p>The method below will only receive events for the caches owned by the service named <code>StorageService</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(@ServiceName("StorageService") TransferEvent event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="unsolicited-commit-events"><a class="anchor" href="#unsolicited-commit-events"></a>3.8.2.10. Unsolicited Commit Events</h5>
<div class="paragraph">
<p>An <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/events/partition/UnsolicitedCommitEvent.html">UnsolicitedCommitEvent</a> captures changes pertaining to all observed mutations performed against caches that were not directly caused (solicited) by the partitioned service. These events may be due to changes made internally by the backing map, such as eviction, or referrers of the backing map causing changes.</p>
</div>
<div class="paragraph">
<p>Unsolicited commit events are emitted by storage enabled cache services, they will only e received on the same member.</p>
</div>
<div class="paragraph">
<p>To subscribe to <code>UnsolicitedCommitEvent</code> simply create a Spring bean with a listener method annotated with <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/event/CoherenceEventListener.html">@CoherenceEventListener</a>.
The method should have a single parameter of type <code>UnsolicitedCommitEvent</code>.</p>
</div>
<div class="paragraph">
<p>For example, the <code>onEvent</code> method below will receive all Unsolicited commit events emitted by storage enabled cache services in the same JVM.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceEventListener
public void onEvent(UnsolicitedCommitEvent event) {
    // TODO: process the event
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="coherence-spring-filter-binding-annotations"><a class="anchor" href="#coherence-spring-filter-binding-annotations"></a>3.9. Filter Binding Annotations</h3>
<div class="paragraph">
<p>Filter binding annotations are normal annotations that are themselves annotated with the
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/FilterBinding.html">@FilterBinding</a> meta-annotation.
A filter binding annotation represents a Coherence <a href="https://coherence.community/23.09.2/api/java/com/tangosol/util/Filter.html">Filter</a> and is used
to specify a <code>Filter</code> in certain injection points, for example a View (CQC), <code>NamedTopic</code> <code>Subscriber</code> beans,
event listeners, etc.</p>
</div>
<div class="paragraph">
<p>There are three parts to using a filter binding:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The filter binding annotation</p>
</li>
<li>
<p>An implementation of a <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/FilterFactory.html">FilterFactory</a> that
is annotated with the filter binding annotation. This is a factory that produces the required <code>Filter</code>.</p>
</li>
<li>
<p>Injection points annotated with the filter binding annotation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We will put all three parts together in an example. Let&#8217;s use a Coherence <code>NamedMap</code> named <code>plants</code> that contains plants
represented by instances of the <code>Plant</code> class as map values. Among the various properties on the <code>Plant</code> class there is
a property called <code>plantType</code> and a property called <code>height</code>. In this example, we want to inject a view that only shows
large palm trees (any palm tree larger than 20 meters). We would need a <code>Filter</code> that has a condition like the following:
<code>plantType == PlantType.PALM &amp;&amp; height &gt;= 20</code>.</p>
</div>
<div class="sect3">
<h4 id="create-the-filter-binding-annotation"><a class="anchor" href="#create-the-filter-binding-annotation"></a>3.9.1. Create the filter binding annotation</h4>
<div class="paragraph">
<p>First create a simple annotation, it could be called something like <code>PlantNameExtractor</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.lang.annotation.Documented;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;

import com.oracle.coherence.spring.annotation.FilterBinding;

@FilterBinding                                   <i class="conum" data-value="1"></i><b>(1)</b>
@Documented
@Retention(RetentionPolicy.RUNTIME)
public @interface LargePalmTrees {               <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The annotation class is annotated with <code>@FilterBinding</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The annotation name is <code>PlantNameExtractor</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this case the annotation does not need any other attributes.</p>
</div>
</div>
<div class="sect3">
<h4 id="create-the-filterfactory"><a class="anchor" href="#create-the-filterfactory"></a>3.9.2. Create the <code>FilterFactory</code></h4>
<div class="paragraph">
<p>Now create the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/FilterFactory.html">FilterFactory</a> implementation
that will produce instances of the required <code>Filter</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import com.oracle.coherence.spring.annotation.FilterFactory;
import com.tangosol.util.Extractors;
import com.tangosol.util.Filter;
import com.tangosol.util.Filters;
import org.springframework.stereotype.Component;

@LargePalmTrees                                              <i class="conum" data-value="1"></i><b>(1)</b>
@Component                                                   <i class="conum" data-value="2"></i><b>(2)</b>
public class LargePalmTreesFilterFactory&lt;Plant&gt;
        implements FilterFactory&lt;LargePalmTrees, Plant&gt; {
    @Override
    public Filter&lt;Plant&gt; create(LargePalmTrees annotation) { <i class="conum" data-value="3"></i><b>(3)</b>
        Filter&lt;Plant&gt; palm = Filters.equal("plantType", PlantType.PALM);
        Filter&lt;Plant&gt; height = Filters.greaterEqual(
                Extractors.extract("height"), 20);
        return Filters.all(palm, height);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is annotated with the <code>PlantNameExtractor</code> filter binding annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The class must be a Spring bean, let&#8217;s annotate it with <code>@Component</code> so that component scanning will pick this class
up as a Spring bean</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>create</code> method uses the Coherence <code>filters</code> API to create the required <code>filter</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The parameter to the <code>create</code> method is the annotation used on the injection point.
In this case the annotation has no values, but if it did we could access those values to customize how the filter is created.</p>
</div>
<div class="paragraph">
<p>For example, we can make the filter more general purpose by calling the annotation <code>@PalmTrees</code> and by
adding a value parameter representing the height like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@FilterBinding
@Documented
@Retention(RetentionPolicy.RUNTIME)
public @interface PalmTrees {
    String value();
}
@FilterBinding
@Documented
@Retention(RetentionPolicy.RUNTIME)
public @interface PalmTrees {
    int value() default 0;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We then need to modify our filter factory to use the height value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import com.oracle.coherence.spring.annotation.FilterFactory;
import com.tangosol.util.Extractors;
import com.tangosol.util.Filter;
import com.tangosol.util.Filters;
import org.springframework.stereotype.Component;

@PalmTrees                                                                <i class="conum" data-value="1"></i><b>(1)</b>
@Component                                                                <i class="conum" data-value="2"></i><b>(2)</b>
public class PalmTreesFilterFactory&lt;Plant&gt;
        implements FilterFactory&lt;PalmTrees, Plant&gt; {
    @Override
    public Filter&lt;Plant&gt; create(PalmTrees annotation) {                   <i class="conum" data-value="3"></i><b>(3)</b>
        Filter&lt;Plant&gt; palm = Filters.equal("plantType", PlantType.PALM);
        Filter&lt;Plant&gt; height = Filters.greaterEqual(
                Extractors.extract("height"), annotation.value());  <i class="conum" data-value="4"></i><b>(4)</b>
        return Filters.all(palm, height);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is annotated with the more flexible <code>PalmTrees</code> filter binding annotation accepting a height parameter</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The class must be a Spring bean, let&#8217;s annotate it with <code>@Component</code> so that component scanning will pick this class
up as a Spring bean</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>create</code> method uses the Coherence <code>filters</code> API to create the required <code>filter</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Instead of hard-coding the height, we use the value from the <code>@PalmTrees</code> annotation</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="annotate-the-injection-point"><a class="anchor" href="#annotate-the-injection-point"></a>3.9.3. Annotate the Injection Point</h4>
<div class="paragraph">
<p>Now the application code where the view is to be injected can use the custom filter binding annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @View                                                    <i class="conum" data-value="1"></i><b>(1)</b>
    @PalmTrees(1)                                            <i class="conum" data-value="2"></i><b>(2)</b>
    @CoherenceCache("plants")                                <i class="conum" data-value="3"></i><b>(3)</b>
    private NamedMap&lt;Long, Plant&gt; palmTrees;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@View</code> annotation indicates that this is a view rather than a plain <code>NamedMap</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>@PalmTrees</code> annotation links to the custom filter factory which is used to create the filter for the view. The
annotation value of <code>1</code> indicates that we are interested in all palm trees of at least 1 meter in height.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Due to Spring limitations regarding the injection of Maps, we use the <code>@CoherenceMap</code> annotation to inject the <code>NamedMap</code>,
which also has takes an optional value to specify the name of the cache.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="coherence-spring-extractor-binding-annotations"><a class="anchor" href="#coherence-spring-extractor-binding-annotations"></a>3.10. Extractor Binding Annotations</h3>
<div class="paragraph">
<p>ValueExtractor binding annotations are normal annotations that are themselves annotated with the
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/ExtractorBinding.html">@ExtractorBinding</a> meta-annotation.
An extractor binding annotation represents a Coherence <a href="https://coherence.community/23.09.2/api/java/com/tangosol/util/ValueExtractor.html">ValueExtractor</a>
and is used to specify a <code>ValueExtractor</code> in certain injection points, for example a View (CQC), <code>NamedTopic</code> <code>Subscriber</code>
beans, <code>MapEvent</code> listeners, etc.</p>
</div>
<div class="paragraph">
<p>There are three parts to using an extractor binding:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The extractor binding annotation</p>
</li>
<li>
<p>An implementation of a <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/ExtractorFactory.html">ExtractorFactory</a> that is annotated with the extractor binding annotation. This is a factory that produces the required <code>ValueExtractor</code>.</p>
</li>
<li>
<p>Injection points annotated with the extractor binding annotation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As an example, let&#8217;s continue with our previous example, where we have a Coherence <code>NamedMap</code> named <code>plants</code> that contains
<code>Plant</code> instances as values. In this example we are interested in inject a map of plant names instead of the actual
plant instances. Each plant has a <code>name</code> property that we will use for that purpose. We will need a <code>ValueExtractor</code> that
extracts the <code>name</code> property and the resulting map of plant names can be injected into our Spring beans.</p>
</div>
<div class="sect3">
<h4 id="create-the-extractor-binding-annotation"><a class="anchor" href="#create-the-extractor-binding-annotation"></a>3.10.1. Create the extractor binding annotation</h4>
<div class="paragraph">
<p>First create a simple annotation called <code>PlantName</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ExtractorBinding                                <i class="conum" data-value="1"></i><b>(1)</b>
@Documented
@Retention(RetentionPolicy.RUNTIME)
public @interface PersonAge {                    <i class="conum" data-value="2"></i><b>(2)</b>
}

import com.oracle.coherence.spring.annotation.ExtractorBinding;
import com.oracle.coherence.spring.annotation.FilterBinding;

import java.lang.annotation.Documented;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;

@ExtractorBinding                                <i class="conum" data-value="1"></i><b>(1)</b>
@Documented
@Retention(RetentionPolicy.RUNTIME)
public @interface PlantNameExtractor {           <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The annotation class is annotated with <code>@ExtractorBinding</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The annotation name is <code>PlantNameExtractor</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this case the annotation does not need any other attributes.</p>
</div>
</div>
<div class="sect3">
<h4 id="create-the-extractorfactory"><a class="anchor" href="#create-the-extractorfactory"></a>3.10.2. Create the <code>ExtractorFactory</code></h4>
<div class="paragraph">
<p>Now create the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/ExtractorFactory.html">ExtractorFactory</a>
implementation that will produce instances of the required <code>ValueExtractor</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import com.oracle.coherence.spring.annotation.ExtractorFactory;
import com.tangosol.util.Extractors;
import com.tangosol.util.ValueExtractor;
import org.springframework.stereotype.Component;

@PlantNameExtractor                                          <i class="conum" data-value="1"></i><b>(1)</b>
@Component                                                   <i class="conum" data-value="2"></i><b>(2)</b>
public class PlantNameExtractorFactory&lt;Plant&gt;
        implements ExtractorFactory&lt;PlantNameExtractor, Plant, String&gt; {
    @Override
    public ValueExtractor&lt;Plant, String&gt; create(PlantNameExtractor annotation) {  <i class="conum" data-value="3"></i><b>(3)</b>
        return Extractors.extract("name");
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is annotated with the <code>PlantNameExtractor</code> extractor binding annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The class must be a Spring bean, let&#8217;s annotate it with <code>@Component</code> so that component scanning will pick this class
up as a Spring bean</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>create</code> method uses the Coherence <code>Extractors</code> API to create the required extractor, in this case a trivial property extractor.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The parameter to the <code>create</code> method is the annotation used on the injection point.
In this case the annotation has no values, but if it did we could access those values to customize how the <code>ValueExtractor</code> is created.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotate-the-injection-point-2"><a class="anchor" href="#annotate-the-injection-point-2"></a>3.10.3. Annotate the Injection Point</h4>
<div class="paragraph">
<p>Now the application code where the view is to be injected can use the custom extractor binding annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@View                                            <i class="conum" data-value="1"></i><b>(1)</b>
@PersonAge                                       <i class="conum" data-value="2"></i><b>(2)</b>
@Name("people")                                  <i class="conum" data-value="3"></i><b>(3)</b>
private NamedMap&lt;String, Integer&gt; ages;          <i class="conum" data-value="4"></i><b>(4)</b>
    @View                                        <i class="conum" data-value="1"></i><b>(1)</b>
    @PlantNameExtractor                          <i class="conum" data-value="2"></i><b>(2)</b>
    @CoherenceMap("plants")                      <i class="conum" data-value="3"></i><b>(3)</b>
    private NamedMap&lt;Long, String&gt; plants;       <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@View</code> annotation indicates that this is a view rather than a plain <code>NamedMap</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>@PlantNameExtractor</code> annotation links to the custom extractor factory used to create the <code>ValueExtractor</code> for the view</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Due to Spring limitations regarding the injection of Maps, we use the <code>@CoherenceMap</code> annotation to inject the <code>NamedMap</code>,
which also has takes an optional value to specify the underlying cache/map name to use for the view.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Note that the <code>NamedMap</code> generics are now <code>Long</code> and <code>String</code> instead of <code>Long</code> and <code>Plant</code> as the <code>Plant</code> values
from the underlying cache are transformed into <code>String</code> values by extracting just the name property.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="coherence-spring-messaging-with-coherence-topics"><a class="anchor" href="#coherence-spring-messaging-with-coherence-topics"></a>3.11. Messaging with Coherence Topics</h3>
<div class="paragraph">
<p>Spring Coherence integration provides support for message driven applications by virtue of Coherence topics.</p>
</div>
<div class="paragraph">
<p>A Coherence <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/topic/NamedTopic.html">NamedTopic</a> is analogous to a queue or pub/sub topic, depending on the configuration and application code. Messages published to the topic are stored in Coherence caches, so topics are scalable and performant.</p>
</div>
<div class="paragraph">
<p>A typical stand-alone Coherence application would create a <code>NamedTopic</code> along with <code>Publisher</code> or <code>Subscriber</code> instances to publish to or subscribe to topics. Injection of topics into Spring applications is already covered in <a href="#coherence-spring-dependency-injection-namedtopic">Injecting NamedTopics</a>. With Spring messaging this becomes much simpler.</p>
</div>
<div class="paragraph">
<p>With Spring Coherence Messaging publishers and subscribers beans are created by writing suitably annotated interfaces.</p>
</div>
<div class="sect3">
<h4 id="define-publishers-coherencepublisher"><a class="anchor" href="#define-publishers-coherencepublisher"></a>3.11.1. Define Publishers - @CoherencePublisher</h4>
<div class="paragraph">
<p>To create a topic Publisher that sends messages, you can simply define an interface that is annotated with
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/CoherencePublisher.html">@CoherencePublisher</a>. Also, your
configuration class has to be annotated with the
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/CoherencePublisherScan.html">@CoherencePublisherScan</a>
annotation. This is needed to specify the base package from which we recursively scan for <code>@CoherencePublisher</code> annotated
interfaces.</p>
</div>
<div class="listingblock">
<div class="title">Config.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
@CoherencePublisherScan("com.example.app.services")
public class Config {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example the following is a trivial <code>@CoherencePublisher</code> interface:</p>
</div>
<div class="listingblock">
<div class="title">ProductClient.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import com.oracle.coherence.spring.annotation.CoherencePublisher;
import com.oracle.coherence.spring.annotation.Topic;

@CoherencePublisher                              <i class="conum" data-value="1"></i><b>(1)</b>
public interface ProductClient {

    @Topic("my-products")                        <i class="conum" data-value="2"></i><b>(2)</b>
    void sendProduct(String message);            <i class="conum" data-value="3"></i><b>(3)</b>

    void sendProduct(@Topic String topic, String message); <i class="conum" data-value="4"></i><b>(4)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@CoherencePublisher</code> annotation is used to designate this interface as a message publisher.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/Topic.html">@Topic</a> annotation indicates which topics the message should be published to</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The method defines a single parameter, which is the message value. In this case the values being published are String instances but they could be any type that can be serialized by Coherence.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>It is also possible for the topic to be dynamic by making it a method argument annotated with <code>@Topic</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>At run time Spring will produce an implementation of the above interface. You can retrieve an instance of <code>ProductClient</code> either by looking up the bean from the <code>ApplicationContext</code> or by injecting the bean with <code>@Inject</code>:</p>
</div>
<div class="listingblock">
<div class="title">Using ProductClient</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ProductClient client = applicationContext.getBean(ProductClient.class);
client.sendProduct("Blue Trainers");</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reactive-and-non-blocking-method-definitions"><a class="anchor" href="#reactive-and-non-blocking-method-definitions"></a>3.11.2. Reactive and Non-Blocking Method Definitions</h4>
<div class="paragraph">
<p>The <code>@CoherencePublisher</code> annotation supports the definition of reactive return types (such as Reactor <code>Flux</code>) as well as Futures.</p>
</div>
<div class="paragraph">
<p>The following sections cover possible method signatures and behaviour:</p>
</div>
<div class="sect4">
<h5 id="mono-value-and-return-type"><a class="anchor" href="#mono-value-and-return-type"></a>3.11.2.1. Mono Value and Return Type</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Mono&lt;Publisher.Status&gt; sendBook(Mono&lt;Book&gt; book);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The implementation will return a <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Mono.html">Mono</a> that when subscribed to will subscribe to the passed <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Mono.html">Mono</a> and send a message emitting the resulting <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/topic/Publisher.Status.html">Publisher.Status</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="reactor-flux-value-and-return-type"><a class="anchor" href="#reactor-flux-value-and-return-type"></a>3.11.2.2. Reactor Flux Value and Return Type</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Flux&lt;Publisher.Status&gt; sendBooks(Flux&lt;Book&gt; book);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The implementation will return a Reactor <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html">Flux</a> that when subscribed to will subscribe to the passed <code>Flux</code> and for each emitted item will send a message emitting the resulting <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/topic/Publisher.Status.html">Publisher.Status</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="future-return-type"><a class="anchor" href="#future-return-type"></a>3.11.2.3. Future Return Type</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Future&lt;Publisher.Status&gt; sendBooks(Mono&lt;Book&gt; book);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The implementation will return a Future with publisher&#8217;s status.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="define-subscribers-coherencetopiclistener"><a class="anchor" href="#define-subscribers-coherencetopiclistener"></a>3.11.3. Define Subscribers - @CoherenceTopicListener</h4>
<div class="paragraph">
<p>To listen to Coherence topic messages you can use the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/CoherenceTopicListener.html">@CoherenceTopicListener</a> annotation to define a message listener.</p>
</div>
<div class="paragraph">
<p>The following example will listen for messages published by the <code>ProductClient</code> in the previous section:</p>
</div>
<div class="listingblock">
<div class="title">ProductListener.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import com.oracle.coherence.spring.annotation.CoherenceTopicListener;
import com.oracle.coherence.spring.annotation.Topic;

@CoherenceTopicListener                          <i class="conum" data-value="1"></i><b>(1)</b>
public class ProductListener {

    @Topic("my-products")                        <i class="conum" data-value="2"></i><b>(2)</b>
    public void receive(String product) {        <i class="conum" data-value="3"></i><b>(3)</b>
        System.out.println("Got Product - " + product);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/CoherenceTopicListener.html">@CoherenceTopicListener</a> annotation to indicate that this bean is a Coherence topic listener.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/Topic.html">@Topic</a> annotation is again used to indicate which topic to subscribe to.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The receive method defines single arguments that will receive the message value, in this case the message is of type <code>String</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="method-parameter-bindings"><a class="anchor" href="#method-parameter-bindings"></a>3.11.4. Method Parameter Bindings</h4>
<div class="paragraph">
<p>When using a Coherence topic <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/topic/Subscriber.html">Subscriber</a> directly in application code, the <code>receive</code> method returns an <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/topic/Subscriber.Element.html">Element</a>, which contains the message value and metadata. The annotated subscriber method can take various parameter types that will bind to the element itself or to the message.</p>
</div>
<div class="paragraph">
<p>For example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceTopicListener
@Topic("my-products")
public void receive(Element&lt;Product&gt; product) {
    // ... process message ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The method above will be passed the <a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/topic/Subscriber.Element.html">Element</a> received from the topic. By receiving the element, the method has access to the message value and all the metadata stored with the message.</p>
</div>
</div>
<div class="sect3">
<h4 id="committing-messages"><a class="anchor" href="#committing-messages"></a>3.11.5. Committing Messages</h4>
<div class="paragraph">
<p>An important part of Coherence topic subscribers is committing messages to notify the server that they have been processed and guaranteeing at least once delivery. When using Micronaut Coherence messaging every message will be committed after the handler method has successfully processed the message. This behaviour can be controlled by adding a commit strategy to the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/CoherenceTopicListener.html">@CoherenceTopicListener</a> annotation.</p>
</div>
<div class="sect4">
<h5 id="default-commit-behaviour"><a class="anchor" href="#default-commit-behaviour"></a>3.11.5.1. Default Commit Behaviour</h5>
<div class="paragraph">
<p>If no <code>commitStrategy</code> field has been provided to the <code>@CoherenceTopicListener</code> annotation the default behaviour is to synchronously call <code>Element.commit()</code> for every message received.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceTopicListener
@Topic("my-products")
public void receive(Element&lt;Product&gt; product) {
    // ... process message ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>No <code>commitStrategy</code> field has been supplied to the <code>@CoherenceTopicListener</code> annotation.</p>
</div>
</div>
<div class="sect4">
<h5 id="setting-commit-strategy"><a class="anchor" href="#setting-commit-strategy"></a>3.11.5.2. Setting Commit Strategy</h5>
<div class="paragraph">
<p>The <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/CoherenceTopicListener.html">@CoherenceTopicListener</a> <code>commitStrategy</code> field is an enumeration of type <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/CommitStrategy.html">CommitStrategy</a> with three values, <code>SYNC</code>, <code>ASYNC</code> and <code>MANUAL</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CommitStrategy.SYNC - This strategy is the default, and will synchronously commit every message upon successful completion of the handler method, by calling <code>Element.commit()</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceTopicListener(commitStrategy = CommitStrategy.SYNC)
@Topic("my-products")
public void receive(Product product) {
    // ... process message ...
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>CommitStrategy.ASYNC - This strategy will asynchronously commit every message upon successful completion of the handler method, by calling <code>Element.commitAsync()</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceTopicListener(commitStrategy = CommitStrategy.ASYNC)
@Topic("my-products")
public void receive(Product product) {
    // ... process message ...
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>CommitStrategy.MANUAL - This strategy will not automatically commit messages, all handling of commits must be done as part of the handler method or by some external process.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceTopicListener(commitStrategy = CommitStrategy.MANUAL)
@Topic("my-products")
public void receive(Element&lt;Product&gt; product) {
    // ... process message ...

    // manually commit the element
    element.commit();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above a <code>MANUAL</code> commit strategy has used. The element will be committed by the application code at the end of the handler method. To be able to manually commit a message the method must take the <code>Element</code> as a parameter so that application code can access the commit methods.</p>
</div>
</div>
<div class="sect4">
<h5 id="forwarding-messages-with-sendto"><a class="anchor" href="#forwarding-messages-with-sendto"></a>3.11.5.3. Forwarding Messages with @SendTo</h5>
<div class="paragraph">
<p>On any <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/CoherenceTopicListener.html">@CoherenceTopicListener</a> method that returns a value, you can use the @SendTo annotation to forward the return value to the topic or topics specified by the @SendTo annotation.</p>
</div>
<div class="paragraph">
<p>The key of the original ConsumerRecord will be used as the key when forwarding the message.</p>
</div>
<div class="listingblock">
<div class="title">ProductListener.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import com.oracle.coherence.spring.*;
import org.springframework.messaging.handler.annotation.SendTo;

@CoherenceTopicListener
public class ProductListener {

    @Topic("awesome-products")                   <i class="conum" data-value="1"></i><b>(1)</b>
    @SendTo("product-quantities")                <i class="conum" data-value="2"></i><b>(2)</b>
    public int receive(Product product) {
        System.out.println("Got Product - " + product.getName() + " by " + product.getBrand());
        return product.getQuantity();            <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The topic subscribed to is <code>awesome-products</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The topic to send the result to is <code>product-quantities</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The return value is used to indicate the value to forward</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also do the same using Reactive programming:</p>
</div>
<div class="listingblock">
<div class="title">ProductListener.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import com.oracle.coherence.spring.*;
import org.springframework.messaging.handler.annotation.SendTo;
import reactor.core.publisher.Mono;

@CoherenceTopicListener
public class ProductListener {

    @Topic("awesome-products")                   <i class="conum" data-value="1"></i><b>(1)</b>
    @SendTo("product-quantities")                <i class="conum" data-value="2"></i><b>(2)</b>
    public Mono&lt;Integer&gt; receiveProduct(Mono&lt;Product&gt; productSingle) {
        return productSingle.map(product -&gt; {
            System.out.println("Got Product - " + product.getName() + " by " + product.getBrand());
            return product.getQuantity();        <i class="conum" data-value="3"></i><b>(3)</b>
        });
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The topic subscribed to is <code>awesome-products</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The topic to send the result to is <code>product-quantities</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The return is mapped from the single to the value of the quantity</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="coherence-spring-cachestore"><a class="anchor" href="#coherence-spring-cachestore"></a>3.12. Cache Store</h3>
<div class="paragraph">
<p>Coherence Spring provides dedicated support for database-backed caches using JPA. Spring Data&#8217;s
<a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.repositories">JPA Repositories</a> make basic CRUD database access very simple. An application
developer can just provide an interface that extends <code>JpaRepository</code> with the required generic parameters and
Spring will do the rest.</p>
</div>
<div class="paragraph">
<p>Coherence caches that are backed by a database have two options for how the database integration is provided:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/cache/CacheLoader.html">CacheLoader</a> - an application developer writes an implementation of a <code>CacheLoader</code> to read data from a database for
a given key (or keys), convert it to entities that are then loaded into a cache for the given keys.</p>
</li>
<li>
<p><a href="https://coherence.community/23.09.2/api/java/com/tangosol/net/cache/CacheStore.html">CacheStore</a> - whilst a <code>CacheLoader</code> only loads from a database into a cache, a <code>CacheStore</code> (which extends
<code>CacheLoader</code>) also stores cached entities back to the database, or for entries deleted from the cache, erases the
corresponding values from the database. The parallels between a <code>CacheLoader</code> or <code>CacheStore</code> and a <code>JpaRepository</code>
should be pretty obvious.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Coherence Spring core module provides two interfaces:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/cachestore/JpaRepositoryCacheLoader.html">JpaRepositoryCacheLoader</a>, which extends both <code>JpaRepository</code> and <code>CacheLoader</code></p>
</li>
<li>
<p><a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/cachestore/JpaRepositoryCacheStore.html">JpaRepositoryCacheStore</a>, which extends both <code>JpaRepository</code> and <code>CacheStore</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To create a JPA repository cache loader or cache store, all a developer needs to do is extend the relevant interface
<code>JpaRepositoryCacheLoader</code> or <code>JpaRepositoryCacheStore</code> with the correct generic parameters. We will illustrate the use
of Cache Stores using the following example.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please also look at the reference documentation chapter <a href="#injecting-spring-beans-into-coherence-managed-objects">Injecting Spring Beans into Coherence-Managed Objects</a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="coherence-spring-cachestore-demo"><a class="anchor" href="#coherence-spring-cachestore-demo"></a>3.12.1. JPA Repository CacheStore Demo</h4>
<div class="paragraph">
<p>In this demo we are show-casing how to use Spring Data JPA repository beans as Coherence CacheStores in
applications using the <a href="https://github.com/coherence-community/coherence-spring">Coherence Spring project</a>.</p>
</div>
<div class="paragraph">
<p>The demo is split into multiple Maven modules in order to show-case <code>2</code> use-cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Embedded Coherence</p>
</li>
<li>
<p>Connect to a remote Coherence instance cache using
<a href="https://docs.oracle.com/en/middleware/standalone/coherence/14.1.1.2206/develop-remote-clients/introduction-coherenceextend.html">Coherence*Extend</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Maven Project is structured into the following modules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>coherence-cachestore-demo-app</strong> Main entry point for the demo using an embedded Coherence instance</p>
</li>
<li>
<p><strong>coherence-cachestore-demo-server</strong> Remote Coherence server we will connect to using Coherence*Extend</p>
</li>
<li>
<p><strong>coherence-cachestore-demo-core</strong> Contains common code shared between the local app and the remote Coherence server version</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="coherence-spring-cachestore-demo-model"><a class="anchor" href="#coherence-spring-cachestore-demo-model"></a>3.12.1.1. Data Model</h5>
<div class="paragraph">
<p>At its core (and in the <code>coherence-cachestore-demo-core</code> module), the application has a simple class called <code>Person</code> that
is annotated with basic JPA annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Entity
@Table(name = "PEOPLE")
public class Person implements Serializable {

    /**
     * The unique identifier for this person.
     */
    @Id
    private Long id;

    /**
     * The age of this person.
     */
    private int age;

    /**
     * The person's first name.
     */
    private String firstname;

    /**
     * The person's last name.
     */
    private String lastname;

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public int getAge() {
        return age;
    }

    public void setAge(int age) {
        this.age = age;
    }

    public String getFirstname() {
        return firstname;
    }

    public void setFirstname(String firstname) {
        this.firstname = firstname;
    }

    public String getLastname() {
        return lastname;
    }

    public void setLastname(String lastname) {
        this.lastname = lastname;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The identifier of a <code>Person</code> is defined as <code>Long</code>, so in our Coherence-based application we would put these <code>Person</code>
instances into a Coherence <code>NamedMap&lt;Long, Person&gt;</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="coherence-spring-cachestore-demo-jpa-repository"><a class="anchor" href="#coherence-spring-cachestore-demo-jpa-repository"></a>3.12.1.2. Writing a JPA Repository CacheStore</h5>
<div class="paragraph">
<p>To write a JPA repository <code>CacheStore</code> that can be used by our people cache we need to create a simple Spring Data
repository interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import com.oracle.coherence.spring.cachestore.JpaRepositoryCacheStore;
import org.springframework.stereotype.Repository;

@Repository
public interface PersonRepository extends JpaRepositoryCacheStore&lt;Person, Long&gt; {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>That is all the code required to write a <code>CacheStore</code> that can be plugged into Coherence. Spring Data will take care of
actually generating the implementation of the interface, and supplying that implementation as a bean.</p>
</div>
</div>
<div class="sect4">
<h5 id="coherence-spring-cachestore-demo-embedded"><a class="anchor" href="#coherence-spring-cachestore-demo-embedded"></a>3.12.1.3. Embedded Coherence</h5>
<div class="paragraph">
<p>In the embedded Coherence CacheStore demo we use a co-located Coherence instance that will start
as part of the application itself.</p>
</div>
<div class="paragraph">
<p>To use a <code>CacheStore</code> in Coherence, it needs to be configured in the Coherence cache configuration file, which in the
embedded use-case is <code>coherence-cache-config.xml</code>. In order to use the repository bean as a <code>CacheStore</code>, we will make
use of the Coherence Spring feature that allows injection of Spring beans into the cache configuration file.</p>
</div>
<div class="paragraph">
<p>To use Spring bean injection in the configuration file we need to declare a custom namespace in the root XML element that
references the Coherence Spring <code>NamespaceHandler</code>.</p>
</div>
<div class="listingblock">
<div class="title">coherence-cache-config.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;cache-config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xmlns="http://xmlns.oracle.com/coherence/coherence-cache-config"
              xmlns:spring="class://com.oracle.coherence.spring.namespace.NamespaceHandler"
              xsi:schemaLocation="http://xmlns.oracle.com/coherence/coherence-cache-config coherence-cache-config.xsd"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>xmlns:spring="class://com.oracle.coherence.spring.namespace.NamespaceHandler"</code> line declares the custom namespace,
so elements with a prefix <code>spring</code> will be handled by the <code>com.oracle.coherence.spring.namespace.NamespaceHandler</code> class.
The custom namespace handler allows us to use elements of the form <code>&lt;spring:bean&gt;bean-name&lt;/spring:bean&gt;</code> anywhere in the
configuration that Coherence normally allows an <code>&lt;instance&gt;</code> element or a <code>&lt;class-scheme&gt;</code> element.</p>
</div>
<div class="paragraph">
<p>Thus, we can add a scheme to the <code>&lt;cache-schemes&gt;</code> section of the configuration that uses the repository bean.</p>
</div>
<div class="listingblock">
<div class="title">coherence-cache-config.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">    &lt;caching-schemes&gt;
        &lt;distributed-scheme&gt;
            &lt;scheme-name&gt;db-scheme&lt;/scheme-name&gt;
            &lt;service-name&gt;StorageService&lt;/service-name&gt;
            &lt;backing-map-scheme&gt;
                &lt;read-write-backing-map-scheme&gt;
                    &lt;internal-cache-scheme&gt;
                        &lt;local-scheme/&gt;
                    &lt;/internal-cache-scheme&gt;
                    &lt;cachestore-scheme&gt;
                        &lt;spring:bean&gt;{repository-bean}&lt;/spring:bean&gt;
                    &lt;/cachestore-scheme&gt;
                &lt;/read-write-backing-map-scheme&gt;
            &lt;/backing-map-scheme&gt;
            &lt;autostart&gt;true&lt;/autostart&gt;
        &lt;/distributed-scheme&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the snippet above you can see the <code>&lt;spring:bean&gt;{repository-bean}&lt;/spring:bean&gt;</code> element used as the cache store.
In this case we have not used the name of the repository bean directly, we have used a parameter named <code>repository-bean</code>
(XML values in curly-brackets in the <code>&lt;spring:bean&gt;</code> element are treated as parameter macros). This allows us to map
multiple caches to the same scheme each with a different cache store - this is quite a common approach in Coherence for
a number of elements that may be configured in a scheme per-cache. We can now also add the cache mapping for our <code>people</code>
cache that will use the scheme above.</p>
</div>
<div class="listingblock">
<div class="title">coherence-cache-config.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">        &lt;cache-mapping&gt;
            &lt;cache-name&gt;people&lt;/cache-name&gt;
            &lt;scheme-name&gt;db-scheme&lt;/scheme-name&gt;
            &lt;init-params&gt;
                &lt;init-param&gt;
                    &lt;param-name&gt;repository-bean&lt;/param-name&gt;
                    &lt;param-value&gt;personRepository&lt;/param-value&gt;
                &lt;/init-param&gt;
            &lt;/init-params&gt;
        &lt;/cache-mapping&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the mapping above, the cache name <code>people</code> maps to the scheme <code>db-scheme</code> that we created above.
As we mentioned above, we need to pass the actual bean name in the <code>repository-bean</code> parameter, which we do by using the
<code>&lt;init-params&gt;</code> element in the mapping. We set the <code>&lt;param-value&gt;</code> element to the bean name, in this case <code>personRepository</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The bean name used here is <code>personRepository</code>. This is the default name generated by Spring for the <code>PersonRepository</code>
class, which is the simple class name with the first letter lowercase. If we did not want to rely on Spring generating a
bean name we could specify a name in the <code>@Repository</code> annotation on the <code>PersonRepository</code> class.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If we had another cache with a different cache store, for example if we had an entity called <code>Location</code> with a repository
cache store class called <code>LocationRepository</code>, the bean name would default to <code>locationRepository</code>, and we could add the
following mapping:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;cache-mapping&gt;
    &lt;cache-name&gt;locations&lt;/cache-name&gt;
    &lt;scheme-name&gt;db-scheme&lt;/scheme-name&gt;
    &lt;init-params&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;repository-bean&lt;/param-name&gt;
            &lt;param-value&gt;locationRepository&lt;/param-value&gt;
        &lt;/init-param&gt;
    &lt;/init-params&gt;
&lt;/cache-mapping&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="coherence-spring-cachestore-demo-running-embedded"><a class="anchor" href="#coherence-spring-cachestore-demo-running-embedded"></a>3.12.1.4. Running the Embedded Sample</h5>
<div class="paragraph">
<p>This sample is just a simple Spring Boot application that exposes two endpoints to create/update people and get people by id.
The controller class for the two endpoints is very simple:</p>
</div>
<div class="listingblock">
<div class="title">PersonController.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@RestController
@RequestMapping(path = "/api/people")
@Transactional()
public class PersonController {

    /**
     * The {@link NamedMap} to store {@link Person} entities.
     */
    @CoherenceMap
    private NamedMap&lt;Long, Person&gt; people;

    @Autowired
    private PersonRepository personRepository;

    /**
     * Create a {@link Person} in the cache.
     * @param id         the unique identifier for the person
     * @param firstName  the person's first name
     * @param lastName   the person's last name
     * @param age        the person's age
     * @return the identifier used to create the person
     */
    @PostMapping
    public Long createPerson(@RequestParam("id") long id, @RequestParam("firstName") String firstName,
            @RequestParam("lastName") String lastName, @RequestParam("age") int age) {
        Person person = new Person();
        person.setFirstname(firstName);
        person.setLastname(lastName);
        person.setAge(age);
        person.setId(id);
        people.put(id, person);
        return id;
    }

    /**
     * Returns the {@link Person} with the specified identifier.
     *
     * @param personId  the unique identifier for the person
     * @return  the {@link Person} with the specified identifier
     */
    @GetMapping("/{personId}")
    public Person getPerson(@PathVariable("personId") Long personId) {
        Person person = people.get(personId);
        if (person == null) {
            throw new ResponseStatusException(HttpStatus.NOT_FOUND, "Person " + personId + " does not exist");
        }
        return person;
    }

    @GetMapping("/db/{personId}")
    public Person getPersonFromDb(@PathVariable("personId") Long personId) {
        Person person = this.personRepository.findById(personId).orElseThrow(() -&gt; {
            throw new ResponseStatusException(HttpStatus.NOT_FOUND, "Person " + personId + " does not exist");
        });
        return person;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We use the Coherence Spring integration to inject a <code>NamedMap</code> into the controller. This will be for the cache named <code>people</code>,
which we configured to use the cache store in the configuration above.</p>
</div>
<div class="paragraph">
<p>In the <code>createPerson</code> method we use the request parameters to create a <code>Person</code> and put it into the cache. The <code>CacheStore</code>
will write this to the database.</p>
</div>
<div class="paragraph">
<p>In the <code>getPerson</code> method we retrieve the <code>Person</code> from the cache using the id from the request path, loading from the
database if there is no entry in the cache for the id.</p>
</div>
<div class="paragraph">
<p>We can build the example using Maven from the root directory of Coherence Spring:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw clean package -pl samples/cachestore-demo</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will build a Spring Boot jar that we can run the normal Spring Boot ways, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">java -jar samples/cachestore-demo/coherence-spring-cachestore-demo-app/target/coherence-spring-cachestore-demo-4.1.2-SNAPSHOT.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>After the application has started we can try to get a <code>Person</code> using <code>curl</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -i -X GET http://localhost:8080/api/people/100</code></pre>
</div>
</div>
<div class="paragraph">
<p>This should return a 404 response because there is no person in the database or cache with the id 100.</p>
</div>
<div class="paragraph">
<p>We can create a <code>Person</code> using a <code>curl</code> POST request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -i -X POST http://localhost:8080/api/people \
    -d 'firstName=Joe' -d 'lastName=Smith' \
    -d 'age=21' -d 'id=100'</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will create the <code>Person</code> named Joe Smith with the id 100. This should return with a 200 response to say the <code>Person</code>
was successfully created and will be stored in the database.</p>
</div>
<div class="paragraph">
<p>If we re-run the GET request we should get Joe Smith.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -i -X GET http://localhost:8080/api/people/100
HTTP/1.1 200
Content-Type: application/json
Transfer-Encoding: chunked
Date: Thu, 19 Aug 2021 16:13:47 GMT

{"id":100,"age":21,"firstname":"Joe","lastname":"Smith"}%</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="coherence-spring-cachestore-demo-coherence-extend"><a class="anchor" href="#coherence-spring-cachestore-demo-coherence-extend"></a>3.12.1.5. Using Coherence*Extend</h5>
<div class="paragraph">
<p>This is the slightly more complex version of the CacheStore demo. Instead of using an embedded version Coherence, we
will have a remote Coherence instance and the actual application will connect to Coherence via Coherence*Extend.</p>
</div>
<div class="paragraph">
<p>We can build the example using Maven from the root directory of Coherence Spring:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw clean install -pl :coherence-spring-cachestore-demo-server -am -DskipTests
./mvnw clean install -pl :coherence-spring-cachestore-demo-app -am -DskipTests</code></pre>
</div>
</div>
<div class="paragraph">
<p>We now have to start the Coherence Server as well as the Coherence Client App. We run both apps using Spring Boot. Let&#8217;s
start with the Coherence Server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">java -jar samples/cachestore-demo/coherence-spring-cachestore-demo-server/target/coherence-spring-cachestore-demo-server-4.1.2-SNAPSHOT.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next we start the client app. It is actually the same app as used in the embedded Coherence use-case. However, we will
specify an additional Spring Boot profile, instructing the app to connect to the Coherence server in client mode via
Coherence*Extend:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">java -jar samples/cachestore-demo/coherence-spring-cachestore-demo-app/target/coherence-spring-cachestore-demo-app-4.1.2-SNAPSHOT.jar \
--spring.profiles.active=remote</code></pre>
</div>
</div>
<div class="paragraph">
<p>By activating the <code>remote</code> Spring Boot profile, we will configure Coherence for client mode and we reference a different
Cache Configuration XML file called <code>remote-cache-config.xml</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="coherence-spring-cachestore-demo-inspect-database"><a class="anchor" href="#coherence-spring-cachestore-demo-inspect-database"></a>3.12.1.6. Inspecting the Database</h5>
<div class="paragraph">
<p>In the remote Coherence CacheStore demo, HSQL will be instantiated via the server module. This allow the app as well as
the server to access the HSQL database instance. That way we can also inspect
the data in the data more easily as we can inspect the database data via SQL tools
such as the open-source <a href="https://dbeaver.io/">DBeaver</a>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cache"><a class="anchor" href="#spring-cache"></a>4. Coherence Spring Cache</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section dives into the Coherence Spring Cache module. It explains how to use
Coherence&#8217;s support for the Spring Framework&#8217;s <a href="https://docs.spring.io/spring-framework/docs/current/reference/html/integration.html#cache">Cache Abstraction</a>.</p>
</div>
<div class="sect2">
<h3 id="spring-cache-introduction"><a class="anchor" href="#spring-cache-introduction"></a>4.1. Introduction</h3>
<div class="paragraph">
<p>Spring provides its own cache abstraction, allowing you to add caching to
Java methods. Coherence Spring provides an implementation of this abstraction for
Oracle Coherence.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Spring&#8217;s Cache abstraction also supports <a href="https://jcp.org/en/jsr/detail?id=107">JSR-107</a> which is also supported by
Oracle Coherence. As such you have another alternative for setting up caching.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you are using JPA/Hibernate you may also consider using the Coherence support for Hibernate&#8217;s second-level cache SPI,
which is provided by the <a href="https://github.com/coherence-community/coherence-hibernate">Coherence Hibernate project</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="spring-cache-configuration"><a class="anchor" href="#spring-cache-configuration"></a>4.2. Configuring Coherence Cache for Spring</h3>
<div class="paragraph">
<p>As a start, please familiarize yourself with Spring&#8217;s Cache Abstraction by reading the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://docs.spring.io/spring-framework/docs/current/reference/html/integration.html#cache">Cache Abstraction chapter</a> in the core Spring Framework reference guide</p>
</li>
<li>
<p>Spring Boot&#8217;s reference documentation&#8217;s <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#boot-features-caching">support regarding caching</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Spring&#8217;s cache abstraction for Coherence will be automatically enabled as soon as you specify <code>@EnableCaching</code> in your
applications configuration classes. In that case a <code>CoherenceCacheManager</code> bean implementation is registered as
<code>CacheManager</code>. Of course, you can define your own <code>CacheManager</code> as well, but in that case auto-configuration will back-off.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The autoconfiguration logic is defined in class
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/configuration/EnableCoherenceImportBeanDefinitionRegistrar.html">EnableCoherenceImportBeanDefinitionRegistrar</a>.
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="title">Example 4. Defining your own CacheManager</div>
<div class="content">
<div class="listingblock primary">
<div class="title">Java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
@EnableCaching
public class CacheConfiguration {
    @Bean
    public CacheManager cacheManager(Coherence coherence) {
      return new CoherenceCacheManager(coherenceInstance);
    }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:cache="http://www.springframework.org/schema/cache"
  xsi:schemaLocation="
    http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/cache https://www.springframework.org/schema/cache/spring-cache.xsd"&gt;

  &lt;cache:annotation-driven/&gt;

  &lt;bean id="cacheManager" class="com.oracle.coherence.spring.cache.CoherenceCacheManager"&gt;
    &lt;constructor-arg ref="coherenceInstance"/&gt;
  &lt;/bean&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When the <code>CacheManager</code> gets instantiated it is configured with default settings that then get applied for all underlying
caches being created and used. Those settings are defined using the <code>CoherenceCacheConfiguration</code> object. If not specified
as a second (optional) constructor argument to the <code>CoherenceCacheManager</code>, a default instance is created.</p>
</div>
<div class="paragraph">
<p>Thus, you can customize certain cache properties when instantiating the <code>CoherenceCacheManager</code> by providing
your own <code>CoherenceCacheConfiguration</code> instance as a second constructor argument. For example, you can set the
<code>time-to-live</code> (ttl) property to specify that caches shall expire after a certain period.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, the underling <code>time-to-live</code> property for caches used for the Spring cache abstraction is <code>0</code>. This means
that cache entries typically do not expire. <strong>However</strong>, you can also specify cache expiration settings via the
<code>coherence-cache-config.xml</code>.
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="title">Example 5. Defining a CacheManager with additional cache configuration</div>
<div class="content">
<div class="listingblock primary">
<div class="title">Java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
@EnableCaching
public class CacheConfiguration {
    @Bean
    public CacheManager cacheManager(Coherence coherence) {
        CoherenceCacheConfiguration cacheConfiguration =
                    new CoherenceCacheConfiguration(Duration.ofMillis(1234));
        return new CoherenceCacheManager(coherenceInstance, cacheConfiguration);
    }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:cache="http://www.springframework.org/schema/cache"
  xsi:schemaLocation="
    http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/cache https://www.springframework.org/schema/cache/spring-cache.xsd"&gt;

  &lt;cache:annotation-driven/&gt;

  &lt;bean id="cacheManager" class="com.oracle.coherence.spring.cache.CoherenceCacheManager"&gt;
    &lt;constructor-arg ref="coherenceInstance"/&gt;
    &lt;constructor-arg&gt;
        &lt;bean class="com.oracle.coherence.spring.cache.CoherenceCacheConfiguration"&gt;
            &lt;constructor-arg&gt;
                &lt;bean class="java.time.Duration" factory-method="ofMillis"&gt;
                    &lt;constructor-arg value="1234"/&gt;
                &lt;/bean&gt;
            &lt;/constructor-arg&gt;
        &lt;/bean&gt;
    &lt;/constructor-arg&gt;
  &lt;/bean&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You don&#8217;t need to define a <code>CoherenceCacheManager</code> to configure the default configuration. You can also just define
a <code>CoherenceCacheConfiguration</code> bean in your Spring application context. As long as there is only a single bean of that
type defined, the default <code>CoherenceCacheManager</code> that is being implicitly created will use that bean.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please consult the <a href="#quickstart">Quickstart chapter</a> to see an example using Spring&#8217;s cache abstraction support with
Spring Boot. Coherence Spring also provides an example of using Spring Framework (without Spring Boot). The source code
for the samples is part of the Coherence Spring projects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/coherence-community/coherence-spring/tree/main/samples/coherence-spring-demo/coherence-spring-demo-classic">coherence-spring-demo-classic</a></p>
</li>
<li>
<p><a href="https://github.com/coherence-community/coherence-spring/tree/main/samples/coherence-spring-demo/coherence-spring-demo-boot">coherence-spring-demo-boot</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you&#8217;re using Spring Boot, please continue reading the <a href="#spring-boot-caching">Spring Boot specific chapter</a>
on caching.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cache-locking"><a class="anchor" href="#spring-cache-locking"></a>4.3. Coherence Caches and Locking</h3>
<div class="paragraph">
<p>Oracle Coherence supports the explicit concurrency control of cache entries using locks. The configuration class
<code>CoherenceCacheConfiguration</code> provides 3 options to specify the relevant settings:</p>
</div>
<div class="paragraph">
<p><strong>useLocks</strong></p>
</div>
<div class="paragraph">
<p>This option lets you specify whether you want to use locks or not. This options defaults to <code>true</code>, meaning that locking is
enabled by default.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When using caching via <em>Coherence*Extend</em> or <em>gRPC</em>, you should disable locking as it is not supported.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>lockTimeout</strong></p>
</div>
<div class="paragraph">
<p>When locking cache entries, you can set a cache timeout. The specified value in milliseconds, instructs Coherence how
long it shall try to acquire a lock for the cache entry. If a timeout occurs, Coherence Spring will throw an exception.
A value of <code>-1</code> will cause Coherence to block indefinitely. Specifying <code>0</code> will cause Oracle Coherence not to wait at all.
By default, the value is set to <code>0</code>.</p>
</div>
<div class="paragraph">
<p><strong>lockEntireCache</strong></p>
</div>
<div class="paragraph">
<p>While generally not recommended, the option exists to also lock they entire cache (not just the specific cache entry).
This option defaults to <code>false</code>.</p>
</div>
<div class="paragraph">
<p>For further information, please read the corresponding chapter
<a href="https://docs.oracle.com/en/middleware/standalone/coherence/14.1.1.2206/develop-applications/performing-transactions.html#GUID-4EAD6E6F-D074-4171-85AE-6F8198DDE33C">Using Explicit Locking for Data Concurrency</a>
in the Oracle Coherence reference guide.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-session"><a class="anchor" href="#spring-session"></a>5. Coherence Spring Session</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section dives into the Coherence Spring Session module. It explains how to use
Coherence&#8217;s support for <a href="https://docs.spring.io/spring-session/docs/current/reference/html5/">Spring Session</a>.</p>
</div>
<div class="sect2">
<h3 id="spring-session-introduction"><a class="anchor" href="#spring-session-introduction"></a>5.1. Getting Started</h3>
<div class="paragraph">
<p>In this chapter you will learn how to configure <a href="https://coherence.community/">Coherence</a> as an HTTP session store using
<a href="https://docs.spring.io/spring-session/docs/current/reference/html5/">Spring Session</a>.</p>
</div>
<div class="paragraph">
<p>First you need to add the coherence-spring-session dependency:</p>
</div>
<div class="exampleblock">
<div class="title">Example 6. Adding the Coherence Spring Session Dependency</div>
<div class="content">
<div class="listingblock primary">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.oracle.coherence.spring&lt;/groupId&gt;
        &lt;artifactId&gt;coherence-spring-session&lt;/artifactId&gt;
        &lt;version&gt;4.1.2-SNAPSHOT&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.oracle.coherence.ce&lt;/groupId&gt;
        &lt;artifactId&gt;coherence&lt;/artifactId&gt;
        &lt;version&gt;23.09.2&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">dependencies {
    compile("com.oracle.coherence.spring:coherence-spring-session:4.1.2-SNAPSHOT")
    compile("com.oracle.coherence.ce:coherence:23.09.2")
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Coherence Spring support for Spring Session can be used for either the free Coherence Community Edition (CE)
or the commercial version. Coherence Spring does not bring in the Coherence dependency automatically but users
must specify the Coherence dependency explicitly.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In order to enable Spring Session support for Coherence, make sure Coherence is enabled and then enable Spring
Session using the <code>@EnableCoherenceHttpSession</code> annotation.</p>
</div>
<div class="listingblock">
<div class="title">Enabling Coherence Spring Sessions</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
@EnableCoherence
@EnableCoherenceHttpSession(                     <i class="conum" data-value="1"></i><b>(1)</b>
        session = "coherence_session",           <i class="conum" data-value="2"></i><b>(2)</b>
        cache = "spring:session:sessions",       <i class="conum" data-value="3"></i><b>(3)</b>
        flushMode = FlushMode.ON_SAVE,           <i class="conum" data-value="4"></i><b>(4)</b>
        sessionTimeoutInSeconds = 1800,          <i class="conum" data-value="5"></i><b>(5)</b>
        useEntryProcessor = true                 <i class="conum" data-value="6"></i><b>(6)</b>
)
static class CoherenceSessionConfig {
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enables Spring Session support for Coherence</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify the name of the Coherence Session. Optional. Defaults to Coherence' default session.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The name of the cache to use. Optional. Defaults to <code>spring:session:sessions</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The FlushMode to use. Optional. Defaults to <code>FlushMode.ON_SAVE</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The session timeout. Optional. Defaults to <code>1800</code> seconds (<code>30</code> minutes)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>When doing HTTP session updates, shall we use a Coherence entry processor? The default is {@code true}.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Are you running Coherence as a dedicated server instance? Then you need to make sure that your Coherence
server may need one or more additional dependencies on its classpath for serialization. Depending on your requirements,
you may need <code>Coherence Spring Session</code>, <code>Spring Security Core</code>, <code>Spring Security Web</code>. Please also ensure that dependency
version between Coherence server and application clients matches exactly.</p>
</div>
<div class="paragraph">
<p>An alternative is to set <code>useEntryProcessor</code> to <code>false</code>. This is less efficient as the entire session has to be sent over
the wire when updating session properties. The positive side effect is that your Coherence server instance will not need
to be aware of the additional dependencies on its classpath.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-session-pof"><a class="anchor" href="#spring-session-pof"></a>5.2. POF Serialization</h3>
<div class="paragraph">
<p>In case that you configured the cache using
<a href="https://docs.oracle.com/en/middleware/standalone/coherence/14.1.1.2206/develop-applications/using-portable-object-format.html#GUID-F331E5AB-0B3B-4313-A2E3-AA95A40AD913">POF serialization</a>,
additional POF configuration for the class <code>MapSession</code> is necessary:</p>
</div>
<div class="listingblock">
<div class="title">POF Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"> &lt;user-type&gt;
     &lt;type-id&gt;2001&lt;/type-id&gt;
     &lt;class-name&gt;org.springframework.session.MapSession&lt;/class-name&gt;
     &lt;serializer&gt;
         &lt;class-name&gt;com.oracle.coherence.spring.session.serialization.pof.MapSessionPofSerializer&lt;/class-name&gt;
     &lt;/serializer&gt;
 &lt;/user-type&gt;</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Depending on your serialization requirements and your session data, additional POF configuration
may be necessary.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="spring-session-sample"><a class="anchor" href="#spring-session-sample"></a>5.3. Spring Session Samples</h3>
<div class="paragraph">
<p>This Coherence Spring source code repository provides 2 dedicated example applications, illustrating the usage of
Spring Session with a Coherence-backed session repository. The first example application uses
<a href="https://spring.io/projects/spring-boot">Spring Boot</a> as well as
<a href="https://spring.io/projects/spring-security">Spring Security</a>. The second example application uses plain Spring Framework
(without Spring Boot) and deploys as a WAR file to a Servlet container (e.g. Tomcat and Jetty).</p>
</div>
<div class="sect3">
<h4 id="spring-session-with-spring-boot"><a class="anchor" href="#spring-session-with-spring-boot"></a>5.3.1. Spring Session with Spring Boot</h4>
<div class="paragraph">
<p>The example application show-cases 2 use-cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use Spring Session with embedded Coherence instances and Java serialization</p>
</li>
<li>
<p>Use Spring Session with remote Coherence instances (Coherence*Extends) and Java serialization</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Even though this demo is targeting Spring Session, we use Spring Security as well, since the authentication details are
stored in the session as well. In regard to authentication, users have 2 choices:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A user can POST a JSON request containing the  username and password in the body of the request.</p>
</li>
<li>
<p>Use basic authentication</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The username is <code>coherence</code>, and the password <code>rocks</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example Authentication Request</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json"> { "username": "coherence", "password": "rocks" }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once successfully authenticated, the application will return a <code>2xx</code> HTTP status with an empty body and a session cookie.
An Authentication failure, on the other hand, produces a non-2xx HTTP status with an empty body. The application has an
endpoint that responds to a <code>GET</code> request to the URL <code>/hello</code> that returns the string <code>Hello Coherence</code>. All endpoints
require an authenticated user using the session cookie or the <code>username</code> and <code>password</code>.</p>
</div>
<div class="sect4">
<h5 id="spring-session-sample-start-embedded-coherence"><a class="anchor" href="#spring-session-sample-start-embedded-coherence"></a>5.3.1.1. Start Spring Session with Embedded Coherence Instances</h5>
<div class="listingblock">
<div class="title">Build the Coherence Server instance</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> $ ./mvnw clean package -pl samples/spring-session-demo/spring-session-demo-app</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we are ready to run the application. Let&#8217;s launch 2 instances, one listening on the pre-configured port
<code>8090</code>, and the other one on port <code>8091</code>.</p>
</div>
<div class="listingblock">
<div class="title">Run the Spring Boot application</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> $ java -jar samples/spring-session-demo/spring-session-demo-app/target/spring-session-demo-app-4.1.2-SNAPSHOT.jar
 $ java -jar samples/spring-session-demo/spring-session-demo-app/target/spring-session-demo-app-4.1.2-SNAPSHOT.jar --server.port=8091</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="spring-session-sample-start-remote-coherence"><a class="anchor" href="#spring-session-sample-start-remote-coherence"></a>5.3.1.2. Spring Session with Remote Coherence Instances</h5>
<div class="paragraph">
<p>In this variation of the example, we will start 1 central Coherence Server and the application will access that remote
Coherence instance as a Coherence*Extend client.</p>
</div>
<div class="listingblock">
<div class="title">Build the Coherence Server instance</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> $ ./mvnw clean package -pl samples/spring-session-demo/spring-session-demo-server</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Build the Application instance</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> $ ./mvnw clean package -pl samples/spring-session-demo/spring-session-demo-app</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we are ready to run the application. We will activate the <code>coherence-client</code> Spring Boot profile as well:</p>
</div>
<div class="listingblock">
<div class="title">Run the Spring Boot application</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> $ java -jar samples/spring-session-demo/spring-session-demo-server/target/spring-session-demo-server-4.1.2-SNAPSHOT.jar
 $ java -jar samples/spring-session-demo/spring-session-demo-app/target/spring-session-demo-app-4.1.2-SNAPSHOT.jar --spring.profiles.active=coherence-client</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, Coherence Spring Session uses a Coherence Entry Processor to perform updates to the persisted HTTP Session. This
will prevent the entire session to be sent over the wire. A drawback of that approach is that the Coherence instance needs
to be aware of Coherence Spring classes for serialization purposes.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can also set the Coherence Spring Session property <code>coherence.spring.session.use-entry-processor</code> and
set it to <code>false</code> (It is <code>true</code> by default) in the client application <code>spring-session-demo-app</code>. With that in place, you
can now remove the relevant Maven dependencies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>spring-security-web</p>
</li>
<li>
<p>coherence-spring-session</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>from the server application module <code>spring-session-demo-server</code> and the application will still work.</p>
</div>
</div>
<div class="sect4">
<h5 id="spring-session-sample-rest-endpoints"><a class="anchor" href="#spring-session-sample-rest-endpoints"></a>5.3.1.3. Accessing the REST Endpoints</h5>
<div class="listingblock">
<div class="title">Log into the application using <a href="https://curl.se/">CURL</a></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> $ curl -i -c cookie.txt \
 -H "Accept: application/json" \
 -H "Content-Type:application/json" \
 -X POST --data '{"username": "coherence", "password": "rocks"}' \
 "http://localhost:8090/login"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Let&#8217;s access the HelloController</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> $ curl -i -b cookie.txt \
 -H "Accept: application/json" \
 -H "Content-Type:application/json" \
 -X GET "http://localhost:8090/hello"</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="spring-session-sample-actuator"><a class="anchor" href="#spring-session-sample-actuator"></a>5.3.1.4. Spring Session Actuator</h5>
<div class="paragraph">
<p>Using Spring Boot&#8217;s Actuator endpoints, we can introspect the session using the
<a href="https://docs.spring.io/spring-boot/docs/current/actuator-api/htmlsingle/#sessions">Sessions actuator</a> at
<code><a href="http://localhost:8090/actuator/sessions?username=coherence" class="bare">localhost:8090/actuator/sessions?username=coherence</a></code>.</p>
</div>
<div class="listingblock">
<div class="title">Retrieving session information for user <code>coherence</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> $ curl -i -b cookie.txt \
 -H "Accept: application/json" \
 -H "Content-Type:application/json" \
 -X GET "http://localhost:8090/actuator/sessions?username=coherence"</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="spring-session-sample-docker"><a class="anchor" href="#spring-session-sample-docker"></a>5.3.1.5. Generate Docker Image</h5>
<div class="paragraph">
<p>If you prefer to use Docker, you can create an image using:</p>
</div>
<div class="listingblock">
<div class="title">Generate a Docker image</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> $ mvn spring-boot:build-image -pl samples/spring-session-demo/spring-session-demo-app -Dspring-boot.build-image.imageName=coherence/spring_session_demo</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="spring-session-with-plain-spring-framework"><a class="anchor" href="#spring-session-with-plain-spring-framework"></a>5.3.2. Spring Session with plain Spring Framework</h4>
<div class="paragraph">
<p>While most new Spring applications are written using Spring Boot, there are certainly many applications that use
the Spring Framework, only. Therefore, the following example uses plain Spring Framework without any Spring Boot and
deploys as a WAR file to a Servlet container such as Tomcat or Jetty. The application will expose one endpoint that
displays a simple counter that is incremented with each request and stored in the HTTP Session that is in return backed
by Coherence.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Coherence Spring <code>4.1.2-SNAPSHOT</code> is using the Jakarta EE namespace. For Java EE (<code>javax.*</code>), please use
Coherence Spring <code>3.3.x</code>. Therefore, chose the appropriate version of the Servlet container accordingly.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This example uses a separate Coherence server instance to which the application will connect to using Coherence*Extend.
Furthermore, <a href="https://docs.oracle.com/en/middleware/standalone/coherence/14.1.1.2206/develop-applications/using-portable-object-format.html#GUID-F331E5AB-0B3B-4313-A2E3-AA95A40AD913">Coherence POF</a>
is used for serialization. We will re-use the Coherence server from the <code>spring-session-demo-server</code> Maven module. This
will start 1 central Coherence server instance and the application will access that remote Coherence instance as a
Coherence*Extend client. In order to build the server application, execute the following in the root directory of the
Coherence Spring source code repository:</p>
</div>
<div class="listingblock">
<div class="title">Build the Coherence Server instance</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> $ ./mvnw clean package -pl samples/spring-session-demo/spring-session-demo-server</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, we will build the client application:</p>
</div>
<div class="listingblock">
<div class="title">Build the Client Application</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> $ ./mvnw clean package -pl samples/spring-session-demo/spring-session-demo-war</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Coherence-specific configuration of the client is fairly straight-forward and mostly
contained in the Spring configuration class <code>CoherenceSessionConfig</code>:</p>
</div>
<div class="listingblock">
<div class="title">CoherenceSessionConfig.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"> @Configuration
 @EnableCoherence                                                        <i class="conum" data-value="1"></i><b>(1)</b>
 @EnableCoherenceHttpSession(                                            <i class="conum" data-value="2"></i><b>(2)</b>
     cache = "spring:session:sessions",
     flushMode = FlushMode.ON_SAVE,
     sessionTimeoutInSeconds = 1800,
     useEntryProcessor = false
 )
 public class CoherenceSessionConfig
        extends AbstractHttpSessionApplicationInitializer {              <i class="conum" data-value="3"></i><b>(3)</b>
     @Bean
     public SessionConfigurationBean sessionConfigurationBeanDefault() { <i class="conum" data-value="4"></i><b>(4)</b>
         final SessionConfigurationBean sessionConfigurationBean =
             new SessionConfigurationBean();
         sessionConfigurationBean.setType(SessionType.CLIENT);           <i class="conum" data-value="5"></i><b>(5)</b>
         sessionConfigurationBean.setConfig("remote-cache-config.xml");  <i class="conum" data-value="6"></i><b>(6)</b>
         return sessionConfigurationBean;
     }
 }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enable Coherence Spring</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Enable the Spring Session support for Coherence + you can specify several optional parameters</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Extend <code>AbstractHttpSessionApplicationInitializer</code> to register the <code>springSessionRepositoryFilter</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Create a <code>SessionConfigurationBean</code> to configure the Coherence Session</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Set the session type to <code>CLIENT</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Set the Coherence configuration file to <code>remote-cache-config.xml</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Coherence-specific <code>remote-cache-config.xml</code> configures the <code>ExtendTcpCacheService</code> and creates a cache mapping
for the cache <code>spring:session:sessions</code> to the <code>remote-cache-scheme</code> that uses the <code>ExtendTcpCacheService</code>.</p>
</div>
<div class="paragraph">
<p>Now we are ready to run the application. First, we will start the server. The server application uses Spring Boot and by
activating a custom Spring Boot profile, Coherence will be started with POF serialization enabled:</p>
</div>
<div class="listingblock">
<div class="title">coherence-cache-config-pof.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"> &lt;cache-config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
               xmlns="http://xmlns.oracle.com/coherence/coherence-cache-config"
               xsi:schemaLocation="http://xmlns.oracle.com/coherence/coherence-cache-config coherence-cache-config.xsd"&gt;
   &lt;defaults&gt;
     &lt;serializer&gt;pof&lt;/serializer&gt;
   &lt;/defaults&gt;
 ...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Run the Server application with the POF profile</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> $ java -jar samples/spring-session-demo/spring-session-demo-server/target/spring-session-demo-server-4.1.2-SNAPSHOT.jar --spring.profiles.active=pof</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the client application, deploy the generated WAR file <code>spring-session-demo.war</code> in
<code>samples/spring-session-demo/spring-session-demo-war/target</code> to a Servlet container, for example Tomcat 10.1.18.</p>
</div>
<div class="listingblock">
<div class="title">Deploy WAR file to Tomcat 10.1.18</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> $ cp samples/spring-session-demo/spring-session-demo-war/target/spring-session-demo.war /path/to/apache-tomcat-10.1.18/webapps</code></pre>
</div>
</div>
<div class="paragraph">
<p>The application should start up and connect to the Coherence server instance. You can then access the application at</p>
</div>
<div class="paragraph">
<p><code><a href="http://localhost:8080/spring-session-demo/hello" class="bare">localhost:8080/spring-session-demo/hello</a></code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/spring-session-demo-war.png" alt="Spring Session Demo" width="50%">
</div>
<div class="title">Figure 3. Spring Session Demo</div>
</div>
<div class="paragraph">
<p>The invoked <code>HelloController</code> will display a simple counter that is incremented with each request and whose value is
stored in the HTTP Session.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-session-expiration-strategies"><a class="anchor" href="#spring-session-expiration-strategies"></a>5.4. Session Expiration Strategies</h3>
<div class="paragraph">
<p>When dealing with the expiration of cache entries, you generally have 2 options in Coherence:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the expiration time for each put operation explicitly</p>
</li>
<li>
<p>Configure caches in your <code>coherence-cache-config.xml</code> file</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you define a session timeout via the application, for example <code>@EnableCoherenceHttpSession(sessionTimeoutInSeconds = 1000)</code>,
the session expiration will be set for each put-operation in <code>CoherenceIndexedSessionRepository</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If not set in the application, Coherence Spring will expire HTTP session caches in <code>1800</code> seconds (<code>30</code> minutes).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you rather prefer defining the session expiration timeouts in your <code>coherence-cache-config.xml</code> file, you
should set the session timeout in the application to <code>0</code>, for instance <code>@EnableCoherenceHttpSession(sessionTimeoutInSeconds = 0)</code>.
That way, put operations will never to set an expiration value for the cache entry. You can then set the <code>expiry-delay</code>
cache configuration element for your cache in the <code>coherence-cache-config.xml</code> file.</p>
</div>
<div class="paragraph">
<p>In regard to the question, whether one strategy or the other strategy is preferable: It is mostly a
matter of preference. You do have, however, a bit more control when configuring expiration logic via the
<code>coherence-cache-config.xml</code> file, as you have the ability to define custom eviction policies.</p>
</div>
<div class="paragraph">
<p>For more information, please consult the <a href="https://docs.oracle.com/en/middleware/standalone/coherence/14.1.1.2206/develop-applications/configuring-caches.html#GUID-B57A0E9B-23F2-4099-86D7-6DDD54BBC45C">respective chapter</a>
on <em>Controlling the Growth of a Local Cache</em> in the Coherence reference guide.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The underlying expiry delay parameter in Coherence is defined as an integer and is expressed in milliseconds.
Therefore, the maximum amount of time can never exceed Integer.MAX_VALUE (2147483647) milliseconds or approximately 24
days.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-data"><a class="anchor" href="#spring-data"></a>6. Coherence Spring Data</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="spring-data-introduction"><a class="anchor" href="#spring-data-introduction"></a>6.1. Introduction</h3>
<div class="paragraph">
<p>The Spring Data Coherence module provides integration with Coherence data grids. Key functional areas of Spring Data Coherence are a POJO centric model for interacting with a Coherence data grid and easily writing a Repository style data access layer.</p>
</div>
</div>
<div class="sect2">
<h3 id="features"><a class="anchor" href="#features"></a>6.2. Features</h3>
<div class="ulist">
<ul>
<li>
<p>Spring configuration support using Java-based @Configuration classes.</p>
</li>
<li>
<p>Automatic implementation of Repository interfaces</p>
</li>
<li>
<p>Rich query and event features from Coherence</p>
</li>
<li>
<p>Native asynchronous repository support</p>
</li>
<li>
<p>Projections</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="getting-started"><a class="anchor" href="#getting-started"></a>6.3. Getting Started</h3>
<div class="exampleblock">
<div class="title">Example 7. Coherence Spring Data Dependencies</div>
<div class="content">
<div class="listingblock primary">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.oracle.coherence.spring&lt;/groupId&gt;
    &lt;artifactId&gt;coherence-spring-data&lt;/artifactId&gt;
    &lt;version&gt;4.1.2-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">implementation("com.oracle.coherence.spring:coherence-spring-data:4.1.2-SNAPSHOT")</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="defining-repositories"><a class="anchor" href="#defining-repositories"></a>6.4. Defining Repositories</h3>
<div class="paragraph">
<p>Before proceeding, please be familiar with the <a href="https://docs.spring.io/spring-data/commons/docs/current/reference/html/">Spring Data Commons</a> documentation, as this
section will assume some familiarity with Spring Data.</p>
</div>
<div class="paragraph">
<p>Simple repositories such as the following will, of course, work as expected:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface PersonRepository extends CrudRepository&lt;String, Person&gt; {
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, it is recommended to extend the
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/data/repository/CoherenceRepository.html">CoherenceRepository</a> interface,
to fully utilize the features Coherence for Spring Data has to offer such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Powerful projection features</p>
</li>
<li>
<p>Flexible in-place entity updates</p>
</li>
<li>
<p>First-class data aggregation support</p>
</li>
<li>
<p>Stream API support</p>
</li>
<li>
<p>Event listener support</p>
</li>
<li>
<p>Declarative acceleration and index creation</p>
</li>
<li>
<p>Native asynchronous support</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please also see the chapter <a href="https://docs.oracle.com/en/middleware/standalone/coherence/14.1.1.2206/develop-applications/using-repository-api.html">Using the Repository API</a>
of the Coherence reference documentation for more details on these features.</p>
</div>
<div class="paragraph">
<p>Example extending the blocking <code>CoherenceRepository</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import com.oracle.coherence.spring.data.repository.CoherenceRespository;

// ...

public interface PersonRepository extends CoherenceRepository&lt;String, Person&gt; {
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>or for the non-blocking flavor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import com.oracle.coherence.spring.data.repository.CoherenceAsyncRespository;

// ...

public interface PersonRepository extends CoherenceAsyncRepository&lt;String, Person&gt; {
    // ...
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the less common use-case of using the <code>update</code> method of the <code>CoherenceRepository</code> to update entities with an entity
Id that does NOT exist, a <code>NullPointerException</code> may be thrown. In order to plug-in your own logic, you can either
provide an <code>EntityFactory</code> to create a new instance or you can provide a lambda expression that e.g. throws an exception:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">this.bookRepository.update(new UUID(), Book::setPages, 700, uuid -&gt; {
    throw new IllegalStateException("The book with id " + uuid + " does not exist.");
});</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="identifying-the-coherence-namedmap"><a class="anchor" href="#identifying-the-coherence-namedmap"></a>6.4.1. Identifying the Coherence NamedMap</h4>
<div class="paragraph">
<p>The Coherence <code>NamedMap</code> that will be used by the Repository implementation
will be based on the type name in the Repository class assuming the Repository
name follows the format of [Type]Repository (e.g., PersonRepository will use a NamedMap called <code>person</code>).
If this is not desired, the name may instead be passed by the <code>@CoherenceMap</code> annotation.  For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import com.oracle.coherence.spring.data.config.CoherenceMap;
import com.oracle.coherence.spring.data.repository.CoherenceRespository;

// ...

@CoherenceMap("people")
public interface PersonRepository extends CoherenceRepository&lt;String, Person&gt; {
    // ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mapping-entities"><a class="anchor" href="#mapping-entities"></a>6.5. Mapping Entities</h3>
<div class="paragraph">
<p>As Coherence is, at its core, a key-value store, mapping Entities for use with a Coherence
Repository is relatively simple as only the id needs to be annotated.  It is possible to
use either <code>org.springframework.data.annotation.Id</code> or <code>javax.persistence.Id</code> to denote the
entity&#8217;s id.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Person implements Serializable {
    @org.springframework.data.annotation.Id
    protected String id;

    // ---- person functionality ----
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-the-repository"><a class="anchor" href="#using-the-repository"></a>6.6. Using the Repository</h3>
<div class="paragraph">
<p>In order to enable Coherence-based Repositories, you must use the
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/data/config/EnableCoherenceRepositories.html">@EnableCoherenceRepositories</a>
annotation. A simple configuration example would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import com.oracle.coherence.spring.configuration.annotation.EnableCoherence;
import com.oracle.coherence.spring.configuration.data.config.EnableCoherenceRepositories;

// ...

@Configuration
@EnableCoherence
@EnableCoherenceRepositories
public static class Config {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly to other Spring Data implementations, the <code>@EnableCoherenceRepositories</code> annotation
offers several configuration options to configure how Spring will search for repositories.
Please see the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/">API docs</a> for details.</p>
</div>
<div class="sect3">
<h4 id="finder-queries"><a class="anchor" href="#finder-queries"></a>6.6.1. Finder Queries</h4>
<div class="paragraph">
<p>One of the benefits of Spring Data is the ability to define queries on the Repository interface
using Spring Data&#8217;s <a href="https://docs.spring.io/spring-data/commons/docs/current/reference/html/#repositories.query-methods.details">finder query</a> syntax.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import com.oracle.coherence.spring.data.repository.CoherenceRespository;
import com.oracle.coherence.spring.data.model.Author;
import com.oracle.coherence.spring.data.model.Book;
import com.tangosol.util.UUID;

// ...

public interface BookRepository extends CoherenceRepository&lt;Book, UUID&gt; {
    List&lt;Book&gt; findByAuthor(Author author);
    // other finders
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It should be noted that finder queries defined on either the blocking or non-blocking
Coherence repository will always execute in a blocking manner.  For asynchronous versions
of these methods, please use Spring&#8217;s <a href="https://spring.io/guides/gs/async-method/">Async Method</a> support.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import com.oracle.coherence.spring.data.config.CoherenceMap;
import com.oracle.coherence.spring.data.model.Author;
import com.oracle.coherence.spring.data.model.Book;
import com.oracle.coherence.spring.data.repository.CoherenceAsyncRepository;
import com.tangosol.util.UUID;

import org.springframework.scheduling.annotation.Async;

// ...

@CoherenceMap("book")
public interface CoherenceBookAsyncRepository extends CoherenceAsyncRepository&lt;Book, UUID&gt; {

    @Async
    CompletableFuture&lt;List&lt;Book&gt;&gt; findByAuthor(Author author);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Don&#8217;t forget to include the <code>@EnableAsync</code> annotation on the configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import com.oracle.coherence.spring.configuration.annotation.EnableCoherence;
import com.oracle.coherence.spring.configuration.data.config.EnableCoherenceRepositories;
import org.springframework.scheduling.annotation.EnableAsync;

// ...

@Configuration
@EnableAsync
@EnableCoherence
@EnableCoherenceRepositories
public static class Config {
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="projections"><a class="anchor" href="#projections"></a>6.7. Projections</h3>
<div class="paragraph">
<p>Spring Data Coherence module supports projections as defined in <a href="https://docs.spring.io/spring-data/commons/docs/current/reference/html/#projections">Spring Data Projections</a> documentation. This allows us,
among other things, to transfer a subset of the entities properties when <code>closed</code> projections are used.</p>
</div>
<div class="paragraph">
<p>Imagine a repository and aggregate root type such as the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Entity
public class Book implements Cloneable, Serializable {
    @Id
    protected final UUID uuid;
    protected String title;
    protected Author author;
    protected int pages;
    protected Calendar published;
}

@CoherenceMap("book")
interface BookRepository extends CrudRepository&lt;Book, UUID&gt; {

    List&lt;BookProjection&gt; findByTitle(String title);

    // ...
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="interface-based-projections"><a class="anchor" href="#interface-based-projections"></a>6.7.1. Interface-based Projections</h4>
<div class="paragraph">
<p>The simplest way to simplify the result is to declare an interface that exposes methods reading the desired properties, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">A projection interface to retrieve a subset of attributes</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">interface BookTitleAndPages {

    String getTitle();
    int getPages();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">A repository using an interface based projection with a query method</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">interface BookRepository extends CrudRepository&lt;Book, UUID&gt; {

    List&lt;BookTitleAndPages&gt; findByTitle(String title);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The query execution engine creates proxy instances of that interface at runtime for each element returned and forwards calls to the exposed methods to the target object.</p>
</div>
<div class="paragraph">
<p>Projections can be used recursively as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">A projection interface to retrieve a subset of attributes</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">interface BookSummary {

    String getTitle();
    int getPages();
    AuthorSummary getAuthor();

    interface AuthorSummary {
        String getFirstName();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="closed-projections"><a class="anchor" href="#closed-projections"></a>6.7.2. Closed Projections</h4>
<div class="paragraph">
<p>A projection interface whose accessor methods all match properties of the target aggregate is considered to be a closed projection. The following example is a closed projection:</p>
</div>
<div class="listingblock">
<div class="title">A closed projection</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">interface BookTitleAndPages {

    String getTitle();
    int getPages();
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="open-projections"><a class="anchor" href="#open-projections"></a>6.7.3. Open Projections</h4>
<div class="paragraph">
<p>Accessor methods in projection interfaces can also be used to compute new values by using the @Value annotation, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">An open projection</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">interface BookTitleAndAuthor {

    @Value("#{target.author.firstName + ' - ' + target.title}")
    String getTitleAndAuthor();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A projection interface using <code>@Value</code> is an open projection. Spring Data cannot apply query execution optimizations in this case, because the SpEL expression could use any attribute of the aggregate root.</p>
</div>
<div class="paragraph">
<p>Default methods also can be used for open projection interfaces:</p>
</div>
<div class="listingblock">
<div class="title">A projection interface using a default method for custom logic</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">interface BookTitleAndAuthor {

    default String getTitleAndAuthor() {
        return getAuthor().getFirstName().concat(' - ').concat(getTitle());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A more flexible option is to implement the custom logic in a Spring bean:</p>
</div>
<div class="listingblock">
<div class="title">A projection interface using a default method for custom logic</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Component
class MyBean {

    String getTitleAndAuthor(Book book) {
        return book.getAuthor().getFirstName().concat(' - ').concat(book.getTitle());
    }
}

interface BookTitleAndAuthor {

    @Value("#{@myBean.getTitleAndAuthor(target)}")
    String getTitleAndAuthor();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Methods backed by SpEL expression evaluation can also use method parameters, which can then be referred to from the expression. The method parameters are available through an Object array named args. The following example shows how to get a method parameter from the args array:</p>
</div>
<div class="listingblock">
<div class="title">A sample Book object</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">interface NameOnly {

    @Value("args[0] + ' ' + #{target.author.firstName}")
    String getHonorificName(String honorific);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="nullable-wrappers"><a class="anchor" href="#nullable-wrappers"></a>6.7.4. Nullable Wrappers</h4>
<div class="paragraph">
<p>Getters in projection interfaces can make use of nullable wrappers for improved null-safety.
Currently supported wrapper types are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>java.util.Optional</p>
</li>
<li>
<p>com.google.common.base.Optional</p>
</li>
<li>
<p>scala.Option</p>
</li>
<li>
<p>io.vavr.control.Option</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">A projection interface using nullable wrappers</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">interface TitleOnly {

    Optional&lt;String&gt; getTitle();
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="class-based-projections-dtos"><a class="anchor" href="#class-based-projections-dtos"></a>6.7.5. Class-based Projections (DTOs)</h4>
<div class="paragraph">
<p>Another way of defining projections is by using value type DTOs (Data Transfer Objects) that hold properties for the fields that are supposed to be retrieved - similar to the projection interfaces except that no proxying happens and no nested projections can be applied.</p>
</div>
<div class="paragraph">
<p>The fields to be loaded are determined from the parameter names of the constructor that is exposed.</p>
</div>
<div class="paragraph">
<p>The following example shows a projecting DTO:</p>
</div>
<div class="listingblock">
<div class="title">A projecting DTO</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class BookTitleAndPages {
    private final String title;
    private final int pages;

    BookTitleAndPages(String title, int pages) {
        this.title = title;
        this.pages = pages;
    }

    String getTitle() {
        return this.title;
    }

    int getPages() {
        return this.pages;
    }

    // equals(…) and hashCode() implementations
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dynamic-projections"><a class="anchor" href="#dynamic-projections"></a>6.7.6. Dynamic Projections</h4>
<div class="paragraph">
<p>It&#8217;s possible to select the return type to be used at invocation time (up to now all examples shown exact projection type to be used as a return type). To apply dynamic projections, use a query method such as the one shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">A repository using a dynamic projection parameter</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CoherenceMap("book")
interface BookRepository extends CrudRepository&lt;Book, UUID&gt; {

    &lt;T&gt; Collection&lt;T&gt; findByTitle(String title, Class&lt;T&gt; type);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Using a repository with dynamic projections</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Collection&lt;BookSummary&gt; aggregates = books.findByTitle("Shadow", BookSummary.class);

Collection&lt;BookTitleAndPages&gt; aggregates = books.findByTitle("Remember", BookTitleAndPages.class);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-boot"><a class="anchor" href="#spring-boot"></a>7. Coherence Spring Boot</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section dives into the Coherence Spring Boot module. It explains how to use
Coherence&#8217;s dedicated support for <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/">Spring Boot</a>, e.g., Autoconfiguration.</p>
</div>
<div class="sect2">
<h3 id="spring-boot-getting-started"><a class="anchor" href="#spring-boot-getting-started"></a>7.1. Getting Started</h3>
<div class="paragraph">
<p>In order to start using Coherence with Spring Boot you have to add the <code>coherence-spring-boot-starter</code> dependency as well
as the desired version of Coherence.</p>
</div>
<div class="exampleblock">
<div class="title">Example 8. Adding the Coherence Spring Boot Starter Dependency</div>
<div class="content">
<div class="listingblock primary">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.oracle.coherence.spring&lt;/groupId&gt;
        &lt;artifactId&gt;coherence-spring-boot-starter&lt;/artifactId&gt;
        &lt;version&gt;4.1.2-SNAPSHOT&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.oracle.coherence.ce&lt;/groupId&gt;
        &lt;artifactId&gt;coherence&lt;/artifactId&gt;
        &lt;version&gt;23.09.2&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">dependencies {
    compile("com.oracle.coherence.spring:coherence-spring-boot-starter:4.1.2-SNAPSHOT")
    compile("com.oracle.coherence.ce:coherence:23.09.2")
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
As Coherence Spring takes advantage of the new Coherence Bootstrap API, it requires Oracle Coherence CE version
<code>20.12</code> or higher.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="spring-boot-using-coherence"><a class="anchor" href="#spring-boot-using-coherence"></a>7.2. Using Coherence with Spring Boot</h3>
<div class="paragraph">
<p>By adding the <code>coherence-spring-boot-starter</code> dependency, AutoConfiguration will be activated via the
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/boot/autoconfigure/CoherenceAutoConfiguration.html">CoherenceAutoConfiguration</a>
class. This will also bind the <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/boot/autoconfigure/CoherenceProperties.html">CoherenceProperties</a>
class for further configuration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, Coherence Spring will start Coherence in clustered mode (Server). If you want to use Coherence in
client mode (Coherence*Extend or gRPC), please see the chapter on <a href="#spring-boot-coherence-cluster-setup-client">setting
up Spring Boot as a Coherence Client</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Additional configuration can be provided for instance via Spring Boot&#8217;s <code>application.yaml</code> or <code>application.properties</code> file.
For instance YAML configuration for Spring Boot&#8217;s Coherence support may look like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">coherence:
  property-prefix: "coherence.properties."
  logging:
    destination: slf4j
    logger-name: MyCoherence
  sessions:
  - name: default
    config: "coherence-cache-config.xml"
    priority: 1
  - name: test
    config: "test-coherence-config.xml"
    priority: 2
  properties:
    coherence.log.limit: 400
    coherence.log.level: 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following configuration properties are available.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Coherence Configuration Properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">coherence.logging.destination</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slf4j</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of the logging destination.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">coherence.logging.severity-level</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies which logged messages are emitted to the log destination. The legal values are <code>-1</code> to <code>9</code>.
No messages are emitted if <code>-1</code> is specified. More log messages are emitted as the log level is increased.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">coherence.logging.logger-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Coherence</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies a logger name within chosen logging system</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">coherence.logging.message-format</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies how messages that have a logging level specified are formatted before passing them to the log destination.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">coherence.logging.character-limit</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the maximum number of characters that the logger daemon processes from the message queue before discarding
  all remaining messages in the queue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">coherence.sessions.&lt;type&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the type of the session. One of the following: <code>server</code>, <code>client</code> (For both Coherence*Extend and gRPC)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">coherence.sessions.&lt;type&gt;[0].name</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the session.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">coherence.sessions.&lt;type&gt;[0].config</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Coherence cache configuration URI for the session</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">coherence.sessions.&lt;type&gt;[0].priority</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SessionConfiguration#DEFAULT_PRIORITY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The priority order to be used when starting the session. Sessions will be started with the lowest priority first.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">coherence.sessions.&lt;type&gt;[0].scope-name</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The scope name for the session.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">coherence.instance.type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on session type. As soon as you specify a <code>server</code> session, it defaults to <code>cluster</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type of the Coherence instance: <code>cluster</code> or <code>client</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">coherence.server.startup-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides the default startup-timeout when starting Coherence.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>Session</code>-related configuration properties are defined based on the session type in:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/configuration/session/AbstractSessionConfigurationBean.html">AbstractSessionConfigurationBean</a></p>
</li>
<li>
<p><a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/configuration/session/SessionConfigurationBean.html">SessionConfigurationBean</a></p>
</li>
<li>
<p><a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/configuration/session/ClientSessionConfigurationBean.html">ClientSessionConfigurationBean</a></p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Many properties are translated into native Coherence properties. If both
Spring Boot property AND a native property <code>coherence.properties.*</code> are configured, the Spring Boot
property is used.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the provided Spring Boot configuration properties are not sufficient for your needs, you can also specify any of
the native Coherence properties. For a list of available native properties, please consult the reference guide chapter on
<a href="https://docs.oracle.com/en/middleware/standalone/coherence/14.1.1.2206/develop-applications/system-property-overrides.html#GUID-32230D28-4976-4147-A887-0A0120FF5C7E">System Property Overrides</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-boot-coherence-cluster-setup"><a class="anchor" href="#spring-boot-coherence-cluster-setup"></a>7.3. Coherence Cluster Setup</h3>
<div class="paragraph">
<p>In order to set up Coherence clusters with Spring Boot, you can use the following approaches:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Co-locate Coherence instances with your application</p>
</li>
<li>
<p>Access a dedicated Coherence Cluster as a Client, either via <em>gRPC</em> or <em>Coherence*Extend</em>.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For an in-depth introduction to Coherence clusters, please consult the chapter
<a href="https://docs.oracle.com/en/middleware/standalone/coherence/14.1.1.2206/develop-applications/introduction-coherence-clusters.html#GUID-92569674-E077-46CE-BA06-1BA2DD59B605">Introduction to Coherence Clusters</a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="spring-boot-coherence-cluster-setup-co-located"><a class="anchor" href="#spring-boot-coherence-cluster-setup-co-located"></a>7.3.1. Co-located Coherence Clusters</h4>
<div class="paragraph">
<p>In this setup, Coherence is started as part of your Spring Boot application. Each instance of your application will run
Coherence and using the Tangosol Cluster Management Protocol (TCMP), they will form a Coherence cluster. This is typically
the recommended approach for most use-cases and the default. Therefore, by just adding the <code>coherence-spring-boot-starter</code>
Maven dependency, Spring Boot autoconfiguration for Coherence is enabled and will enable Coherence in Server (Clustered)
mode.</p>
</div>
<div class="paragraph">
<p>If you need to provide additional configuration, e.g. to point to your own Coherence cache configuration file or to
provide Coherence <a href="https://docs.oracle.com/en/middleware/standalone/coherence/14.1.1.2206/develop-applications/system-property-overrides.html">System Property Overrides</a>,
you can add those to your <code>application.yaml</code> file:</p>
</div>
<div class="listingblock">
<div class="title">Coherence Configuration Properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">coherence:
  sessions:
    server:
      - name: default
        config: "coherence-cache-config.xml"  <i class="conum" data-value="1"></i><b>(1)</b>
  logging:
    destination: slf4j                        <i class="conum" data-value="2"></i><b>(2)</b>
coherence.wka: 127.0.0.1                      <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The Coherence cache configuration URI for the session (classpath resource)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Several Oracle Coherence system property overrides are directly mapped to Spring Boot properties</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Alternatively, you can specify <em>any</em> Coherence system property override directly as well</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="spring-boot-coherence-cluster-setup-client"><a class="anchor" href="#spring-boot-coherence-cluster-setup-client"></a>7.3.2. Access Coherence Clusters as a Client</h4>
<div class="paragraph">
<p>In this approach, your Spring Boot application will connect to a dedicated Coherence cluster as a client. This can be
done either via <em>Coherence*Extend</em> or <a href="https://grpc.io/">gRPC</a>. For your Spring Boot application, the configuration is
basically the same for both approaches. In your Spring Boot <code>application.yaml</code> file, you will need to specify the following:</p>
</div>
<div class="listingblock">
<div class="title">Coherence Client Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">coherence:
  spring:
    - server:                           <i class="conum" data-value="1"></i><b>(1)</b>
    - client:                           <i class="conum" data-value="2"></i><b>(2)</b>
      - name: default
        config: remote-cache-config.xml <i class="conum" data-value="3"></i><b>(3)</b>
coherence.tcmp.enabled: false           <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Disable the server (clustered) session</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Enable the client session</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The Coherence cache configuration URI for the client session, which contains the gRPC or Coherence*Extend-specific configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Disable TCMP</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When setting up pure client connections to a Coherence cluster, you should ensure that TCMP is disabled. For
more information, please see <a href="https://docs.oracle.com/en/middleware/standalone/coherence/14.1.1.2206/develop-remote-clients/configuring-extend-clients.html#GUID-F8832F4C-2F88-4DE4-A804-D100D47B552C">Disabling TCMP Communication</a>
in the Coherence reference guide.
</td>
</tr>
</table>
</div>
<div id="spring-boot-coherence-cluster-setup-client-bean" class="paragraph">
<p>An alternative to the yaml or properties configuration above is to specify a dedicated <code>SessionConfigurationBean</code> in
your Spring Boot application.</p>
</div>
<div class="listingblock">
<div class="title">Configure the Coherence Client using a SessionConfigurationBean</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
public class CoherenceClientConfig {
  @Bean
  public SessionConfigurationBean grpcSessionConfigurationBean() {
    final ClientSessionConfigurationBean sessionConfigurationBean = new ClientSessionConfigurationBean();
    sessionConfigurationBean.setName(SessionConfigurationBean.DEFAULT_SESSION_NAME);
    sessionConfigurationBean.setConfig("remote-cache-config.xml");
    return sessionConfigurationBean;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the configuration above the <code>remote-cache-config.xml</code> file will contain the relevant Coherence configuration for
either <em>Coherence*Extend</em> or <em>gRPC</em>. The configuration for both approaches is described in the following sections.</p>
</div>
<div class="sect4">
<h5 id="spring-boot-coherence-cluster-setup-client-grpc"><a class="anchor" href="#spring-boot-coherence-cluster-setup-client-grpc"></a>7.3.2.1. gRPC</h5>
<div class="paragraph">
<p>The main gRPC configuration is done in your <code>coherence-cache-config.xml</code> file. The configuration would look similar to the
following:</p>
</div>
<div class="listingblock">
<div class="title">Minimal gRPC Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0"?&gt;
&lt;cache-config
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns="http://xmlns.oracle.com/coherence/coherence-cache-config"
    xsi:schemaLocation="http://xmlns.oracle.com/coherence/coherence-cache-config coherence-cache-config.xsd"&gt;
    &lt;caching-scheme-mapping&gt;
        &lt;cache-mapping&gt;
            &lt;cache-name&gt;*&lt;/cache-name&gt;                   <i class="conum" data-value="1"></i><b>(1)</b>
            &lt;scheme-name&gt;remote-grpc&lt;/scheme-name&gt;       <i class="conum" data-value="2"></i><b>(2)</b>
        &lt;/cache-mapping&gt;
    &lt;/caching-scheme-mapping&gt;

    &lt;caching-schemes&gt;
        &lt;remote-grpc-cache-scheme&gt;                       <i class="conum" data-value="3"></i><b>(3)</b>
            &lt;scheme-name&gt;remote-grpc&lt;/scheme-name&gt;
            &lt;service-name&gt;RemoteGrpcCache&lt;/service-name&gt; <i class="conum" data-value="4"></i><b>(4)</b>
            &lt;cluster-name&gt;Mycluster&lt;/cluster-name&gt;
        &lt;/remote-grpc-cache-scheme&gt;
    &lt;/caching-schemes&gt;
&lt;/cache-config&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The cache name <code>*</code> is a wildcard and will match all caches</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The scheme name <code>remote-grpc</code> is used to map the all caches to the scheme</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>remote-grpc</code> cache is defined in the <code>remote-grpc-cache-scheme</code> XML element</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The reference to the gRPC service name</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For more information on gRPC, please consult the chapter on
<a href="https://docs.oracle.com/en/middleware/standalone/coherence/14.1.1.2206/develop-remote-clients/getting-started-grpc.html">Getting Started with gRPC</a> in the Coherence
reference guide.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="spring-boot-coherence-cluster-setup-client-extend"><a class="anchor" href="#spring-boot-coherence-cluster-setup-client-extend"></a>7.3.2.2. Coherence*Extend</h5>
<div class="paragraph">
<p>The setup for Coherence*Extend is very similar to the gRPC setup. The main difference is that you will use the
<code>remote-cache-scheme</code> XML element instead. The configuration would look similar to the following:</p>
</div>
<div class="listingblock">
<div class="title">Minimal Coherence*Extend Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0"?&gt;
&lt;cache-config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xmlns="http://xmlns.oracle.com/coherence/coherence-cache-config"
              xsi:schemaLocation="http://xmlns.oracle.com/coherence/coherence-cache-config coherence-cache-config.xsd"&gt;

    &lt;caching-scheme-mapping&gt;
        &lt;cache-mapping&gt;
            &lt;cache-name&gt;*&lt;/cache-name&gt;                         <i class="conum" data-value="1"></i><b>(1)</b>
            &lt;scheme-name&gt;remote&lt;/scheme-name&gt;                  <i class="conum" data-value="2"></i><b>(2)</b>
        &lt;/cache-mapping&gt;
    &lt;/caching-scheme-mapping&gt;

    &lt;caching-schemes&gt;
        &lt;remote-cache-scheme&gt;                                  <i class="conum" data-value="3"></i><b>(3)</b>
            &lt;scheme-name&gt;remote&lt;/scheme-name&gt;
            &lt;service-name&gt;ExtendTcpCacheService&lt;/service-name&gt;
        &lt;/remote-cache-scheme&gt;
    &lt;/caching-schemes&gt;
&lt;/cache-config&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The cache name <code>*</code> is a wildcard and will match all caches</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The scheme name <code>remote</code> is used to map the all caches to the scheme</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>remote</code> cache scheme is defined in the <code>remote-cache-scheme</code> XML element</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The configuration above will use the name service to discover the Coherence cluster and thus the exposed Coherence*Extend
port. However, you can also specify the host and port explicitly. Here is an example of the configuration where the
Coherence*Extend host and port are specified explicitly:</p>
</div>
<div class="listingblock">
<div class="title">Coherence*Extend Configuration with explicit host/port configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0"?&gt;
&lt;cache-config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xmlns="http://xmlns.oracle.com/coherence/coherence-cache-config"
              xsi:schemaLocation="http://xmlns.oracle.com/coherence/coherence-cache-config coherence-cache-config.xsd"&gt;

    &lt;caching-scheme-mapping&gt;
        &lt;cache-mapping&gt;
            &lt;cache-name&gt;*&lt;/cache-name&gt;
            &lt;scheme-name&gt;remote&lt;/scheme-name&gt;
        &lt;/cache-mapping&gt;
    &lt;/caching-scheme-mapping&gt;

    &lt;caching-schemes&gt;
        &lt;remote-cache-scheme&gt;
            &lt;scheme-name&gt;remote&lt;/scheme-name&gt;
            &lt;service-name&gt;ExtendTcpCacheService&lt;/service-name&gt;
            &lt;initiator-config&gt;
                &lt;tcp-initiator&gt;
                    &lt;name-service-addresses&gt;
                        &lt;socket-address&gt;
                            &lt;address&gt;127.0.0.1&lt;/address&gt;
                            &lt;port&gt;7574&lt;/port&gt;
                        &lt;/socket-address&gt;
                    &lt;/name-service-addresses&gt;
                &lt;/tcp-initiator&gt;
                &lt;outgoing-message-handler&gt;
                    &lt;request-timeout&gt;5s&lt;/request-timeout&gt;
                &lt;/outgoing-message-handler&gt;
            &lt;/initiator-config&gt;
        &lt;/remote-cache-scheme&gt;
    &lt;/caching-schemes&gt;
&lt;/cache-config&gt;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For more information on Coherence*Extend, please consult the chapter on
<a href="https://docs.oracle.com/en/middleware/standalone/coherence/14.1.1.2206/develop-remote-clients/getting-started-coherenceextend.html">Getting Started with Coherence*Extend
</a> in the Coherence reference guide.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-boot-config-data-api"><a class="anchor" href="#spring-boot-config-data-api"></a>7.4. Support of the Spring Boot ConfigData API</h3>
<div class="paragraph">
<p>Since Spring Boot <code>2.4.x</code>, you can define your own
<a href="https://spring.io/blog/2020/08/14/config-file-processing-in-spring-boot-2-4">custom config locations</a>. This allows you to
import these config locations as property sources. As such, Coherence Spring allows you to use a Coherence cluster as a source of
configuration data for your Spring Boot based applications.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please also consult the Spring Boot reference guide on <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#boot-features-external-config">Externalized Configuration</a>,
especially the chapter on <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#boot-features-external-config-files-importing">Importing Additional Data</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please also see the chapter on <a href="#spring-cloud-config">Coherence Spring Cloud Config</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can trigger the import of remote configuration properties with the Spring Boot property
<code>spring.config.import</code> using the value <code>coherence:</code>. You will also need the corresponding Coherence config-client
configured to specify any remote connection settings for your Coherence cluster as well as settings specifying how
properties will be applied, e.g., the name of the application used to fetch remote properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  config:
    import: "coherence:"
coherence:
  config-client:
    application-name: berlin
    profile: kona</code></pre>
</div>
</div>
<div class="paragraph">
<p>Many properties have sensible default values. Please see class
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/boot/config/CoherenceConfigClientProperties.html">CoherenceConfigClientProperties</a>
for details.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-boot-caching"><a class="anchor" href="#spring-boot-caching"></a>7.5. Caching with Spring Boot</h3>
<div class="paragraph">
<p>If you have not already done so, please read the chapter
<a href="#spring-cache-configuration">Configuring Coherence Cache for Spring</a> first.</p>
</div>
<div class="paragraph">
<p>In this chapter, we see how we can use caching with Coherence in Spring Boot.
As long as <code>coherence-spring-boot-starter</code> is added to your project, and caching is enabled via <code>@EnableCaching</code>,
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/boot/autoconfigure/CoherenceAutoConfiguration.html">Coherence Autoconfiguration</a>
will automatically provide a
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/cache/CoherenceCacheManager.html">CoherenceCacheManager</a> (implementing
Spring&#8217;s <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/cache/CacheManager.html">CacheManager</a>) to the ApplicationContext. However, the
<code>CacheManager</code> is only added if no <code>CacheManager</code> was configured explicitly beforehand.</p>
</div>
<div class="paragraph">
<p>Once that is in place, you can take advantage of
<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#boot-features-caching">Spring&#8217;s Cache abstraction</a>
backed by Coherence and use Spring&#8217;s annotations such as <code>@Cacheable</code>, <code>@CacheEvict</code>, <code>@CachePut</code> etc.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When learning about Coherence&#8217;s Spring cache abstraction support, please familiarize yourself with the
following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#quickstart">Coherence Spring Quickstart chapter</a></p>
</li>
<li>
<p><a href="#spring-cache">Coherence Core Spring Cache Support</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#boot-features-caching">Spring Boot&#8217;s reference documentation&#8217;s support regarding caching</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/integration.html#cache">The Cache Abstraction</a> chapter in the core Spring Framework reference guide</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="spring-boot-caching-circuit-breaker"><a class="anchor" href="#spring-boot-caching-circuit-breaker"></a>7.5.1. Configure Circuit Breakers with Resilience4j</h4>
<div class="paragraph">
<p>Generally, it is recommended to configure and run Coherence as part of your application as a <em>cluster member</em>. However,
caching can also be configured using Coherence in <em>client mode</em> via Coherence*Extend or gRPC. However, in client mode
you may encounter failures and/or reliability situations due to network issues resulting in cache failures. In those
situations, it would be desirable to retrieve the data from the persistence store instead, until the connectivity
is being restored. Similarly, your application may encounter request timeout issues when retrieving data from the cache.</p>
</div>
<div class="paragraph">
<p>This is where the circuit breaker pattern can be quite helpful, allowing you to gracefully degrade functionality via
configurable fallback methods. Spring Boot has excellent support via <a href="https://github.com/resilience4j/resilience4j/">Resilience4j</a>, a fault
tolerance library.</p>
</div>
<div class="paragraph">
<p>Coherence Spring includes an <a href="https://github.com/coherence-community/coherence-spring/tree/main/samples/circuit-breaker-cache-demo">example application</a> that illustrates
a basic circuit breaker use-case via Resilience4j. In this example a Spring Boot-based application has REST endpoints
to retrieve Books:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>GET <code>/api/books</code> - Retrieve all books</p>
</li>
<li>
<p>GET <code>/api/books/1234</code> - Retrieve a single book</p>
</li>
<li>
<p>DELETE <code>/api/books/1234</code> - Evict a book from the Coherence cache</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, 2 books are inserted into the in-memory database AND into the Coherence cache. The application uses Spring&#8217;s
cache abstraction backed by Coherence. The application is configured to connect to Coherence on a separate node via
Coherence*Extend. The use-case of the application is that when you shut down the Coherence server, the application won&#8217;t
be able to retrieve cached domain data from Coherence. Instead, the Resilience4j circuit breaker will catch the connection
exception and invoke a fallback method. In this case the data is returned from the main persistence store, bi-passing
the Spring cache until the connection to the Coherence server has been restored.</p>
</div>
<div class="sect4">
<h5 id="spring-boot-caching-circuit-breaker-running-example"><a class="anchor" href="#spring-boot-caching-circuit-breaker-running-example"></a>7.5.1.1. Running the Example</h5>
<div class="paragraph">
<p>The example application consists of 2 applications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>circuit-breaker-cache-demo-server</strong> - The stand-alone Coherence instance</p>
</li>
<li>
<p><strong>circuit-breaker-cache-demo-app</strong> - The client application that will connect to the Coherence server via Coherence*Extend</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s first run the server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw spring-boot:run -pl samples/circuit-breaker-cache-demo/circuit-breaker-cache-demo-server</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we need to run the actual application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw spring-boot:run -pl samples/circuit-breaker-cache-demo/circuit-breaker-cache-demo-app</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the application starts, <code>2</code> books are added not only to the persistence store (HSQLDB) but also to the Coherence cache.
However, this is not true for the retrieval of all books in this example.</p>
</div>
<div class="paragraph">
<p><strong>Get all books</strong></p>
</div>
<div class="paragraph">
<p>When you retrieve a list of all books. You will see that the main relevant business method is executed and the data retrieved
from the database. But at this point the collection of books is added to the Coherence cache for the first time.</p>
</div>
<div class="listingblock">
<div class="title">List all books</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -i \
  -H "Accept: application/json" \
  -H "Content-Type:application/json" \
  -X GET "http://localhost:8090/api/books"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Thus, when you retrieve the list of books again, you will see in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">No cache entry for key 'SimpleKey []' in cache(s) [allBooks]</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Get a Single Book</strong></p>
</div>
<div class="paragraph">
<p>When retrieving a single book, on the other side, the book is retrieved from the Coherence cache right away.</p>
</div>
<div class="listingblock">
<div class="title">Get a single book</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -i \
  -H "Accept: application/json" \
  -H "Content-Type:application/json" \
  -X GET "http://localhost:8090/api/books/1"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Cache entry for key '1' found in cache 'books'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s evict the book from the Coherence cache:</p>
</div>
<div class="listingblock">
<div class="title">Evict book with id <code>1</code> from the Coherence Cache</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -i \
  -H "Accept: application/json" \
  -H "Content-Type:application/json" \
  -X DELETE "http://localhost:8090/api/books/1"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, when you retrieve the book again, it will be retrieved from the persistence store instead. Let&#8217;s do something more
interesting. When retrieving a single book we added a special case to the business service, where the retrieval of a book
with id <code>42</code> will cause a <code>BusinessException</code> to be thrown.</p>
</div>
<div class="listingblock">
<div class="title">Get a single book throwing a business exception</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -i \
  -H "Accept: application/json" \
  -H "Content-Type:application/json" \
  -X GET "http://localhost:8090/api/books/42"</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you may notice, an <code>Internal Server Error</code> (HTTP status 500) is returned to you. Additionally, a <code>BusinessException</code>
was thrown and handled by a Resilience4j fallback method.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Resilience4j selects fallback methods based on the specificity of the thrown Exceptions in relation to the exception
declared in the fallback method. Thus, if you have multiple fallback methods, the method with the most specific exception
is being chosen. Furthermore, it is important to know that expected exceptions (e.g. Business Exceptions) that you have
included in the list of <code>ignoreExceptions</code> via <code>application.yaml</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>resilience4j.circuitbreaker.configs.*.ignoreExceptions</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>will also trigger the execution of fallBack methods, but it will not change the state of the circuit breaker.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next, we will first shut down the Coherence server, and then we try to retrieve a single book with id <code>1</code>:</p>
</div>
<div class="listingblock">
<div class="title">Get a single book again</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -i \
  -H "Accept: application/json" \
  -H "Content-Type:application/json" \
  -X GET "http://localhost:8090/api/books/1"</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you see, the JSON response is still the same (The book data is returned). However, when you look at the logs, you will see:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">getBook fallback method (For Throwable) was called: Unable to locate ProxyService 'ExtendTcpCacheService' ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>So basically, the <code>CacheManager</code> was unable to connect to the Coherence instance and therefore the Circuit Breaker kicked
in, calling the fallback method instead, and thus returning the Book not from the cache but from the persistence store.</p>
</div>
</div>
<div class="sect4">
<h5 id="monitoring-the-circuit-breaker"><a class="anchor" href="#monitoring-the-circuit-breaker"></a>7.5.1.2. Monitoring the Circuit Breaker</h5>
<div class="paragraph">
<p>Spring Boot and Resilience4j also provide facilities to monitor the state of the Circuit Breaker via Spring Boot&#8217;s
health-endpoint as well as its circuit breaker events endpoint:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://localhost:8090/actuator/health" class="bare">localhost:8090/actuator/health</a></p>
</li>
<li>
<p><a href="http://localhost:8090/actuator/circuitbreakerevents/coherence" class="bare">localhost:8090/actuator/circuitbreakerevents/coherence</a></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Spring Boot Health Endpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "status":"UP",
  "components":{
    "circuitBreakers":{
      "status":"UNKNOWN",
      "details":{
        "coherence":{
          "status":"CIRCUIT_OPEN",
          "details":{
            "failureRate":"100.0%",
            "failureRateThreshold":"5.0%",
            "slowCallRate":"0.0%",
            "slowCallRateThreshold":"100.0%",
            "bufferedCalls":3,
            "slowCalls":0,
            "slowFailedCalls":0,
            "failedCalls":3,
            "notPermittedCalls":8,
            "state":"OPEN"
          }
        }
      }
    },
    "db":{
      "status":"UP",
      "details":{
        "database":"HSQL Database Engine",
        "validationQuery":"isValid()"
      }
    },
    "diskSpace":{
      "status":"UP",
      "details":{
        "total":2000796545024,
        "free":1490744430592,
        "threshold":10485760,
        "exists":true
      }
    },
    "ping":{
      "status":"UP"
    }
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For demonstrating purposes we enabled the relevant health endpoints via Spring Boot configuration in <code>application.yaml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">management.endpoints.web.exposure.include: "*"
management.endpoint.health.show-details: always</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may not want to do this in production. This is solely for demonstration purposes, especially as no security is configured
for this application.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="add-resilience4j-dependencies"><a class="anchor" href="#add-resilience4j-dependencies"></a>7.5.1.3. Add Resilience4j Dependencies</h5>
<div class="paragraph">
<p>In order to use Resilience4j in your Coherence Spring project with Spring Boot, you need to add the following dependencies:</p>
</div>
<div class="exampleblock">
<div class="title">Example 9. Resilience4j Spring Boot Dependency</div>
<div class="content">
<div class="listingblock primary">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.github.resilience4j&lt;/groupId&gt;
    &lt;artifactId&gt;resilience4j-spring-boot3&lt;/artifactId&gt;
    &lt;version&gt;2.1.0&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">implementation("io.github.resilience4j:resilience4j-spring-boot3:2.1.0")</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="resilience4j-annotations"><a class="anchor" href="#resilience4j-annotations"></a>7.5.1.4. Resilience4j Annotations</h5>
<div class="paragraph">
<p>In order to add circuit-breaker capabilities to our <code>@Cacheable</code> business methods in <code>DefaultBookService</code>, we simply add
the <code>@CircuitBreaker</code> annotations, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Cacheable("allBooks")
@CircuitBreaker(name = "coherence", fallbackMethod = "getAllBooksFallback")
@Override
public List&lt;Book&gt; getAllBooks() {
 ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The key is the specified fallback method: whenever an exception occurs, the fallback method is being executed. You can have
multiple fallback methods, specifying different exception types. Resilience4j will then select the fallback methods based
on the specificity of the thrown exception.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When dealing with fallback method, it may at times be necessary to call other methods of the same services that you expect
to be proxied, e.g. have applied annotations etc. However, when calling other methods in the same service, you are calling
those methods without the relevant AOP aspects applied to them. You may either need to refactor those methods into another
Spring bean or can actually inject the same service into the service. This type of injection call self injection or self
autowiring has <a href="https://stackoverflow.com/questions/5152686/self-injection-with-spring">been supported</a> since Spring <code>4.3</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-boot-hibernate-second-level-cache"><a class="anchor" href="#spring-boot-hibernate-second-level-cache"></a>7.6. Configure Hibernate Second-Level Caching</h3>
<div class="paragraph">
<p>Spring&#8217;s cache abstraction is not your only option with regard to caching. Another option is to use Hibernate&#8217;s
<a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching">Second-Level cache</a> support.</p>
</div>
<div class="paragraph">
<p>When using only Hibernate&#8217;s second-level cache without the requirement of using Coherence for non-Hibernate application
needs, you may want to disable Coherence&#8217;s auto-configuration support for Spring
Boot as it is not needed:</p>
</div>
<div class="listingblock">
<div class="title">Disable CoherenceAutoConfiguration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@SpringBootApplication(exclude=CoherenceAutoConfiguration.class)
public class HibernateApplication {
    public static void main(String[] args) {
        SpringApplication.run(HibernateApplication.class, args);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to configure Hibernate Second-Level Caching for Coherence using Spring Boot, you simply have to set the
Hibernate property <code>hibernate.cache.region.factory_class</code> to <code>com.oracle.coherence.hibernate.cache.CoherenceRegionFactory</code>.</p>
</div>
<div class="paragraph">
<p>Your Spring Boot <code>application.yaml</code> file may look like the following:</p>
</div>
<div class="listingblock">
<div class="title">RegionFactory Configuration using YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  application:
    name: Your Spring Boot App
  jpa:
    properties:
      hibernate.cache.region.factory_class: com.oracle.coherence.hibernate.cache.CoherenceRegionFactory <i class="conum" data-value="1"></i><b>(1)</b>
      hibernate.cache.use_query_cache: true
      hibernate.cache.use_second_level_cache: true
      hibernate.format_sql: true
      hibernate.generate_statistics: true
      hibernate.show_sql: true
      hibernate.use_sql_comments: false
...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configuring the <code>CoherenceRegionFactory</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more detailed information please see the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching">Caching chapter</a> of the Hibernate reference
documentation.</p>
</div>
<div class="sect3">
<h4 id="spring-boot-hibernate-second-level-cache-example"><a class="anchor" href="#spring-boot-hibernate-second-level-cache-example"></a>7.6.1. Hibernate Second Level Cache Example</h4>
<div class="paragraph">
<p>The Coherence Spring source code repository also provides an
<a href="https://github.com/coherence-community/coherence-spring/tree/main/samples/hibernate-cache-demo">example application</a>, illustrating the Coherence support for
Hibernate&#8217;s Second Level caching using <a href="https://spring.io/projects/spring-boot">Spring Boot</a>.</p>
</div>
<div class="paragraph">
<p>The example application has 1 REST endpoint that can persist, retrieve and delete a <code>Plant</code> object with taxonomic properties
such as the genus and species.</p>
</div>
<div class="listingblock">
<div class="title">Example of a <code>Plant</code> JSON response</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json"> {"id": 1, "genus": "Sabal", "species": "minor", "commonName": "Dwarf palmetto"}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="spring-boot-hibernate-second-level-cache-example-run"><a class="anchor" href="#spring-boot-hibernate-second-level-cache-example-run"></a>7.6.1.1. Run the Hibernate Application</h5>
<div class="paragraph">
<p>First, let&#8217;s build the application:</p>
</div>
<div class="listingblock">
<div class="title">Build the Coherence Server instance</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> $ ./mvnw clean package -pl samples/hibernate-cache-demo</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, run the application:</p>
</div>
<div class="listingblock">
<div class="title">Run the Spring Boot application</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> $ java -jar samples/hibernate-cache-demo/target/hibernate-cache-demo-4.1.2-SNAPSHOT.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>The application will be available on port <code>9090</code>.</p>
</div>
<div class="listingblock">
<div class="title">Add a plant</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -i \
  -H "Accept: application/json" \
  -H "Content-Type:application/json" \
  -X POST --data '{"genus": "Sabal", "species": "minor", "commonName": "Dwarf palmetto"}' \
  "http://localhost:9090/plants"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">List all plants</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -i \
  -H "Accept: application/json" \
  -H "Content-Type:application/json" \
  -X GET "http://localhost:9090/plants"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Get a single plant</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -i \
  -H "Accept: application/json" \
  -H "Content-Type:application/json" \
  -X GET "http://localhost:9090/plants/1"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Delete a plant</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -i \
  -H "Accept: application/json" \
  -H "Content-Type:application/json" \
  -X DELETE "http://localhost:9090/plants/1"</code></pre>
</div>
</div>
<div class="paragraph">
<p>When retrieving a single plant repeatedly, you will see no SQL printed to the console. Instead, the plant is returned
from the second level cache as illustrated by the printed out cache statistics.</p>
</div>
<div class="listingblock">
<div class="title">Hibernate Cache Statistics</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">2021-06-28 16:12:42.545  INFO 29022 --- [nio-9090-exec-7] i.StatisticalLoggingSessionEventListener : Session Metrics {
27579 nanoseconds spent acquiring 1 JDBC connections;
0 nanoseconds spent releasing 0 JDBC connections;
0 nanoseconds spent preparing 0 JDBC statements;
0 nanoseconds spent executing 0 JDBC statements;
0 nanoseconds spent executing 0 JDBC batches;
0 nanoseconds spent performing 0 L2C puts;
1587296 nanoseconds spent performing 1 L2C hits;
0 nanoseconds spent performing 0 L2C misses;
0 nanoseconds spent executing 0 flushes (flushing a total of 0 entities and 0 collections);
0 nanoseconds spent executing 0 partial-flushes (flushing a total of 0 entities and 0 collections)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to also cache the results of query executions, you must provide query hints to Hibernate. The <code>PlantRepository</code>
class has a custom query using such a hint for illustration purposes:</p>
</div>
<div class="listingblock">
<div class="title">Using Query Hints</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@QueryHints(@QueryHint(name = org.hibernate.annotations.QueryHints.CACHEABLE, value = "true"))
@Query("select p from Plant p")
List&lt;Plant&gt; getAllPlantsCacheable();</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see the cache being used by retrieving the list of plants with an additional request parameter <code>use-cache</code>:</p>
</div>
<div class="listingblock">
<div class="title">List all plants</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -i \
  -H "Accept: application/json" \
  -H "Content-Type:application/json" \
  -X GET "http://localhost:9090/plants?use-cache=true"</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-boot-sessions"><a class="anchor" href="#spring-boot-sessions"></a>7.7. Spring Session Support</h3>
<div class="paragraph">
<p>Coherence Spring also provides support for Spring Session. This includes auto-configuration support as well as a set of
Coherence-specific configuration properties. Before you continue, please consider reading the chapter
on <a href="#spring-session">Coherence Spring Session</a> first.</p>
</div>
<div class="paragraph">
<p>In order to activate Spring Session support for Spring Boot, you must have the following dependencies added to your
project:</p>
</div>
<div class="exampleblock">
<div class="title">Example 10. Add Coherence Spring Session Support</div>
<div class="content">
<div class="listingblock primary">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.oracle.coherence.spring&lt;/groupId&gt;
        &lt;artifactId&gt;coherence-spring-boot-starter&lt;/artifactId&gt;
        &lt;version&gt;4.1.2-SNAPSHOT&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.oracle.coherence.spring&lt;/groupId&gt;
        &lt;artifactId&gt;coherence-spring-session&lt;/artifactId&gt;
        &lt;version&gt;4.1.2-SNAPSHOT&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.oracle.coherence.ce&lt;/groupId&gt;
        &lt;artifactId&gt;coherence&lt;/artifactId&gt;
        &lt;version&gt;23.09.2&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">dependencies {
    compile("com.oracle.coherence.spring:coherence-spring-boot-starter:4.1.2-SNAPSHOT")
    compile("com.oracle.coherence.spring:coherence-spring-session:4.1.2-SNAPSHOT")
    compile("com.oracle.coherence.ce:coherence:23.09.2")
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Basically, adding the <code>coherence-spring-session</code> dependency will activate the <code>CoherenceSpringSessionAutoConfiguration</code>
class. Auto-configuration will back-off in certain situations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set property <code>coherence.spring.session.enabled</code> to <code>false</code></p>
</li>
<li>
<p>Define <code>spring.session.store-type</code>. Any value will deactivate auto-configuration.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following Coherence-specific configuration properties are available:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Coherence Configuration Properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">coherence.spring.session.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set to <code>true</code> to enable Spring Session support</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">coherence.spring.session.map-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring:session:sessions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the map used to store sessions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">coherence.spring.session.flush-mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ON_SAVE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sessions flush mode. Determines when session changes are written to the session store.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">coherence.spring.session.save-mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ON_SET_ATTRIBUTE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The session save mode determines how session changes are tracked and saved to the session store.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">coherence.spring.session.use-entry-processor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, a Coherence Entry Processor will be used for handling updates to the persisted HTTP session.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="spring-boot-messaging"><a class="anchor" href="#spring-boot-messaging"></a>7.8. Coherence Messaging Support</h3>
<div class="paragraph">
<p>Support for injecting Coherence Publishers is enabled automatically by adding the <code>coherence-spring-boot-starter</code> dependency.
By default, base package to scan for <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/CoherencePublisher.html">@CoherencePublisher</a>
annotated interfaces is derived from the main class annotated with <code>@SpringBootApplication</code>. Base package can be overridden
by annotating configuration class with <a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/annotation/CoherencePublisherScan.html">@CoherencePublisherScan</a>
as described at <a href="#coherence-spring-messaging-with-coherence-topics">Messaging with Coherence Topics</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-boot-metrics"><a class="anchor" href="#spring-boot-metrics"></a>7.9. Coherence Metrics</h3>
<div class="paragraph">
<p>By adding the <code>coherence-spring-boot-starter</code> and <code>com.oracle.coherence.ce:coherence-micrometer</code> dependencies auto-configuration will register <code>CoherenceMicrometerMetrics</code> and publish <a href="https://docs.oracle.com/en/middleware/standalone/coherence/14.1.1.2206//manage/using-coherence-metrics.html#GUID-98DD26E5-48C1-461A-9599-5FA607636DE7">Coherence Metrics</a> under the <code>coherence.</code> name.</p>
</div>
<div class="paragraph">
<p>To disable the auto-configured Coherence metrics even when <code>coherence-micrometer</code> module is on the classpath, set the following property:</p>
</div>
<div class="listingblock">
<div class="title">application.yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">management:
  metrics:
    enable:
      coherence: false</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-boot-data"><a class="anchor" href="#spring-boot-data"></a>7.10. Spring Data Support</h3>
<div class="paragraph">
<p>Coherence Spring&#8217;s support for Spring Data also contain auto-configuration support for Spring Boot. The auto-configuration
is activated as soon as the Coherence Spring Data dependency is added to your Spring Boot project.</p>
</div>
<div class="exampleblock">
<div class="title">Example 11. Add Coherence Spring Data Support</div>
<div class="content">
<div class="listingblock primary">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.oracle.coherence.spring&lt;/groupId&gt;
        &lt;artifactId&gt;coherence-spring-boot-starter&lt;/artifactId&gt;
        &lt;version&gt;4.1.2-SNAPSHOT&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.oracle.coherence.spring&lt;/groupId&gt;
        &lt;artifactId&gt;coherence-spring-data&lt;/artifactId&gt;
        &lt;version&gt;4.1.2-SNAPSHOT&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.oracle.coherence.ce&lt;/groupId&gt;
        &lt;artifactId&gt;coherence&lt;/artifactId&gt;
        &lt;version&gt;23.09.2&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">dependencies {
    compile("com.oracle.coherence.spring:coherence-spring-boot-starter:4.1.2-SNAPSHOT")
    compile("com.oracle.coherence.spring:coherence-spring-data:4.1.2-SNAPSHOT")
    compile("com.oracle.coherence.ce:coherence:23.09.2")
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There is no need to add the <code>@EnableCoherenceRepositories</code> annotation, as the Coherence Spring Data auto-configuration
support, will automatically detect any Coherence repositories. In fact, adding <code>@EnableCoherenceRepositories</code> to your
Spring Boot project, will cause auto-configuration to back-off.</p>
</div>
<div class="paragraph">
<p>Auto-configuration can also be de-activated by setting environment property <code>coherence.spring.data.repositories.enabled</code>
to <code>false</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-config"><a class="anchor" href="#spring-cloud-config"></a>8. Coherence Spring Cloud Config</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section explains how to configure Coherence using <a href="https://spring.io/projects/spring-cloud-config/">Spring Cloud Config</a>.</p>
</div>
<div class="sect2">
<h3 id="spring-cloud-config-overview"><a class="anchor" href="#spring-cloud-config-overview"></a>8.1. Overview</h3>
<div class="paragraph">
<p>Spring Cloud Config provides support for externalized configuration in distributed systems. It integrates seamlessly
with Spring Boot applications and allows you to externalize / centralize critical application properties. Spring Cloud
Config provides numerous storage backends for your configuration data and as part of Coherence Spring we also provide
a backend for Oracle Coherence.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Please familiarize yourself with the <a href="https://docs.spring.io/spring-cloud-config/docs/current/reference/html/">Spring Cloud Config reference documentation</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this chapter we will cover two aspects of Coherence-specific support for Spring Cloud Config:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configure Coherence and its Spring support using Spring Cloud Config</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s get started with an example to show the general functioning of Spring Cloud Config.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-config-demo"><a class="anchor" href="#spring-cloud-config-demo"></a>8.2. Demo</h3>
<div class="paragraph">
<p>This demo is essentially the same as is used in the <a href="#quickstart">Quickstart</a> chapter. However, we
externalize some Coherence configuration using Spring Cloud Config. The source code for the demo is part of the
<a href="https://github.com/coherence-community/coherence-spring/">Coherence Spring source code repository</a>. Therefore, to get started, please clone its repository:</p>
</div>
<div class="listingblock">
<div class="title">Clone the Spring Cloud Config demo project</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> $ git clone https://github.com/coherence-community/coherence-spring.git
 $ cd coherence-spring</code></pre>
</div>
</div>
<div class="paragraph">
<p>You now have checked out all the code for Coherence Spring! The relevant demo code for the Spring Cloud Config demo is
under <code>coherence-spring-samples/coherence-spring-cloud-config-demo/</code>. The demo consists of 2 Maven modules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>coherence-spring-cloud-config-demo-server</strong>: Spring Cloud Config Server implementation</p>
</li>
<li>
<p><strong>coherence-spring-cloud-config-demo-app</strong>: Main application</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Config Server is essentially using 2 dependencies:</p>
</div>
<div class="listingblock">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-config-server&lt;/artifactId&gt;    <i class="conum" data-value="1"></i><b>(1)</b>
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;  <i class="conum" data-value="2"></i><b>(2)</b>
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Spring Cloud Config Server dependency</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Provides rudimentary security for the exposed configuration REST endpoints using
<a href="https://spring.io/projects/spring-security/">Spring Security</a></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The demo client on the other hand will use the following dependencies:</p>
</div>
<div class="listingblock">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.oracle.coherence.spring&lt;/groupId&gt;
    &lt;artifactId&gt;coherence-spring-boot-starter&lt;/artifactId&gt; <i class="conum" data-value="1"></i><b>(1)</b>
    &lt;version&gt;{coherence-spring.version}&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.oracle.coherence.ce&lt;/groupId&gt;
    &lt;artifactId&gt;coherence&lt;/artifactId&gt;                     <i class="conum" data-value="2"></i><b>(2)</b>
    &lt;version&gt;{coherence.version}&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;   <i class="conum" data-value="3"></i><b>(3)</b>
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Provides all integration code, caching + autoconfiguration support</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The Oracle Coherence dependency</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The dependency to integrate with the Spring Cloud Config server</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We made the decision to not automatically bring in the Coherence dependencies. The main reason is that users can
specify the version they need, either the Oracle Coherence CE (OSS) or the commercial version.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="spring-cloud-config-demo-setup"><a class="anchor" href="#spring-cloud-config-demo-setup"></a>8.2.1. Configure the Demo Application</h4>
<div class="paragraph">
<p>In order to run the demo, we first need to create a Git repository that will contain
the configuration data.</p>
</div>
<div class="listingblock">
<div class="title">Set up the Config Data</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> $ cd /path/to/git/repo
 $ mkdir coherence-spring-config-repository
 $ cd coherence-spring-config-repository
 $ git init</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add a properties file called <code>config-client.properties</code>:</p>
</div>
<div class="listingblock">
<div class="title">config-client.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"> coherence.logging.severity-level=6                                           <i class="conum" data-value="1"></i><b>(1)</b>
 coherence.logging.destination=slf4j                                          <i class="conum" data-value="2"></i><b>(2)</b>

 coherence.properties.coherence.cluster=Demo Cluster                          <i class="conum" data-value="3"></i><b>(3)</b>
 coherence.properties.coherence.member=Demo Cluster Member                    <i class="conum" data-value="4"></i><b>(4)</b>
 coherence.properties.coherence.management.remote=true                        <i class="conum" data-value="5"></i><b>(5)</b>
 coherence.properties.coherence.management=all                                <i class="conum" data-value="6"></i><b>(6)</b>
 coherence.properties.coherence.management.report.autostart=true              <i class="conum" data-value="7"></i><b>(7)</b>
 coherence.properties.coherence.reporter.output.directory=/path/to/reports/   <i class="conum" data-value="8"></i><b>(8)</b>
 coherence.properties.coherence.management.report.configuration=/reports/report-all.xml <i class="conum" data-value="9"></i><b>(9)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>-1</code> emits no log messages, <code>9</code> emits the most</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specifies the logger e.g. <code>stdout</code>, <code>log4j</code>, <code>log4j2</code>, <code>slf4j</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The name of the cluster</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The name of the cluster member</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Specifies whether this cluster node exposes its managed objects to remote MBean server. <code>true</code> or <code>false</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><code>none</code> means no MBean server is instantiated. <code>all</code> enables management of both local and remotely manageable cluster nodes.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td><code>true</code> or <code>false</code> (default) Specifies whether the Reporter automatically starts when the node starts.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The output directory for generated reports. By default, reports are saved reports to the directory from which the cluster member starts.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>You can control which reports are generated by specifying a different report group configuration file. The pre-defined
reports are located at <code>coherence-23.09.2.jar/reports</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more options please see the following three chapters in the official Oracle Coherence reference guide:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.oracle.com/en/middleware/standalone/coherence/14.1.1.2206//develop-applications/operational-configuration-elements.html">Operational Configuration Elements</a></p>
</li>
<li>
<p><a href="https://docs.oracle.com/en/middleware/standalone/coherence/14.1.1.2206//develop-applications/system-property-overrides.html">System Property Overrides</a></p>
</li>
<li>
<p><a href="https://docs.oracle.com/en/middleware/standalone/coherence/14.1.1.2206//manage/using-oracle-coherence-reporting.html">Using Oracle Coherence Reporting</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="spring-cloud-config-demo-how-to-run"><a class="anchor" href="#spring-cloud-config-demo-how-to-run"></a>8.2.2. Run the Demo Application</h4>
<div class="paragraph">
<p>Please execute the following:</p>
</div>
<div class="listingblock">
<div class="title">Start the Spring Cloud Config Server</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> $ ./mvnw clean package -pl :coherence-spring-cloud-config-demo-server
 $ cd coherence-spring-samples/coherence-spring-cloud-config-demo/coherence-spring-cloud-config-demo-server/target
 $ java -jar coherence-spring-cloud-config-demo-server-4.1.2-SNAPSHOT.jar \n
     --spring.cloud.config.server.git.uri=file:///path/to/git/repo</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Start the Coherence Spring Application</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> $ ./mvnw clean package -pl :coherence-spring-cloud-config-demo-app
 $ cd coherence-spring-samples/coherence-spring-cloud-config-demo/coherence-spring-cloud-config-demo-app/target
 $ java -jar coherence-spring-cloud-config-demo-app-4.1.2-SNAPSHOT.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>Feel free to change configuration settings and see, once you restart the apps, how the behavior of the Coherence cluster
changes.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-config-coherence"><a class="anchor" href="#spring-cloud-config-coherence"></a>8.3. Use Spring Cloud Config Server to Configure Coherence</h3>
<div class="paragraph">
<p>The previously discussed demo application illustrated the main concepts of using Spring Cloud Config Server as a
configuration backend for Oracle Coherence. For a general understanding of Spring Cloud Config Server, please consult
the respective <a href="https://docs.spring.io/spring-cloud-config/docs/current/reference/html/">reference documentation</a>.</p>
</div>
<div class="paragraph">
<p>Coherence Spring is essentially unaware of Spring Cloud Config Server. Coherence Spring merely takes advantage of Spring
Boot&#8217;s configuration facilities. The main integration point for configuration between Spring and
Oracle Coherence is the
<a href="https://spring.coherence.community/4.1.2-SNAPSHOT/refdocs/api/com/oracle/coherence/spring/configuration/support/SpringSystemPropertyResolver.html">SpringSystemPropertyResolver</a>
class, which makes the properties of Spring&#8217;s <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/core/env/Environment.html">Environment</a>
available to Oracle Coherence.</p>
</div>
<div class="paragraph">
<p>When using Spring Boot (and not just plain Spring Framework), we also provide the <code>CoherenceProperties</code> class. It provides
means to expose Coherence Spring configuration options in a type-safe manner, to provide code completion via your IDE etc.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Providing dedicated CoherenceProperties support is work in progress.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Behind the scenes using <code>CoherenceProperties.getCoherencePropertiesAsMap()</code> will translate the explicit Spring Boot properties
into the property format used by Oracle Coherence. It is important to note that you can always provide ANY Oracle Coherence
property as well.</p>
</div>
<div class="paragraph">
<p>For instance the following properties are equivalent:</p>
</div>
<div class="listingblock">
<div class="title">Equivalent Properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"> coherence.logging.severity-level=5
 coherence.logging.destination=log4j

 coherence.log.level=5
 coherence.log=log4j</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please also see <a href="#spring-boot-config-data-api">Coherence Support of the Spring Boot ConfigData API</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appendix"><a class="anchor" href="#appendix"></a>9. Appendices</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="examples"><a class="anchor" href="#examples"></a>Appendix A: Coherence Spring Example Applications</h3>
<div class="paragraph">
<p>The Coherence Spring project itself includes a number of examples that demonstrate how to use Coherence Spring. Furthermore,
there are several additional examples that are not part of this repository but that may be of interest to Coherence Spring users.</p>
</div>
<div class="paragraph">
<p>The following examples are included in this repository:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#coherence-spring-cachestore-demo">JPA Repository CacheStore Demo</a></p>
</li>
<li>
<p><a href="#spring-boot-caching-circuit-breaker">Circuit Breaker Cache Demo</a></p>
</li>
<li>
<p><a href="#quickstart">Coherence Spring Demo</a></p>
<div class="ulist">
<ul>
<li>
<p>Coherence Spring Boot Demo</p>
</li>
<li>
<p>Coherence Spring Classic Demo (non-Boot)</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#spring-session-sample">Coherence Spring Session Demo</a></p>
</li>
<li>
<p><a href="#spring-boot-hibernate-second-level-cache-example-run">Hibernate Second Level Cache Demo</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following examples are not included in this repository but are available in separate repositories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/coherence-community/todo-list-example/tree/main/java/spring-server">Coherence To Do List Example Application for Spring Boot</a></p>
</li>
<li>
<p><a href="https://github.com/oracle/coherence-spring-sockshop-sample">Coherence Spring Sock Shop</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-01-31 05:15:27 UTC
</div>
</div>
<script src="js/highlight/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code[data-lang]')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
<script type="text/javascript" src="js/tocbot/tocbot.min.js"></script>
<script type="text/javascript" src="js/toc.js"></script>
</body>
</html>